{"ast":null,"code":"var _jsxFileName = \"C:\\\\Online Exam Proctoring System\\\\frontend\\\\src\\\\components\\\\PreExamSetup.js\",\n  _s = $RefreshSig$();\n// PreExamSetup.js\nimport React, { useEffect, useRef, useState } from \"react\";\nimport * as faceapi from \"face-api.js\";\nimport { useNavigate } from \"react-router-dom\";\nimport \"./PreExamSetup.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function PreExamSetup({\n  user,\n  examId,\n  examDetails,\n  onProceed,\n  onCancel\n}) {\n  _s();\n  var _examDetails$question;\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n\n  // loaded resources & refs\n  const modelsLoadedRef = useRef(false);\n  const detectionIntervalRef = useRef(null);\n  const runningDetectionRef = useRef(false); // prevents overlapping detection runs\n\n  // registered face descriptor\n  const [registeredDescriptor, setRegisteredDescriptor] = useState(null);\n\n  // checks UI/state\n  const [checks, setChecks] = useState({\n    camera: {\n      status: \"pending\",\n      message: \"Checking camera access...\"\n    },\n    models: {\n      status: \"pending\",\n      message: \"Loading face detection models...\"\n    },\n    faceDetection: {\n      status: \"pending\",\n      message: \"Waiting for face detection...\"\n    },\n    lighting: {\n      status: \"pending\",\n      message: \"Checking lighting conditions...\"\n    },\n    identity: {\n      status: \"pending\",\n      message: \"Verifying your identity...\"\n    },\n    singlePerson: {\n      status: \"pending\",\n      message: \"Checking for single person...\"\n    }\n  });\n\n  // Verification counters\n  const [verificationAttempts, setVerificationAttempts] = useState(0); // total attempts made\n  const [consecutiveSuccesses, setConsecutiveSuccesses] = useState(0); // counts only consecutive verified runs\n  const [canProceed, setCanProceed] = useState(false);\n  const [currentIssues, setCurrentIssues] = useState([]);\n  const [isChecking, setIsChecking] = useState(true);\n  const navigate = useNavigate();\n\n  // --- Lifecycle ---\n  useEffect(() => {\n    startSystemCheck();\n\n    // cleanup\n    return () => {\n      stopDetectionInterval();\n      stopCamera();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  // When consecutive successes reach 3, mark ready and stop detection\n  useEffect(() => {\n    if (consecutiveSuccesses >= 3 && !canProceed) {\n      setCanProceed(true);\n      setIsChecking(false);\n      stopDetectionInterval();\n      updateCheck(\"identity\", \"success\", `âœ“ Identity verified (${consecutiveSuccesses}/3)`);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [consecutiveSuccesses]);\n\n  // --- Helpers ---\n  const updateCheck = (key, status, message) => {\n    setChecks(prev => ({\n      ...prev,\n      [key]: {\n        status,\n        message\n      }\n    }));\n  };\n  const stopCamera = () => {\n    if (videoRef.current && videoRef.current.srcObject) {\n      try {\n        videoRef.current.srcObject.getTracks().forEach(t => t.stop());\n      } catch (e) {\n        // ignore\n      }\n      videoRef.current.srcObject = null;\n    }\n  };\n  const stopDetectionInterval = () => {\n    if (detectionIntervalRef.current) {\n      clearInterval(detectionIntervalRef.current);\n      detectionIntervalRef.current = null;\n    }\n  };\n\n  // --- Start sequence ---\n  const startSystemCheck = async () => {\n    setIsChecking(true);\n    setConsecutiveSuccesses(0);\n    setVerificationAttempts(0);\n    setCurrentIssues([]);\n\n    // camera\n    const camOk = await requestCamera();\n    if (!camOk) return;\n\n    // models\n    const modelsOk = await loadModels();\n    if (!modelsOk) return;\n\n    // registered descriptor\n    const faceOk = await fetchRegisteredDescriptor();\n    if (!faceOk) return;\n\n    // wait for video metadata to be ready\n    await waitForVideoReady();\n\n    // start continuous detection every 1.5s\n    performAllChecks(); // run first immediately after ready\n    detectionIntervalRef.current = setInterval(() => {\n      performAllChecks();\n    }, 1500);\n  };\n\n  // --- Camera ---\n  const requestCamera = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          width: {\n            ideal: 640\n          },\n          height: {\n            ideal: 480\n          },\n          facingMode: \"user\"\n        },\n        audio: false\n      });\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n        await new Promise(resolve => {\n          videoRef.current.onloadedmetadata = () => {\n            try {\n              videoRef.current.play();\n            } catch (e) {}\n            resolve();\n          };\n        });\n        updateCheck(\"camera\", \"success\", \"âœ“ Camera connected\");\n        return true;\n      }\n      updateCheck(\"camera\", \"error\", \"âœ— Camera element missing\");\n      return false;\n    } catch (err) {\n      console.error(\"Camera error:\", err);\n      updateCheck(\"camera\", \"error\", \"âœ— Camera access denied or not found\");\n      alert(\"Please enable camera access and reload.\");\n      return false;\n    }\n  };\n  const waitForVideoReady = () => {\n    return new Promise(resolve => {\n      const check = () => {\n        if (videoRef.current && videoRef.current.readyState >= 3) {\n          // set canvas size once\n          if (canvasRef.current && videoRef.current) {\n            canvasRef.current.width = videoRef.current.videoWidth || 640;\n            canvasRef.current.height = videoRef.current.videoHeight || 480;\n          }\n          resolve();\n        } else {\n          setTimeout(check, 100);\n        }\n      };\n      check();\n    });\n  };\n\n  // --- Models ---\n  const loadModels = async () => {\n    try {\n      const MODEL_URL = process.env.PUBLIC_URL + \"/models\";\n      // load required face-api models\n      await Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL), faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL), faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)]);\n      modelsLoadedRef.current = true;\n      updateCheck(\"models\", \"success\", \"âœ“ Detection models loaded\");\n      return true;\n    } catch (err) {\n      console.error(\"Model load error:\", err);\n      updateCheck(\"models\", \"error\", \"âœ— Failed to load detection models\");\n      alert(\"Model files missing. Put models into /public/models folder.\");\n      return false;\n    }\n  };\n\n  // --- Registered descriptor fetch ---\n  const fetchRegisteredDescriptor = async () => {\n    try {\n      const token = localStorage.getItem(\"token\");\n      const res = await fetch(\"http://localhost:4000/api/auth/face-descriptor\", {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      if (!res.ok) throw new Error(\"Not registered\");\n      const data = await res.json();\n      if (!(data !== null && data !== void 0 && data.faceDescriptor) || data.faceDescriptor.length !== 128) throw new Error(\"Invalid descriptor\");\n      setRegisteredDescriptor(new Float32Array(data.faceDescriptor));\n      return true;\n    } catch (err) {\n      console.error(\"Registered face fetch error:\", err);\n      updateCheck(\"identity\", \"error\", \"âœ— Face not registered. Please register first.\");\n      alert(\"You must register your face before taking the exam.\");\n      return false;\n    }\n  };\n\n  // --- Core detection logic ---\n  // uses consecutiveSuccesses: increments on match, resets on mismatch or other issues\n  const performAllChecks = async () => {\n    // prevent overlapping runs\n    if (runningDetectionRef.current) return;\n    runningDetectionRef.current = true;\n    try {\n      // Basic readiness\n      if (!videoRef.current || !canvasRef.current) {\n        updateCheck(\"faceDetection\", \"pending\", \"Waiting for video/canvas...\");\n        runningDetectionRef.current = false;\n        return;\n      }\n      if (!modelsLoadedRef.current) {\n        updateCheck(\"models\", \"pending\", \"Loading models...\");\n        runningDetectionRef.current = false;\n        return;\n      }\n      if (!registeredDescriptor) {\n        updateCheck(\"identity\", \"pending\", \"Registered face missing...\");\n        runningDetectionRef.current = false;\n        return;\n      }\n      // video readyState check\n      if (videoRef.current.readyState < 3) {\n        updateCheck(\"faceDetection\", \"pending\", \"Video not ready yet...\");\n        runningDetectionRef.current = false;\n        return;\n      }\n\n      // increment attempt\n      setVerificationAttempts(a => a + 1);\n\n      // detect\n      const options = new faceapi.TinyFaceDetectorOptions({\n        inputSize: 224,\n        scoreThreshold: 0.5\n      });\n      const detectionPromise = faceapi.detectAllFaces(videoRef.current, options).withFaceLandmarks().withFaceDescriptors();\n\n      // timeout safety\n      const timeoutMs = 8000;\n      const timeoutPromise = new Promise((_, rej) => setTimeout(() => rej(new Error(\"detection-timeout\")), timeoutMs));\n      const detections = await Promise.race([detectionPromise, timeoutPromise]);\n\n      // draw results to canvas\n      try {\n        const dims = faceapi.matchDimensions(canvasRef.current, videoRef.current, true);\n        const resized = faceapi.resizeResults(detections, dims);\n        const ctx = canvasRef.current.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n        faceapi.draw.drawDetections(canvasRef.current, resized);\n        faceapi.draw.drawFaceLandmarks(canvasRef.current, resized);\n      } catch (e) {\n        // swallow drawing errors, continue\n        console.warn(\"Canvas draw failed:\", e);\n      }\n\n      // checks\n      const issues = [];\n      if (!detections || detections.length === 0) {\n        updateCheck(\"faceDetection\", \"warning\", \"âš  No face detected\");\n        updateCheck(\"identity\", \"pending\", \"Waiting for face...\");\n        updateCheck(\"singlePerson\", \"pending\", \"Waiting for face...\");\n        updateCheck(\"lighting\", \"pending\", \"Waiting for face...\");\n        setCurrentIssues([\"Position your face in front of the camera\"]);\n        // reset consecutive successes\n        setConsecutiveSuccesses(0);\n        runningDetectionRef.current = false;\n        return;\n      } else {\n        updateCheck(\"faceDetection\", \"success\", \"âœ“ Face detected\");\n      }\n      if (detections.length > 1) {\n        updateCheck(\"singlePerson\", \"error\", `âœ— ${detections.length} people detected`);\n        setCurrentIssues([\"Multiple people detected. Only you should be visible.\"]);\n        setConsecutiveSuccesses(0);\n        runningDetectionRef.current = false;\n        return;\n      } else {\n        updateCheck(\"singlePerson\", \"success\", \"âœ“ Single person confirmed\");\n      }\n      const detection = detections[0];\n\n      // lighting assessment (basic)\n      const lightingScore = detection.detection.score || 0;\n      if (lightingScore < 0.3) {\n        updateCheck(\"lighting\", \"warning\", \"âš  Poor lighting - improve lighting\");\n        issues.push(\"Lighting is poor. Improve lighting.\");\n      } else if (lightingScore < 0.6) {\n        updateCheck(\"lighting\", \"warning\", \"âš  Lighting could be better\");\n      } else {\n        updateCheck(\"lighting\", \"success\", \"âœ“ Lighting is good\");\n      }\n\n      // identity check (euclidean distance)\n      const distance = faceapi.euclideanDistance(registeredDescriptor, detection.descriptor);\n      const threshold = 0.60; // keep same threshold as before\n      const isMatch = distance < threshold;\n      const confidencePct = Math.round((1 - distance) * 100);\n      if (isMatch) {\n        updateCheck(\"identity\", \"success\", `âœ“ Identity match (${confidencePct}% confidence)`);\n        // increment consecutive successes (use updater to avoid race)\n        setConsecutiveSuccesses(prev => {\n          const next = Math.min(prev + 1, 3);\n          // if next reached 3, setCanProceed handled by effect\n          return next;\n        });\n        setCurrentIssues(issues);\n      } else {\n        updateCheck(\"identity\", \"error\", `âœ— Identity mismatch (${confidencePct}% match)`);\n        issues.push(\"Face doesn't match registered face.\");\n        setCurrentIssues(issues);\n        // reset consecutive successes on mismatch\n        setConsecutiveSuccesses(0);\n      }\n    } catch (err) {\n      console.error(\"performAllChecks error:\", err);\n      updateCheck(\"faceDetection\", \"error\", \"âœ— Detection error (check console)\");\n      setCurrentIssues([err.message || \"Detection error\"]);\n      setConsecutiveSuccesses(0);\n    } finally {\n      runningDetectionRef.current = false;\n    }\n  };\n\n  // Manual identity check button handler: run one detection iteration\n  const handleManualCheck = async () => {\n    if (canProceed) {\n      alert(\"Identity already verified â€” you can start the exam.\");\n      return;\n    }\n    setIsChecking(true);\n    await performAllChecks();\n    // After run, UI will update consecutiveSuccesses / issues accordingly.\n    if (consecutiveSuccesses >= 3) {\n      // handled by effect; show message\n      alert(\"âœ… Identity verified! You may start the exam now.\");\n    } else {\n      alert(`Manual check done. Verification progress: ${consecutiveSuccesses}/3`);\n    }\n  };\n  const handleProceed = () => {\n    if (!canProceed || consecutiveSuccesses < 3) {\n      alert(`Please complete identity verification (${consecutiveSuccesses}/3).`);\n      return;\n    }\n    stopDetectionInterval();\n    stopCamera();\n    onProceed && onProceed({\n      registeredDescriptor,\n      preCheckPassed: true\n    });\n  };\n  const handleCancel = () => {\n    stopDetectionInterval();\n    stopCamera();\n    onCancel && onCancel();\n  };\n\n  // UI helpers\n  const getStatusIcon = status => {\n    switch (status) {\n      case \"success\":\n        return \"âœ“\";\n      case \"error\":\n        return \"âœ—\";\n      case \"warning\":\n        return \"âš \";\n      case \"pending\":\n      default:\n        return \"â³\";\n    }\n  };\n  const statusClass = status => `check-item status-${status}`;\n\n  // render\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"pre-exam-setup\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"setup-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"setup-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"\\uD83D\\uDCF8 Pre-Exam System Check\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 387,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Please complete the identity verification (3 successful checks) before starting the exam.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 388,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            marginTop: \"1rem\",\n            padding: \"0.75rem\",\n            background: consecutiveSuccesses >= 3 ? \"#d1fae5\" : \"#fef3c7\",\n            borderRadius: \"8px\",\n            fontWeight: 600\n          },\n          children: consecutiveSuccesses >= 3 ? /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              color: \"#059669\"\n            },\n            children: [\"\\u2705 Verification Complete (\", consecutiveSuccesses, \"/3)\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 400,\n            columnNumber: 15\n          }, this) : /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              color: \"#d97706\"\n            },\n            children: [\"\\u23F3 Verifying... (\", consecutiveSuccesses, \"/3)\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 402,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 390,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            marginTop: \"0.75rem\"\n          },\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleManualCheck,\n            disabled: canProceed,\n            style: {\n              padding: \"0.5rem 1rem\",\n              background: canProceed ? \"#10b981\" : \"#3b82f6\",\n              color: \"white\",\n              border: \"none\",\n              borderRadius: \"6px\",\n              cursor: canProceed ? \"not-allowed\" : \"pointer\",\n              fontSize: \"0.95rem\"\n            },\n            children: canProceed ? \"âœ… Identity Verified\" : \"ðŸ” Manual Identity Test\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 408,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 407,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 386,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"setup-content\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"camera-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"camera-preview\",\n            children: [/*#__PURE__*/_jsxDEV(\"video\", {\n              ref: videoRef,\n              autoPlay: true,\n              muted: true,\n              playsInline: true,\n              className: \"preview-video\",\n              style: {\n                width: \"100%\",\n                maxWidth: 480,\n                borderRadius: 8\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 429,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n              ref: canvasRef,\n              className: \"preview-canvas\",\n              style: {\n                width: \"100%\",\n                maxWidth: 480\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 437,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 428,\n            columnNumber: 13\n          }, this), currentIssues.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"current-issues\",\n            children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n              children: \"\\u26A0 Current Issues\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 442,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n              children: currentIssues.map((it, idx) => /*#__PURE__*/_jsxDEV(\"li\", {\n                children: it\n              }, idx, false, {\n                fileName: _jsxFileName,\n                lineNumber: 445,\n                columnNumber: 21\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 443,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 441,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 427,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"checks-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"System Checks\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 453,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"checks-list\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: statusClass(checks.camera.status),\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"check-icon\",\n                children: getStatusIcon(checks.camera.status)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 456,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"check-message\",\n                children: checks.camera.message\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 457,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 455,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: statusClass(checks.models.status),\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"check-icon\",\n                children: getStatusIcon(checks.models.status)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 461,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"check-message\",\n                children: checks.models.message\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 462,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 460,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: statusClass(checks.faceDetection.status),\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"check-icon\",\n                children: getStatusIcon(checks.faceDetection.status)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 466,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"check-message\",\n                children: checks.faceDetection.message\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 467,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 465,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: statusClass(checks.singlePerson.status),\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"check-icon\",\n                children: getStatusIcon(checks.singlePerson.status)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 471,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"check-message\",\n                children: checks.singlePerson.message\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 472,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 470,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: statusClass(checks.lighting.status),\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"check-icon\",\n                children: getStatusIcon(checks.lighting.status)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 476,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"check-message\",\n                children: checks.lighting.message\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 477,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 475,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: statusClass(checks.identity.status),\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"check-icon\",\n                children: getStatusIcon(checks.identity.status)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 481,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"check-message\",\n                children: checks.identity.message\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 482,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 480,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 454,\n            columnNumber: 13\n          }, this), isChecking && consecutiveSuccesses < 3 && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"verification-progress\",\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              children: [\"Verifying identity... \", consecutiveSuccesses, \"/3 successful consecutive checks\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 488,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"progress-bar\",\n              style: {\n                width: \"100%\",\n                background: \"#eee\",\n                borderRadius: 6\n              },\n              children: /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"progress-fill\",\n                style: {\n                  width: `${Math.min(consecutiveSuccesses / 3 * 100, 100)}%`,\n                  height: 8,\n                  borderRadius: 6,\n                  background: \"#10b981\"\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 492,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 491,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              style: {\n                fontSize: 13,\n                color: \"#666\",\n                marginTop: 6\n              },\n              children: \"Keep your face steady and centered. Progress resets on mismatch.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 502,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 487,\n            columnNumber: 15\n          }, this), consecutiveSuccesses >= 3 && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"verification-complete\",\n            children: /*#__PURE__*/_jsxDEV(\"p\", {\n              children: \"\\u2705 Identity verification complete \\u2014 you may start the exam.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 510,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 509,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 452,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 426,\n        columnNumber: 9\n      }, this), examDetails && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"exam-info\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Exam Details\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 518,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"exam-details-grid\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"detail-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"detail-label\",\n              children: \"Title:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 521,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"detail-value\",\n              children: examDetails.title\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 522,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 520,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"detail-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"detail-label\",\n              children: \"Questions:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 525,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"detail-value\",\n              children: ((_examDetails$question = examDetails.questions) === null || _examDetails$question === void 0 ? void 0 : _examDetails$question.length) || 0\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 526,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 524,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"detail-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"detail-label\",\n              children: \"Duration:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 529,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"detail-value\",\n              children: [examDetails.durationMins || 30, \" minutes\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 530,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 528,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 519,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 517,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"setup-instructions\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          children: \"\\uD83D\\uDCA1 Setup Tips:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 537,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          children: [/*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"Ensure you're in a well-lit room\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 539,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"Position your face clearly in front of the camera\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 540,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"Be alone - no one else should be visible\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 541,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"Remove glasses or accessories if they block your face\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 542,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"Keep your face steady during verification\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 543,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"Close unnecessary browser tabs\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 544,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 538,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 536,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"setup-actions\",\n        style: {\n          marginTop: 12\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleCancel,\n          className: \"btn-cancel\",\n          children: \"Cancel\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 549,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleProceed,\n          className: \"btn-proceed\",\n          disabled: !canProceed || consecutiveSuccesses < 3,\n          style: {\n            marginLeft: 8,\n            background: canProceed ? \"#10b981\" : \"#94a3b8\",\n            color: \"white\",\n            border: \"none\",\n            padding: \"0.6rem 1rem\",\n            borderRadius: 6,\n            cursor: canProceed ? \"pointer\" : \"not-allowed\"\n          },\n          children: canProceed ? `âœ“ Start Exam (${consecutiveSuccesses}/3)` : `â—‹ Waiting (${consecutiveSuccesses}/3)`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 553,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 548,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 385,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 384,\n    columnNumber: 5\n  }, this);\n}\n_s(PreExamSetup, \"BM43+ahGGxx96IIe7oedzIXJVSw=\", false, function () {\n  return [useNavigate];\n});\n_c = PreExamSetup;\nvar _c;\n$RefreshReg$(_c, \"PreExamSetup\");","map":{"version":3,"names":["React","useEffect","useRef","useState","faceapi","useNavigate","jsxDEV","_jsxDEV","PreExamSetup","user","examId","examDetails","onProceed","onCancel","_s","_examDetails$question","videoRef","canvasRef","modelsLoadedRef","detectionIntervalRef","runningDetectionRef","registeredDescriptor","setRegisteredDescriptor","checks","setChecks","camera","status","message","models","faceDetection","lighting","identity","singlePerson","verificationAttempts","setVerificationAttempts","consecutiveSuccesses","setConsecutiveSuccesses","canProceed","setCanProceed","currentIssues","setCurrentIssues","isChecking","setIsChecking","navigate","startSystemCheck","stopDetectionInterval","stopCamera","updateCheck","key","prev","current","srcObject","getTracks","forEach","t","stop","e","clearInterval","camOk","requestCamera","modelsOk","loadModels","faceOk","fetchRegisteredDescriptor","waitForVideoReady","performAllChecks","setInterval","stream","navigator","mediaDevices","getUserMedia","video","width","ideal","height","facingMode","audio","Promise","resolve","onloadedmetadata","play","err","console","error","alert","check","readyState","videoWidth","videoHeight","setTimeout","MODEL_URL","process","env","PUBLIC_URL","all","nets","tinyFaceDetector","loadFromUri","faceLandmark68Net","faceRecognitionNet","token","localStorage","getItem","res","fetch","headers","Authorization","ok","Error","data","json","faceDescriptor","length","Float32Array","a","options","TinyFaceDetectorOptions","inputSize","scoreThreshold","detectionPromise","detectAllFaces","withFaceLandmarks","withFaceDescriptors","timeoutMs","timeoutPromise","_","rej","detections","race","dims","matchDimensions","resized","resizeResults","ctx","getContext","clearRect","draw","drawDetections","drawFaceLandmarks","warn","issues","detection","lightingScore","score","push","distance","euclideanDistance","descriptor","threshold","isMatch","confidencePct","Math","round","next","min","handleManualCheck","handleProceed","preCheckPassed","handleCancel","getStatusIcon","statusClass","className","children","fileName","_jsxFileName","lineNumber","columnNumber","style","marginTop","padding","background","borderRadius","fontWeight","color","onClick","disabled","border","cursor","fontSize","ref","autoPlay","muted","playsInline","maxWidth","map","it","idx","title","questions","durationMins","marginLeft","_c","$RefreshReg$"],"sources":["C:/Online Exam Proctoring System/frontend/src/components/PreExamSetup.js"],"sourcesContent":["// PreExamSetup.js\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport * as faceapi from \"face-api.js\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport \"./PreExamSetup.css\";\r\n\r\nexport default function PreExamSetup({ user, examId, examDetails, onProceed, onCancel }) {\r\n  const videoRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n\r\n  // loaded resources & refs\r\n  const modelsLoadedRef = useRef(false);\r\n  const detectionIntervalRef = useRef(null);\r\n  const runningDetectionRef = useRef(false); // prevents overlapping detection runs\r\n\r\n  // registered face descriptor\r\n  const [registeredDescriptor, setRegisteredDescriptor] = useState(null);\r\n\r\n  // checks UI/state\r\n  const [checks, setChecks] = useState({\r\n    camera: { status: \"pending\", message: \"Checking camera access...\" },\r\n    models: { status: \"pending\", message: \"Loading face detection models...\" },\r\n    faceDetection: { status: \"pending\", message: \"Waiting for face detection...\" },\r\n    lighting: { status: \"pending\", message: \"Checking lighting conditions...\" },\r\n    identity: { status: \"pending\", message: \"Verifying your identity...\" },\r\n    singlePerson: { status: \"pending\", message: \"Checking for single person...\" },\r\n  });\r\n\r\n  // Verification counters\r\n  const [verificationAttempts, setVerificationAttempts] = useState(0); // total attempts made\r\n  const [consecutiveSuccesses, setConsecutiveSuccesses] = useState(0); // counts only consecutive verified runs\r\n  const [canProceed, setCanProceed] = useState(false);\r\n  const [currentIssues, setCurrentIssues] = useState([]);\r\n  const [isChecking, setIsChecking] = useState(true);\r\n\r\n  const navigate = useNavigate();\r\n\r\n  // --- Lifecycle ---\r\n  useEffect(() => {\r\n    startSystemCheck();\r\n\r\n    // cleanup\r\n    return () => {\r\n      stopDetectionInterval();\r\n      stopCamera();\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  // When consecutive successes reach 3, mark ready and stop detection\r\n  useEffect(() => {\r\n    if (consecutiveSuccesses >= 3 && !canProceed) {\r\n      setCanProceed(true);\r\n      setIsChecking(false);\r\n      stopDetectionInterval();\r\n      updateCheck(\"identity\", \"success\", `âœ“ Identity verified (${consecutiveSuccesses}/3)`);\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [consecutiveSuccesses]);\r\n\r\n  // --- Helpers ---\r\n  const updateCheck = (key, status, message) => {\r\n    setChecks((prev) => ({ ...prev, [key]: { status, message } }));\r\n  };\r\n\r\n  const stopCamera = () => {\r\n    if (videoRef.current && videoRef.current.srcObject) {\r\n      try {\r\n        videoRef.current.srcObject.getTracks().forEach((t) => t.stop());\r\n      } catch (e) {\r\n        // ignore\r\n      }\r\n      videoRef.current.srcObject = null;\r\n    }\r\n  };\r\n\r\n  const stopDetectionInterval = () => {\r\n    if (detectionIntervalRef.current) {\r\n      clearInterval(detectionIntervalRef.current);\r\n      detectionIntervalRef.current = null;\r\n    }\r\n  };\r\n\r\n  // --- Start sequence ---\r\n  const startSystemCheck = async () => {\r\n    setIsChecking(true);\r\n    setConsecutiveSuccesses(0);\r\n    setVerificationAttempts(0);\r\n    setCurrentIssues([]);\r\n\r\n    // camera\r\n    const camOk = await requestCamera();\r\n    if (!camOk) return;\r\n\r\n    // models\r\n    const modelsOk = await loadModels();\r\n    if (!modelsOk) return;\r\n\r\n    // registered descriptor\r\n    const faceOk = await fetchRegisteredDescriptor();\r\n    if (!faceOk) return;\r\n\r\n    // wait for video metadata to be ready\r\n    await waitForVideoReady();\r\n\r\n    // start continuous detection every 1.5s\r\n    performAllChecks(); // run first immediately after ready\r\n    detectionIntervalRef.current = setInterval(() => {\r\n      performAllChecks();\r\n    }, 1500);\r\n  };\r\n\r\n  // --- Camera ---\r\n  const requestCamera = async () => {\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        video: { width: { ideal: 640 }, height: { ideal: 480 }, facingMode: \"user\" },\r\n        audio: false,\r\n      });\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n        await new Promise((resolve) => {\r\n          videoRef.current.onloadedmetadata = () => {\r\n            try {\r\n              videoRef.current.play();\r\n            } catch (e) {}\r\n            resolve();\r\n          };\r\n        });\r\n        updateCheck(\"camera\", \"success\", \"âœ“ Camera connected\");\r\n        return true;\r\n      }\r\n      updateCheck(\"camera\", \"error\", \"âœ— Camera element missing\");\r\n      return false;\r\n    } catch (err) {\r\n      console.error(\"Camera error:\", err);\r\n      updateCheck(\"camera\", \"error\", \"âœ— Camera access denied or not found\");\r\n      alert(\"Please enable camera access and reload.\");\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const waitForVideoReady = () => {\r\n    return new Promise((resolve) => {\r\n      const check = () => {\r\n        if (videoRef.current && (videoRef.current.readyState >= 3)) {\r\n          // set canvas size once\r\n          if (canvasRef.current && videoRef.current) {\r\n            canvasRef.current.width = videoRef.current.videoWidth || 640;\r\n            canvasRef.current.height = videoRef.current.videoHeight || 480;\r\n          }\r\n          resolve();\r\n        } else {\r\n          setTimeout(check, 100);\r\n        }\r\n      };\r\n      check();\r\n    });\r\n  };\r\n\r\n  // --- Models ---\r\n  const loadModels = async () => {\r\n    try {\r\n      const MODEL_URL = process.env.PUBLIC_URL + \"/models\";\r\n      // load required face-api models\r\n      await Promise.all([\r\n        faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),\r\n        faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\r\n        faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL),\r\n      ]);\r\n      modelsLoadedRef.current = true;\r\n      updateCheck(\"models\", \"success\", \"âœ“ Detection models loaded\");\r\n      return true;\r\n    } catch (err) {\r\n      console.error(\"Model load error:\", err);\r\n      updateCheck(\"models\", \"error\", \"âœ— Failed to load detection models\");\r\n      alert(\"Model files missing. Put models into /public/models folder.\");\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // --- Registered descriptor fetch ---\r\n  const fetchRegisteredDescriptor = async () => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      const res = await fetch(\"http://localhost:4000/api/auth/face-descriptor\", {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n      if (!res.ok) throw new Error(\"Not registered\");\r\n      const data = await res.json();\r\n      if (!data?.faceDescriptor || data.faceDescriptor.length !== 128) throw new Error(\"Invalid descriptor\");\r\n      setRegisteredDescriptor(new Float32Array(data.faceDescriptor));\r\n      return true;\r\n    } catch (err) {\r\n      console.error(\"Registered face fetch error:\", err);\r\n      updateCheck(\"identity\", \"error\", \"âœ— Face not registered. Please register first.\");\r\n      alert(\"You must register your face before taking the exam.\");\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // --- Core detection logic ---\r\n  // uses consecutiveSuccesses: increments on match, resets on mismatch or other issues\r\n  const performAllChecks = async () => {\r\n    // prevent overlapping runs\r\n    if (runningDetectionRef.current) return;\r\n    runningDetectionRef.current = true;\r\n\r\n    try {\r\n      // Basic readiness\r\n      if (!videoRef.current || !canvasRef.current) {\r\n        updateCheck(\"faceDetection\", \"pending\", \"Waiting for video/canvas...\");\r\n        runningDetectionRef.current = false;\r\n        return;\r\n      }\r\n      if (!modelsLoadedRef.current) {\r\n        updateCheck(\"models\", \"pending\", \"Loading models...\");\r\n        runningDetectionRef.current = false;\r\n        return;\r\n      }\r\n      if (!registeredDescriptor) {\r\n        updateCheck(\"identity\", \"pending\", \"Registered face missing...\");\r\n        runningDetectionRef.current = false;\r\n        return;\r\n      }\r\n      // video readyState check\r\n      if (videoRef.current.readyState < 3) {\r\n        updateCheck(\"faceDetection\", \"pending\", \"Video not ready yet...\");\r\n        runningDetectionRef.current = false;\r\n        return;\r\n      }\r\n\r\n      // increment attempt\r\n      setVerificationAttempts((a) => a + 1);\r\n\r\n      // detect\r\n      const options = new faceapi.TinyFaceDetectorOptions({ inputSize: 224, scoreThreshold: 0.5 });\r\n      const detectionPromise = faceapi\r\n        .detectAllFaces(videoRef.current, options)\r\n        .withFaceLandmarks()\r\n        .withFaceDescriptors();\r\n\r\n      // timeout safety\r\n      const timeoutMs = 8000;\r\n      const timeoutPromise = new Promise((_, rej) => setTimeout(() => rej(new Error(\"detection-timeout\")), timeoutMs));\r\n      const detections = await Promise.race([detectionPromise, timeoutPromise]);\r\n\r\n      // draw results to canvas\r\n      try {\r\n        const dims = faceapi.matchDimensions(canvasRef.current, videoRef.current, true);\r\n        const resized = faceapi.resizeResults(detections, dims);\r\n        const ctx = canvasRef.current.getContext(\"2d\");\r\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\r\n        faceapi.draw.drawDetections(canvasRef.current, resized);\r\n        faceapi.draw.drawFaceLandmarks(canvasRef.current, resized);\r\n      } catch (e) {\r\n        // swallow drawing errors, continue\r\n        console.warn(\"Canvas draw failed:\", e);\r\n      }\r\n\r\n      // checks\r\n      const issues = [];\r\n      if (!detections || detections.length === 0) {\r\n        updateCheck(\"faceDetection\", \"warning\", \"âš  No face detected\");\r\n        updateCheck(\"identity\", \"pending\", \"Waiting for face...\");\r\n        updateCheck(\"singlePerson\", \"pending\", \"Waiting for face...\");\r\n        updateCheck(\"lighting\", \"pending\", \"Waiting for face...\");\r\n        setCurrentIssues([\"Position your face in front of the camera\"]);\r\n        // reset consecutive successes\r\n        setConsecutiveSuccesses(0);\r\n        runningDetectionRef.current = false;\r\n        return;\r\n      } else {\r\n        updateCheck(\"faceDetection\", \"success\", \"âœ“ Face detected\");\r\n      }\r\n\r\n      if (detections.length > 1) {\r\n        updateCheck(\"singlePerson\", \"error\", `âœ— ${detections.length} people detected`);\r\n        setCurrentIssues([\"Multiple people detected. Only you should be visible.\"]);\r\n        setConsecutiveSuccesses(0);\r\n        runningDetectionRef.current = false;\r\n        return;\r\n      } else {\r\n        updateCheck(\"singlePerson\", \"success\", \"âœ“ Single person confirmed\");\r\n      }\r\n\r\n      const detection = detections[0];\r\n\r\n      // lighting assessment (basic)\r\n      const lightingScore = detection.detection.score || 0;\r\n      if (lightingScore < 0.3) {\r\n        updateCheck(\"lighting\", \"warning\", \"âš  Poor lighting - improve lighting\");\r\n        issues.push(\"Lighting is poor. Improve lighting.\");\r\n      } else if (lightingScore < 0.6) {\r\n        updateCheck(\"lighting\", \"warning\", \"âš  Lighting could be better\");\r\n      } else {\r\n        updateCheck(\"lighting\", \"success\", \"âœ“ Lighting is good\");\r\n      }\r\n\r\n      // identity check (euclidean distance)\r\n      const distance = faceapi.euclideanDistance(registeredDescriptor, detection.descriptor);\r\n      const threshold = 0.60; // keep same threshold as before\r\n      const isMatch = distance < threshold;\r\n      const confidencePct = Math.round((1 - distance) * 100);\r\n\r\n      if (isMatch) {\r\n        updateCheck(\"identity\", \"success\", `âœ“ Identity match (${confidencePct}% confidence)`);\r\n        // increment consecutive successes (use updater to avoid race)\r\n        setConsecutiveSuccesses((prev) => {\r\n          const next = Math.min(prev + 1, 3);\r\n          // if next reached 3, setCanProceed handled by effect\r\n          return next;\r\n        });\r\n        setCurrentIssues(issues);\r\n      } else {\r\n        updateCheck(\"identity\", \"error\", `âœ— Identity mismatch (${confidencePct}% match)`);\r\n        issues.push(\"Face doesn't match registered face.\");\r\n        setCurrentIssues(issues);\r\n        // reset consecutive successes on mismatch\r\n        setConsecutiveSuccesses(0);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"performAllChecks error:\", err);\r\n      updateCheck(\"faceDetection\", \"error\", \"âœ— Detection error (check console)\");\r\n      setCurrentIssues([err.message || \"Detection error\"]);\r\n      setConsecutiveSuccesses(0);\r\n    } finally {\r\n      runningDetectionRef.current = false;\r\n    }\r\n  };\r\n\r\n  // Manual identity check button handler: run one detection iteration\r\n  const handleManualCheck = async () => {\r\n    if (canProceed) {\r\n      alert(\"Identity already verified â€” you can start the exam.\");\r\n      return;\r\n    }\r\n    setIsChecking(true);\r\n    await performAllChecks();\r\n    // After run, UI will update consecutiveSuccesses / issues accordingly.\r\n    if (consecutiveSuccesses >= 3) {\r\n      // handled by effect; show message\r\n      alert(\"âœ… Identity verified! You may start the exam now.\");\r\n    } else {\r\n      alert(`Manual check done. Verification progress: ${consecutiveSuccesses}/3`);\r\n    }\r\n  };\r\n\r\n  const handleProceed = () => {\r\n    if (!canProceed || consecutiveSuccesses < 3) {\r\n      alert(`Please complete identity verification (${consecutiveSuccesses}/3).`);\r\n      return;\r\n    }\r\n    stopDetectionInterval();\r\n    stopCamera();\r\n    onProceed && onProceed({ registeredDescriptor, preCheckPassed: true });\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    stopDetectionInterval();\r\n    stopCamera();\r\n    onCancel && onCancel();\r\n  };\r\n\r\n  // UI helpers\r\n  const getStatusIcon = (status) => {\r\n    switch (status) {\r\n      case \"success\":\r\n        return \"âœ“\";\r\n      case \"error\":\r\n        return \"âœ—\";\r\n      case \"warning\":\r\n        return \"âš \";\r\n      case \"pending\":\r\n      default:\r\n        return \"â³\";\r\n    }\r\n  };\r\n\r\n  const statusClass = (status) => `check-item status-${status}`;\r\n\r\n  // render\r\n  return (\r\n    <div className=\"pre-exam-setup\">\r\n      <div className=\"setup-container\">\r\n        <div className=\"setup-header\">\r\n          <h2>ðŸ“¸ Pre-Exam System Check</h2>\r\n          <p>Please complete the identity verification (3 successful checks) before starting the exam.</p>\r\n\r\n          <div\r\n            style={{\r\n              marginTop: \"1rem\",\r\n              padding: \"0.75rem\",\r\n              background: consecutiveSuccesses >= 3 ? \"#d1fae5\" : \"#fef3c7\",\r\n              borderRadius: \"8px\",\r\n              fontWeight: 600,\r\n            }}\r\n          >\r\n            {consecutiveSuccesses >= 3 ? (\r\n              <span style={{ color: \"#059669\" }}>âœ… Verification Complete ({consecutiveSuccesses}/3)</span>\r\n            ) : (\r\n              <span style={{ color: \"#d97706\" }}>â³ Verifying... ({consecutiveSuccesses}/3)</span>\r\n            )}\r\n          </div>\r\n\r\n          {/* Manual identity check - runs one detection iteration */}\r\n          <div style={{ marginTop: \"0.75rem\" }}>\r\n            <button\r\n              onClick={handleManualCheck}\r\n              disabled={canProceed}\r\n              style={{\r\n                padding: \"0.5rem 1rem\",\r\n                background: canProceed ? \"#10b981\" : \"#3b82f6\",\r\n                color: \"white\",\r\n                border: \"none\",\r\n                borderRadius: \"6px\",\r\n                cursor: canProceed ? \"not-allowed\" : \"pointer\",\r\n                fontSize: \"0.95rem\",\r\n              }}\r\n            >\r\n              {canProceed ? \"âœ… Identity Verified\" : \"ðŸ” Manual Identity Test\"}\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"setup-content\">\r\n          <div className=\"camera-section\">\r\n            <div className=\"camera-preview\">\r\n              <video\r\n                ref={videoRef}\r\n                autoPlay\r\n                muted\r\n                playsInline\r\n                className=\"preview-video\"\r\n                style={{ width: \"100%\", maxWidth: 480, borderRadius: 8 }}\r\n              />\r\n              <canvas ref={canvasRef} className=\"preview-canvas\" style={{ width: \"100%\", maxWidth: 480 }} />\r\n            </div>\r\n\r\n            {currentIssues.length > 0 && (\r\n              <div className=\"current-issues\">\r\n                <h4>âš  Current Issues</h4>\r\n                <ul>\r\n                  {currentIssues.map((it, idx) => (\r\n                    <li key={idx}>{it}</li>\r\n                  ))}\r\n                </ul>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"checks-section\">\r\n            <h3>System Checks</h3>\r\n            <div className=\"checks-list\">\r\n              <div className={statusClass(checks.camera.status)}>\r\n                <span className=\"check-icon\">{getStatusIcon(checks.camera.status)}</span>\r\n                <span className=\"check-message\">{checks.camera.message}</span>\r\n              </div>\r\n\r\n              <div className={statusClass(checks.models.status)}>\r\n                <span className=\"check-icon\">{getStatusIcon(checks.models.status)}</span>\r\n                <span className=\"check-message\">{checks.models.message}</span>\r\n              </div>\r\n\r\n              <div className={statusClass(checks.faceDetection.status)}>\r\n                <span className=\"check-icon\">{getStatusIcon(checks.faceDetection.status)}</span>\r\n                <span className=\"check-message\">{checks.faceDetection.message}</span>\r\n              </div>\r\n\r\n              <div className={statusClass(checks.singlePerson.status)}>\r\n                <span className=\"check-icon\">{getStatusIcon(checks.singlePerson.status)}</span>\r\n                <span className=\"check-message\">{checks.singlePerson.message}</span>\r\n              </div>\r\n\r\n              <div className={statusClass(checks.lighting.status)}>\r\n                <span className=\"check-icon\">{getStatusIcon(checks.lighting.status)}</span>\r\n                <span className=\"check-message\">{checks.lighting.message}</span>\r\n              </div>\r\n\r\n              <div className={statusClass(checks.identity.status)}>\r\n                <span className=\"check-icon\">{getStatusIcon(checks.identity.status)}</span>\r\n                <span className=\"check-message\">{checks.identity.message}</span>\r\n              </div>\r\n            </div>\r\n\r\n            {isChecking && consecutiveSuccesses < 3 && (\r\n              <div className=\"verification-progress\">\r\n                <p>\r\n                  Verifying identity... {consecutiveSuccesses}/3 successful consecutive checks\r\n                </p>\r\n                <div className=\"progress-bar\" style={{ width: \"100%\", background: \"#eee\", borderRadius: 6 }}>\r\n                  <div\r\n                    className=\"progress-fill\"\r\n                    style={{\r\n                      width: `${Math.min((consecutiveSuccesses / 3) * 100, 100)}%`,\r\n                      height: 8,\r\n                      borderRadius: 6,\r\n                      background: \"#10b981\",\r\n                    }}\r\n                  />\r\n                </div>\r\n                <p style={{ fontSize: 13, color: \"#666\", marginTop: 6 }}>\r\n                  Keep your face steady and centered. Progress resets on mismatch.\r\n                </p>\r\n              </div>\r\n            )}\r\n\r\n            {consecutiveSuccesses >= 3 && (\r\n              <div className=\"verification-complete\">\r\n                <p>âœ… Identity verification complete â€” you may start the exam.</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {examDetails && (\r\n          <div className=\"exam-info\">\r\n            <h3>Exam Details</h3>\r\n            <div className=\"exam-details-grid\">\r\n              <div className=\"detail-item\">\r\n                <span className=\"detail-label\">Title:</span>\r\n                <span className=\"detail-value\">{examDetails.title}</span>\r\n              </div>\r\n              <div className=\"detail-item\">\r\n                <span className=\"detail-label\">Questions:</span>\r\n                <span className=\"detail-value\">{examDetails.questions?.length || 0}</span>\r\n              </div>\r\n              <div className=\"detail-item\">\r\n                <span className=\"detail-label\">Duration:</span>\r\n                <span className=\"detail-value\">{examDetails.durationMins || 30} minutes</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"setup-instructions\">\r\n          <h4>ðŸ’¡ Setup Tips:</h4>\r\n          <ul>\r\n            <li>Ensure you're in a well-lit room</li>\r\n            <li>Position your face clearly in front of the camera</li>\r\n            <li>Be alone - no one else should be visible</li>\r\n            <li>Remove glasses or accessories if they block your face</li>\r\n            <li>Keep your face steady during verification</li>\r\n            <li>Close unnecessary browser tabs</li>\r\n          </ul>\r\n        </div>\r\n\r\n        <div className=\"setup-actions\" style={{ marginTop: 12 }}>\r\n          <button onClick={handleCancel} className=\"btn-cancel\">\r\n            Cancel\r\n          </button>\r\n\r\n          <button\r\n            onClick={handleProceed}\r\n            className=\"btn-proceed\"\r\n            disabled={!canProceed || consecutiveSuccesses < 3}\r\n            style={{\r\n              marginLeft: 8,\r\n              background: canProceed ? \"#10b981\" : \"#94a3b8\",\r\n              color: \"white\",\r\n              border: \"none\",\r\n              padding: \"0.6rem 1rem\",\r\n              borderRadius: 6,\r\n              cursor: canProceed ? \"pointer\" : \"not-allowed\",\r\n            }}\r\n          >\r\n            {canProceed ? `âœ“ Start Exam (${consecutiveSuccesses}/3)` : `â—‹ Waiting (${consecutiveSuccesses}/3)`}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}