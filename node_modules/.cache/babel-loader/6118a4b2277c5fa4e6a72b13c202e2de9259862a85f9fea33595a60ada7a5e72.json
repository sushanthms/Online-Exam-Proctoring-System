{"ast":null,"code":"import _objectSpread from\"C:/Online Exam Proctoring System/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// frontend/src/components/PreExamSetup.js - FIXED VERSION WITH IMPROVED VERIFICATION\nimport React,{useEffect,useRef,useState}from\"react\";import*as faceapi from\"face-api.js\";import{useNavigate,useParams}from\"react-router-dom\";import ThemeToggle from\"./ThemeToggle\";import\"./PreExamSetup.css\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function PreExamSetup(_ref){var _examDetails$question;let{user}=_ref;const{examId}=useParams();const videoRef=useRef(null);const canvasRef=useRef(null);const navigate=useNavigate();const verificationAttempts=useRef(0);const[status,setStatus]=useState(\"initializing\");const[message,setMessage]=useState(\"Initializing system...\");const[checks,setChecks]=useState({camera:{status:\"pending\",message:\"Checking camera...\",icon:\"üì∑\"},lighting:{status:\"pending\",message:\"Checking lighting...\",icon:\"üí°\"},faceDetection:{status:\"pending\",message:\"Detecting face...\",icon:\"üë§\"},faceVerification:{status:\"pending\",message:\"Verifying identity...\",icon:\"üîê\"},environment:{status:\"pending\",message:\"Checking environment...\",icon:\"üåç\"}});const[modelsLoaded,setModelsLoaded]=useState(false);const[registeredDescriptor,setRegisteredDescriptor]=useState(null);const[allChecksPassed,setAllChecksPassed]=useState(false);const[examDetails,setExamDetails]=useState(null);const[isManualCheck,setIsManualCheck]=useState(false);const[currentFaceMatch,setCurrentFaceMatch]=useState(null);const[verificationScore,setVerificationScore]=useState(0);const[startButtonEnabled,setStartButtonEnabled]=useState(false);// BALANCED THRESHOLD - Ensure proper verification while avoiding false rejections\nconst VERIFICATION_THRESHOLD=0.6;// Increased from 0.45 for more lenient verification\nconst MIN_ACCEPTABLE_DISTANCE=0.7;// Warning threshold increased from 0.55\nuseEffect(()=>{initializePreExam();return()=>stopCamera();},[]);const initializePreExam=async()=>{try{setStatus(\"initializing\");setMessage(\"Loading system components...\");// Check if face is registered first\nconst faceStatus=await checkFaceRegistrationStatus();if(!faceStatus){setStatus(\"error\");setMessage(\"Face not registered. Please register your face first.\");setTimeout(()=>{navigate(\"/face-registration\");},3000);return;}// Load exam details\nawait fetchExamDetails();// Load face-api models\nawait loadModels();// Load registered face descriptor\nawait loadRegisteredFace();// Start camera\nawait startCamera();// Run all checks\nawait runAllChecks();}catch(error){console.error(\"Initialization error:\",error);setStatus(\"error\");setMessage(error.message||\"System initialization failed\");}};const checkFaceRegistrationStatus=async()=>{try{const token=localStorage.getItem(\"token\");const response=await fetch(\"http://localhost:4000/api/auth/face-status\",{headers:{Authorization:\"Bearer \".concat(token)}});if(response.ok){const data=await response.json();return data.isFaceRegistered;}return false;}catch(error){console.error(\"Error checking face registration:\",error);return false;}};const fetchExamDetails=async()=>{try{const token=localStorage.getItem(\"token\");const response=await fetch(\"http://localhost:4000/api/exam/paper/\".concat(examId),{headers:{Authorization:\"Bearer \".concat(token)}});if(response.ok){const data=await response.json();setExamDetails(data);}else{throw new Error(\"Failed to load exam details\");}}catch(error){throw new Error(\"Cannot load exam. Please try again.\");}};const loadModels=async()=>{try{updateCheck(\"camera\",\"pending\",\"Loading face detection models...\");const MODEL_URL=process.env.PUBLIC_URL+\"/models\";await Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)]);setModelsLoaded(true);console.log(\"‚úÖ Face detection models loaded successfully\");}catch(error){console.error(\"Model loading error:\",error);throw new Error(\"Failed to load face detection models. Please refresh the page.\");}};const loadRegisteredFace=async()=>{try{updateCheck(\"faceVerification\",\"pending\",\"Loading your registered face data...\");const token=localStorage.getItem(\"token\");const response=await fetch(\"http://localhost:4000/api/auth/face-descriptor\",{headers:{Authorization:\"Bearer \".concat(token)}});if(response.ok){const data=await response.json();if(data.faceDescriptor&&Array.isArray(data.faceDescriptor)&&data.faceDescriptor.length===128){setRegisteredDescriptor(new Float32Array(data.faceDescriptor));console.log(\"‚úÖ Registered face data loaded\");}else{throw new Error(\"Invalid face descriptor format\");}}else{throw new Error(\"Face not registered\");}}catch(error){updateCheck(\"faceVerification\",\"failed\",\"‚ùå Face not registered. Please register first.\");throw new Error(\"Please register your face before taking exams\");}};const startCamera=async()=>{try{updateCheck(\"camera\",\"pending\",\"Starting camera...\");const stream=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280},height:{ideal:720},facingMode:\"user\"}});if(videoRef.current){videoRef.current.srcObject=stream;// Wait for video to be ready\nawait new Promise(resolve=>{videoRef.current.onloadedmetadata=()=>{videoRef.current.play();resolve();};});updateCheck(\"camera\",\"passed\",\"‚úÖ Camera is working properly\");console.log(\"‚úÖ Camera started successfully\");}}catch(error){console.error(\"Camera error:\",error);updateCheck(\"camera\",\"failed\",\"‚ùå Cannot access camera. Please grant permission.\");throw new Error(\"Camera access denied. Please enable camera in browser settings.\");}};const stopCamera=()=>{if(videoRef.current&&videoRef.current.srcObject){videoRef.current.srcObject.getTracks().forEach(track=>track.stop());console.log(\"üõë Camera stopped\");}};const updateCheck=(checkName,status,message)=>{setChecks(prev=>_objectSpread(_objectSpread({},prev),{},{[checkName]:_objectSpread(_objectSpread({},prev[checkName]),{},{status,message})}));};const runAllChecks=async()=>{setStatus(\"checking\");setMessage(\"Running comprehensive pre-exam verification...\");try{// Wait a moment for camera to stabilize\nawait new Promise(resolve=>setTimeout(resolve,2000));// Check lighting\nawait checkLighting();await new Promise(resolve=>setTimeout(resolve,500));// Check face detection and verification (most important)\nconst faceCheckPassed=await checkFaceDetectionAndVerification();if(!faceCheckPassed){setStatus(\"incomplete\");setMessage(\"‚ö†Ô∏è Please adjust position and lighting for better verification\");setAllChecksPassed(false);return;}await new Promise(resolve=>setTimeout(resolve,500));// Check environment\nawait checkEnvironment();// Final verification\nconst allPassed=Object.values(checks).every(check=>check.status===\"passed\"||check.status===\"warning\");setAllChecksPassed(allPassed&&faceCheckPassed);if(allPassed&&faceCheckPassed){setStatus(\"ready\");setMessage(\"‚úÖ All checks passed! Identity verified. You're ready to start the exam.\");}else{setStatus(\"incomplete\");setMessage(\"‚ö†Ô∏è Please resolve all issues before proceeding.\");}}catch(error){console.error(\"Check error:\",error);setStatus(\"error\");setMessage(\"Error during verification: \"+error.message);}};const checkLighting=async()=>{try{updateCheck(\"lighting\",\"pending\",\"Analyzing lighting conditions...\");if(!videoRef.current){updateCheck(\"lighting\",\"failed\",\"‚ùå Video not ready\");return;}const canvas=document.createElement(\"canvas\");canvas.width=videoRef.current.videoWidth;canvas.height=videoRef.current.videoHeight;const ctx=canvas.getContext(\"2d\");ctx.drawImage(videoRef.current,0,0);const imageData=ctx.getImageData(0,0,canvas.width,canvas.height);const data=imageData.data;let totalBrightness=0;for(let i=0;i<data.length;i+=4){const brightness=(data[i]+data[i+1]+data[i+2])/3;totalBrightness+=brightness;}const avgBrightness=totalBrightness/(data.length/4);if(avgBrightness<50){updateCheck(\"lighting\",\"warning\",\"‚ö†Ô∏è Low lighting detected. Please improve lighting for better results.\");}else if(avgBrightness>200){updateCheck(\"lighting\",\"warning\",\"‚ö†Ô∏è Very bright. Consider adjusting lighting.\");}else{updateCheck(\"lighting\",\"passed\",\"\\u2705 Lighting is good (\".concat(Math.round(avgBrightness),\"/255)\"));}}catch(error){console.error(\"Lighting check error:\",error);updateCheck(\"lighting\",\"warning\",\"‚ö†Ô∏è Unable to check lighting\");}};const checkFaceDetectionAndVerification=async()=>{try{updateCheck(\"faceDetection\",\"pending\",\"Detecting your face...\");updateCheck(\"faceVerification\",\"pending\",\"Verifying your identity...\");if(!videoRef.current||!modelsLoaded||!registeredDescriptor){updateCheck(\"faceDetection\",\"failed\",\"‚ùå System not ready\");updateCheck(\"faceVerification\",\"failed\",\"‚ùå Cannot verify identity\");return false;}// Multiple attempts with averaging for better accuracy\nlet bestMatch=null;let bestDistance=Infinity;const attempts=5;const validDetections=[];for(let i=0;i<attempts;i++){const detection=await faceapi.detectSingleFace(videoRef.current,new faceapi.TinyFaceDetectorOptions({inputSize:224,scoreThreshold:0.5})).withFaceLandmarks().withFaceDescriptor();if(detection){// CRITICAL: Compare with registered descriptor\nconst distance=faceapi.euclideanDistance(registeredDescriptor,detection.descriptor);validDetections.push({detection,distance});if(distance<bestDistance){bestDistance=distance;bestMatch=detection;}console.log(\"\\uD83D\\uDD0D Detection \".concat(i+1,\"/\").concat(attempts,\": Distance = \").concat(distance.toFixed(3)));}await new Promise(resolve=>setTimeout(resolve,300));}// Check if any face was detected\nif(validDetections.length===0){updateCheck(\"faceDetection\",\"failed\",\"‚ùå No face detected. Please position yourself clearly in front of the camera.\");updateCheck(\"faceVerification\",\"failed\",\"‚ùå Cannot verify without face detection.\");setCurrentFaceMatch(false);return false;}// Face detected successfully\nupdateCheck(\"faceDetection\",\"passed\",\"\\u2705 Face detected successfully (\".concat(validDetections.length,\"/\").concat(attempts,\" captures)\"));// Calculate average distance for more stable verification\nconst avgDistance=validDetections.reduce((sum,v)=>sum+v.distance,0)/validDetections.length;const similarity=Math.max(0,(1-avgDistance)*100);console.log(\"\\uD83D\\uDCCA Verification Stats:\\n        - Valid Detections: \".concat(validDetections.length,\"/\").concat(attempts,\"\\n        - Best Distance: \").concat(bestDistance.toFixed(3),\"\\n        - Average Distance: \").concat(avgDistance.toFixed(3),\"\\n        - Similarity: \").concat(similarity.toFixed(1),\"%\\n        - Threshold Distance: \").concat(VERIFICATION_THRESHOLD,\"\\n        - Min Acceptable Distance: \").concat(MIN_ACCEPTABLE_DISTANCE,\"\\n        - Expected User: \").concat(user.name,\"\\n      \"));// Draw best detection on canvas with appropriate color\nif(canvasRef.current&&bestMatch){const dims=faceapi.matchDimensions(canvasRef.current,videoRef.current,true);const resizedDetection=faceapi.resizeResults(bestMatch,dims);const ctx=canvasRef.current.getContext(\"2d\");ctx.clearRect(0,0,canvasRef.current.width,canvasRef.current.height);// Color based on match quality\nif(avgDistance<VERIFICATION_THRESHOLD){ctx.strokeStyle=\"#10b981\";// Green for verified match\nctx.lineWidth=4;}else if(avgDistance<MIN_ACCEPTABLE_DISTANCE){ctx.strokeStyle=\"#f59e0b\";// Orange for marginal match\nctx.lineWidth=3;}else{ctx.strokeStyle=\"#ef4444\";// Red for failed match\nctx.lineWidth=3;}faceapi.draw.drawDetections(canvasRef.current,resizedDetection);faceapi.draw.drawFaceLandmarks(canvasRef.current,resizedDetection);}setVerificationScore(similarity.toFixed(1));// STRICT VERIFICATION: Only pass if distance is within threshold\nif(avgDistance<VERIFICATION_THRESHOLD){// VERIFIED MATCH - This is the registered user\nsetCurrentFaceMatch(true);// Enable the start exam button\nsetStartButtonEnabled(true);updateCheck(\"faceVerification\",\"passed\",\"\\u2705 Identity verified! Match: \".concat(similarity.toFixed(1),\"% - Confirmed: \").concat(user.name));// Log successful verification\ntry{const token=localStorage.getItem(\"token\");fetch(\"http://localhost:4000/api/auth/log-verification\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(token)},body:JSON.stringify({examId,verificationScore:similarity,status:\"success\"})});}catch(error){console.error(\"Error logging verification:\",error);}verificationAttempts.current=0;return true;}else if(avgDistance<MIN_ACCEPTABLE_DISTANCE){// MARGINAL MATCH - Accept with warning but require additional verification\nsetCurrentFaceMatch(true);updateCheck(\"faceVerification\",\"warning\",\"\\u26A0\\uFE0F Identity verified with low confidence: \".concat(similarity.toFixed(1),\"% - Please improve lighting for \").concat(user.name));verificationAttempts.current=0;return true;}else{// FAILED MATCH - This is NOT the registered user\nverificationAttempts.current++;setCurrentFaceMatch(false);const remainingAttempts=3-verificationAttempts.current;// Log failed verification attempt\ntry{const token=localStorage.getItem(\"token\");fetch(\"http://localhost:4000/api/auth/log-verification\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(token)},body:JSON.stringify({examId,verificationScore:similarity,status:\"failed\",attemptNumber:verificationAttempts.current,distance:avgDistance})});}catch(error){console.error(\"Error logging failed verification:\",error);}if(verificationAttempts.current<3){updateCheck(\"faceVerification\",\"failed\",\"\\u274C Identity verification failed (\".concat(similarity.toFixed(1),\"%). You don't appear to be \").concat(user.name,\". \").concat(remainingAttempts,\" attempts remaining.\"));}else{updateCheck(\"faceVerification\",\"failed\",\"\\u274C Maximum attempts reached. Identity does not match \".concat(user.name,\". Distance: \").concat(avgDistance.toFixed(3)));// After 3 failed attempts, log a security alert\ntry{const token=localStorage.getItem(\"token\");fetch(\"http://localhost:4000/api/auth/security-alert\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(token)},body:JSON.stringify({examId,alertType:\"multiple_verification_failures\",details:\"Multiple failed verification attempts for exam \".concat(examId,\". Possible impersonation attempt.\")})});}catch(error){console.error(\"Error logging security alert:\",error);}}console.warn(\"\\u26A0\\uFE0F VERIFICATION FAILED: Distance \".concat(avgDistance.toFixed(3),\" exceeds threshold \").concat(VERIFICATION_THRESHOLD));return false;}}catch(error){console.error(\"Face detection/verification error:\",error);updateCheck(\"faceDetection\",\"failed\",\"‚ùå Error during face detection\");updateCheck(\"faceVerification\",\"failed\",\"‚ùå Error during identity verification\");setCurrentFaceMatch(false);return false;}};const checkEnvironment=async()=>{try{updateCheck(\"environment\",\"pending\",\"Checking for multiple people...\");if(!videoRef.current||!modelsLoaded){updateCheck(\"environment\",\"warning\",\"‚ö†Ô∏è Unable to verify environment\");return;}const detections=await faceapi.detectAllFaces(videoRef.current,new faceapi.TinyFaceDetectorOptions({scoreThreshold:0.5}));if(detections.length===0){updateCheck(\"environment\",\"warning\",\"‚ö†Ô∏è No face detected in frame.\");}else if(detections.length===1){updateCheck(\"environment\",\"passed\",\"‚úÖ Single person detected. Environment is clear.\");}else{updateCheck(\"environment\",\"warning\",\"\\u26A0\\uFE0F Multiple people detected (\".concat(detections.length,\"). Please ensure you're alone.\"));}}catch(error){console.error(\"Environment check error:\",error);updateCheck(\"environment\",\"warning\",\"‚ö†Ô∏è Unable to check environment\");}};const handleManualCheck=async()=>{setIsManualCheck(true);setStatus(\"checking\");setMessage(\"Running manual verification...\");verificationAttempts.current=0;await runAllChecks();setIsManualCheck(false);};// Create a separate function for navigation that doesn't use any hooks\nfunction navigateToExam(id){window.location.href=\"/exam/\".concat(id);}const handleStartExam=()=>{// No need to check conditions again since the button is only enabled when verification passes\nif(window.confirm(\"\\u2705 Identity Verified: \".concat(user.name,\"\\n\\n\")+\"Match Score: \".concat(verificationScore,\"%\\n\\n\")+\"\\u26A0\\uFE0F Important Reminders:\\n\"+\"\\u2022 Timer will start when you begin the exam\\n\"+\"\\u2022 Your identity will be verified continuously\\n\"+\"\\u2022 Keep your face visible at all times\\n\"+\"\\u2022 Multiple face detection will be logged\\n\"+\"\\u2022 Tab switching is monitored\\n\"+\"\\u2022 Exam will auto-submit on violations\\n\\n\"+\"Are you ready to start?\")){// Disable all hooks by setting a flag\nsetStatus(\"navigating\");// Log successful pre-exam verification\nlogPreExamVerification();// Log exam start\ntry{const token=localStorage.getItem(\"token\");fetch(\"http://localhost:4000/api/exam/start\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(token)},body:JSON.stringify({examId,startTime:new Date().toISOString()})});}catch(error){console.error(\"Error logging exam start:\",error);}// Stop camera before navigating\nstopCamera();// Store the exam ID in a variable to avoid closure issues\nconst targetExamId=examId;// Use direct window.location navigation instead of React Router's navigate\n// This completely bypasses React's lifecycle and prevents hook errors\nsetTimeout(()=>{navigateToExam(targetExamId);},1000);}};const logPreExamVerification=async()=>{try{const token=localStorage.getItem(\"token\");await fetch(\"http://localhost:4000/api/exam/verify-face\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",Authorization:\"Bearer \".concat(token)},body:JSON.stringify({examId,verificationStatus:\"verified\",confidence:verificationScore,details:\"Pre-exam verification successful for \".concat(user.name)})});}catch(error){console.error(\"Error logging verification:\",error);}};const handleCancel=()=>{if(window.confirm(\"Are you sure you want to cancel? You'll need to restart the verification process.\")){stopCamera();navigate(\"/student/dashboard\");}};const getStatusIcon=status=>{switch(status){case\"passed\":return\"‚úÖ\";case\"failed\":return\"‚ùå\";case\"warning\":return\"‚ö†Ô∏è\";case\"pending\":return\"‚è≥\";default:return\"‚è≥\";}};const getStatusColor=status=>{switch(status){case\"passed\":return\"#10b981\";case\"failed\":return\"#ef4444\";case\"warning\":return\"#f59e0b\";case\"pending\":return\"#6b7280\";default:return\"#6b7280\";}};return/*#__PURE__*/_jsx(\"div\",{className:\"pre-exam-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"pre-exam-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"pre-exam-header\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header-top\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDD12 Identity Verification Required\"}),/*#__PURE__*/_jsx(\"div\",{className:\"theme-toggle-container\",children:/*#__PURE__*/_jsx(ThemeToggle,{})})]}),examDetails&&/*#__PURE__*/_jsxs(\"div\",{className:\"exam-info\",children:[/*#__PURE__*/_jsx(\"h3\",{children:examDetails.title}),/*#__PURE__*/_jsxs(\"p\",{children:[\"\\uD83D\\uDCDD \",((_examDetails$question=examDetails.questions)===null||_examDetails$question===void 0?void 0:_examDetails$question.length)||0,\" Questions \\u2022 \\u23F1\\uFE0F \",examDetails.durationMins||30,\" Minutes \\u2022 \\uD83D\\uDC64 Registered Student: \",/*#__PURE__*/_jsx(\"strong\",{children:user.name})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"verification-area\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"camera-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"camera-container\",children:[/*#__PURE__*/_jsx(\"video\",{ref:videoRef,autoPlay:true,muted:true,playsInline:true,className:\"camera-video\",onLoadedMetadata:()=>{if(canvasRef.current&&videoRef.current){canvasRef.current.width=videoRef.current.videoWidth;canvasRef.current.height=videoRef.current.videoHeight;}}}),/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,className:\"detection-canvas\"}),verificationScore>0&&/*#__PURE__*/_jsx(\"div\",{className:\"match-overlay \".concat(currentFaceMatch?'match':'no-match'),children:currentFaceMatch?/*#__PURE__*/_jsxs(\"div\",{className:\"match-success\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"match-icon\",children:\"\\u2705\"}),/*#__PURE__*/_jsx(\"span\",{className:\"match-text\",children:\"Identity Verified\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"match-score\",children:[verificationScore,\"%\"]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"match-fail\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"match-icon\",children:\"\\u26A0\\uFE0F\"}),/*#__PURE__*/_jsx(\"span\",{className:\"match-text\",children:\"Please Retry\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"match-score\",children:[verificationScore,\"%\"]})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"status-display\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"status-indicator \".concat(status)}),/*#__PURE__*/_jsx(\"p\",{className:\"status-message\",children:message})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"checks-section\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Verification Checklist\"}),/*#__PURE__*/_jsx(\"div\",{className:\"checks-list\",children:Object.entries(checks).map(_ref2=>{let[key,check]=_ref2;return/*#__PURE__*/_jsxs(\"div\",{className:\"check-item \".concat(check.status),style:{borderLeftColor:getStatusColor(check.status)},children:[/*#__PURE__*/_jsxs(\"span\",{className:\"check-icon\",children:[check.icon,\" \",getStatusIcon(check.status)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"check-content\",children:[/*#__PURE__*/_jsx(\"strong\",{children:key.replace(/([A-Z])/g,' $1').trim()}),/*#__PURE__*/_jsx(\"p\",{children:check.message})]})]},key);})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"instructions-box\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\uD83D\\uDCA1 Verification Tips\"}),/*#__PURE__*/_jsxs(\"ul\",{children:[/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Good Lighting:\"}),\" Ensure your face is well-lit and clearly visible\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Face Position:\"}),\" Look directly at the camera, keep face centered\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Remove Obstacles:\"}),\" Take off glasses, hats, or masks if possible\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Stable Position:\"}),\" Keep your head still during verification\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Camera Quality:\"}),\" Use a good quality webcam for best results\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Retry if Needed:\"}),\" Use the Re-verify button to try again with better conditions\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"action-buttons\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleCancel,className:\"btn-cancel\",children:\"\\u274C Cancel\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleManualCheck,className:\"btn-test\",disabled:status===\"checking\",children:isManualCheck?\"üîÑ Verifying...\":\"üîÑ Re-verify Identity\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleStartExam,className:\"btn-start\",disabled:status===\"checking\"||!startButtonEnabled||checks.faceVerification.status===\"failed\",children:\"\\u2705 Start Exam\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"verification-info\",children:/*#__PURE__*/_jsxs(\"p\",{className:\"info-text\",children:[\"\\uD83D\\uDEE1\\uFE0F \",/*#__PURE__*/_jsx(\"strong\",{children:\"Security Notice:\"}),\" All verification attempts are logged. If you're having trouble, ensure good lighting and camera position, then use the Re-verify button.\"]})})]})});}","map":{"version":3,"names":["React","useEffect","useRef","useState","faceapi","useNavigate","useParams","ThemeToggle","jsx","_jsx","jsxs","_jsxs","PreExamSetup","_ref","_examDetails$question","user","examId","videoRef","canvasRef","navigate","verificationAttempts","status","setStatus","message","setMessage","checks","setChecks","camera","icon","lighting","faceDetection","faceVerification","environment","modelsLoaded","setModelsLoaded","registeredDescriptor","setRegisteredDescriptor","allChecksPassed","setAllChecksPassed","examDetails","setExamDetails","isManualCheck","setIsManualCheck","currentFaceMatch","setCurrentFaceMatch","verificationScore","setVerificationScore","startButtonEnabled","setStartButtonEnabled","VERIFICATION_THRESHOLD","MIN_ACCEPTABLE_DISTANCE","initializePreExam","stopCamera","faceStatus","checkFaceRegistrationStatus","setTimeout","fetchExamDetails","loadModels","loadRegisteredFace","startCamera","runAllChecks","error","console","token","localStorage","getItem","response","fetch","headers","Authorization","concat","ok","data","json","isFaceRegistered","Error","updateCheck","MODEL_URL","process","env","PUBLIC_URL","Promise","all","nets","tinyFaceDetector","loadFromUri","faceLandmark68Net","faceRecognitionNet","log","faceDescriptor","Array","isArray","length","Float32Array","stream","navigator","mediaDevices","getUserMedia","video","width","ideal","height","facingMode","current","srcObject","resolve","onloadedmetadata","play","getTracks","forEach","track","stop","checkName","prev","_objectSpread","checkLighting","faceCheckPassed","checkFaceDetectionAndVerification","checkEnvironment","allPassed","Object","values","every","check","canvas","document","createElement","videoWidth","videoHeight","ctx","getContext","drawImage","imageData","getImageData","totalBrightness","i","brightness","avgBrightness","Math","round","bestMatch","bestDistance","Infinity","attempts","validDetections","detection","detectSingleFace","TinyFaceDetectorOptions","inputSize","scoreThreshold","withFaceLandmarks","withFaceDescriptor","distance","euclideanDistance","descriptor","push","toFixed","avgDistance","reduce","sum","v","similarity","max","name","dims","matchDimensions","resizedDetection","resizeResults","clearRect","strokeStyle","lineWidth","draw","drawDetections","drawFaceLandmarks","method","body","JSON","stringify","remainingAttempts","attemptNumber","alertType","details","warn","detections","detectAllFaces","handleManualCheck","navigateToExam","id","window","location","href","handleStartExam","confirm","logPreExamVerification","startTime","Date","toISOString","targetExamId","verificationStatus","confidence","handleCancel","getStatusIcon","getStatusColor","className","children","title","questions","durationMins","ref","autoPlay","muted","playsInline","onLoadedMetadata","entries","map","_ref2","key","style","borderLeftColor","replace","trim","onClick","disabled"],"sources":["C:/Online Exam Proctoring System/frontend/src/components/PreExamSetup.js"],"sourcesContent":["// frontend/src/components/PreExamSetup.js - FIXED VERSION WITH IMPROVED VERIFICATION\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport * as faceapi from \"face-api.js\";\r\nimport { useNavigate, useParams } from \"react-router-dom\";\r\nimport ThemeToggle from \"./ThemeToggle\";\r\nimport \"./PreExamSetup.css\";\r\n\r\nexport default function PreExamSetup({ user }) {\r\n  const { examId } = useParams();\r\n  const videoRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n  const navigate = useNavigate();\r\n  const verificationAttempts = useRef(0);\r\n\r\n  const [status, setStatus] = useState(\"initializing\");\r\n  const [message, setMessage] = useState(\"Initializing system...\");\r\n  const [checks, setChecks] = useState({\r\n    camera: { status: \"pending\", message: \"Checking camera...\", icon: \"üì∑\" },\r\n    lighting: { status: \"pending\", message: \"Checking lighting...\", icon: \"üí°\" },\r\n    faceDetection: { status: \"pending\", message: \"Detecting face...\", icon: \"üë§\" },\r\n    faceVerification: { status: \"pending\", message: \"Verifying identity...\", icon: \"üîê\" },\r\n    environment: { status: \"pending\", message: \"Checking environment...\", icon: \"üåç\" }\r\n  });\r\n  \r\n  const [modelsLoaded, setModelsLoaded] = useState(false);\r\n  const [registeredDescriptor, setRegisteredDescriptor] = useState(null);\r\n  const [allChecksPassed, setAllChecksPassed] = useState(false);\r\n  const [examDetails, setExamDetails] = useState(null);\r\n  const [isManualCheck, setIsManualCheck] = useState(false);\r\n  const [currentFaceMatch, setCurrentFaceMatch] = useState(null);\r\n  const [verificationScore, setVerificationScore] = useState(0);\r\n  const [startButtonEnabled, setStartButtonEnabled] = useState(false);\r\n\r\n  // BALANCED THRESHOLD - Ensure proper verification while avoiding false rejections\r\n  const VERIFICATION_THRESHOLD = 0.6; // Increased from 0.45 for more lenient verification\r\n  const MIN_ACCEPTABLE_DISTANCE = 0.7; // Warning threshold increased from 0.55\r\n\r\n  useEffect(() => {\r\n    initializePreExam();\r\n    return () => stopCamera();\r\n  }, []);\r\n\r\n  const initializePreExam = async () => {\r\n    try {\r\n      setStatus(\"initializing\");\r\n      setMessage(\"Loading system components...\");\r\n\r\n      // Check if face is registered first\r\n      const faceStatus = await checkFaceRegistrationStatus();\r\n      if (!faceStatus) {\r\n        setStatus(\"error\");\r\n        setMessage(\"Face not registered. Please register your face first.\");\r\n        setTimeout(() => {\r\n          navigate(\"/face-registration\");\r\n        }, 3000);\r\n        return;\r\n      }\r\n\r\n      // Load exam details\r\n      await fetchExamDetails();\r\n      \r\n      // Load face-api models\r\n      await loadModels();\r\n      \r\n      // Load registered face descriptor\r\n      await loadRegisteredFace();\r\n      \r\n      // Start camera\r\n      await startCamera();\r\n      \r\n      // Run all checks\r\n      await runAllChecks();\r\n    } catch (error) {\r\n      console.error(\"Initialization error:\", error);\r\n      setStatus(\"error\");\r\n      setMessage(error.message || \"System initialization failed\");\r\n    }\r\n  };\r\n\r\n  const checkFaceRegistrationStatus = async () => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      const response = await fetch(\"http://localhost:4000/api/auth/face-status\", {\r\n        headers: { Authorization: `Bearer ${token}` }\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        return data.isFaceRegistered;\r\n      }\r\n      return false;\r\n    } catch (error) {\r\n      console.error(\"Error checking face registration:\", error);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const fetchExamDetails = async () => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      const response = await fetch(\r\n        `http://localhost:4000/api/exam/paper/${examId}`,\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setExamDetails(data);\r\n      } else {\r\n        throw new Error(\"Failed to load exam details\");\r\n      }\r\n    } catch (error) {\r\n      throw new Error(\"Cannot load exam. Please try again.\");\r\n    }\r\n  };\r\n\r\n  const loadModels = async () => {\r\n    try {\r\n      updateCheck(\"camera\", \"pending\", \"Loading face detection models...\");\r\n      const MODEL_URL = process.env.PUBLIC_URL + \"/models\";\r\n      \r\n      await Promise.all([\r\n        faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),\r\n        faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\r\n        faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL),\r\n      ]);\r\n      \r\n      setModelsLoaded(true);\r\n      console.log(\"‚úÖ Face detection models loaded successfully\");\r\n    } catch (error) {\r\n      console.error(\"Model loading error:\", error);\r\n      throw new Error(\"Failed to load face detection models. Please refresh the page.\");\r\n    }\r\n  };\r\n\r\n  const loadRegisteredFace = async () => {\r\n    try {\r\n      updateCheck(\"faceVerification\", \"pending\", \"Loading your registered face data...\");\r\n      const token = localStorage.getItem(\"token\");\r\n      const response = await fetch(\r\n        \"http://localhost:4000/api/auth/face-descriptor\",\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        if (data.faceDescriptor && Array.isArray(data.faceDescriptor) && data.faceDescriptor.length === 128) {\r\n          setRegisteredDescriptor(new Float32Array(data.faceDescriptor));\r\n          console.log(\"‚úÖ Registered face data loaded\");\r\n        } else {\r\n          throw new Error(\"Invalid face descriptor format\");\r\n        }\r\n      } else {\r\n        throw new Error(\"Face not registered\");\r\n      }\r\n    } catch (error) {\r\n      updateCheck(\"faceVerification\", \"failed\", \"‚ùå Face not registered. Please register first.\");\r\n      throw new Error(\"Please register your face before taking exams\");\r\n    }\r\n  };\r\n\r\n  const startCamera = async () => {\r\n    try {\r\n      updateCheck(\"camera\", \"pending\", \"Starting camera...\");\r\n      \r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        video: { \r\n          width: { ideal: 1280 },\r\n          height: { ideal: 720 },\r\n          facingMode: \"user\"\r\n        },\r\n      });\r\n      \r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n        \r\n        // Wait for video to be ready\r\n        await new Promise((resolve) => {\r\n          videoRef.current.onloadedmetadata = () => {\r\n            videoRef.current.play();\r\n            resolve();\r\n          };\r\n        });\r\n        \r\n        updateCheck(\"camera\", \"passed\", \"‚úÖ Camera is working properly\");\r\n        console.log(\"‚úÖ Camera started successfully\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Camera error:\", error);\r\n      updateCheck(\"camera\", \"failed\", \"‚ùå Cannot access camera. Please grant permission.\");\r\n      throw new Error(\"Camera access denied. Please enable camera in browser settings.\");\r\n    }\r\n  };\r\n\r\n  const stopCamera = () => {\r\n    if (videoRef.current && videoRef.current.srcObject) {\r\n      videoRef.current.srcObject.getTracks().forEach(track => track.stop());\r\n      console.log(\"üõë Camera stopped\");\r\n    }\r\n  };\r\n\r\n  const updateCheck = (checkName, status, message) => {\r\n    setChecks(prev => ({\r\n      ...prev,\r\n      [checkName]: { ...prev[checkName], status, message }\r\n    }));\r\n  };\r\n\r\n  const runAllChecks = async () => {\r\n    setStatus(\"checking\");\r\n    setMessage(\"Running comprehensive pre-exam verification...\");\r\n\r\n    try {\r\n      // Wait a moment for camera to stabilize\r\n      await new Promise(resolve => setTimeout(resolve, 2000));\r\n\r\n      // Check lighting\r\n      await checkLighting();\r\n      await new Promise(resolve => setTimeout(resolve, 500));\r\n      \r\n      // Check face detection and verification (most important)\r\n      const faceCheckPassed = await checkFaceDetectionAndVerification();\r\n      \r\n      if (!faceCheckPassed) {\r\n        setStatus(\"incomplete\");\r\n        setMessage(\"‚ö†Ô∏è Please adjust position and lighting for better verification\");\r\n        setAllChecksPassed(false);\r\n        return;\r\n      }\r\n\r\n      await new Promise(resolve => setTimeout(resolve, 500));\r\n      \r\n      // Check environment\r\n      await checkEnvironment();\r\n      \r\n      // Final verification\r\n      const allPassed = Object.values(checks).every(\r\n        check => check.status === \"passed\" || check.status === \"warning\"\r\n      );\r\n      \r\n      setAllChecksPassed(allPassed && faceCheckPassed);\r\n      \r\n      if (allPassed && faceCheckPassed) {\r\n        setStatus(\"ready\");\r\n        setMessage(\"‚úÖ All checks passed! Identity verified. You're ready to start the exam.\");\r\n      } else {\r\n        setStatus(\"incomplete\");\r\n        setMessage(\"‚ö†Ô∏è Please resolve all issues before proceeding.\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Check error:\", error);\r\n      setStatus(\"error\");\r\n      setMessage(\"Error during verification: \" + error.message);\r\n    }\r\n  };\r\n\r\n  const checkLighting = async () => {\r\n    try {\r\n      updateCheck(\"lighting\", \"pending\", \"Analyzing lighting conditions...\");\r\n      \r\n      if (!videoRef.current) {\r\n        updateCheck(\"lighting\", \"failed\", \"‚ùå Video not ready\");\r\n        return;\r\n      }\r\n\r\n      const canvas = document.createElement(\"canvas\");\r\n      canvas.width = videoRef.current.videoWidth;\r\n      canvas.height = videoRef.current.videoHeight;\r\n      const ctx = canvas.getContext(\"2d\");\r\n      ctx.drawImage(videoRef.current, 0, 0);\r\n\r\n      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n      const data = imageData.data;\r\n      \r\n      let totalBrightness = 0;\r\n      for (let i = 0; i < data.length; i += 4) {\r\n        const brightness = (data[i] + data[i + 1] + data[i + 2]) / 3;\r\n        totalBrightness += brightness;\r\n      }\r\n      \r\n      const avgBrightness = totalBrightness / (data.length / 4);\r\n      \r\n      if (avgBrightness < 50) {\r\n        updateCheck(\"lighting\", \"warning\", \"‚ö†Ô∏è Low lighting detected. Please improve lighting for better results.\");\r\n      } else if (avgBrightness > 200) {\r\n        updateCheck(\"lighting\", \"warning\", \"‚ö†Ô∏è Very bright. Consider adjusting lighting.\");\r\n      } else {\r\n        updateCheck(\"lighting\", \"passed\", `‚úÖ Lighting is good (${Math.round(avgBrightness)}/255)`);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Lighting check error:\", error);\r\n      updateCheck(\"lighting\", \"warning\", \"‚ö†Ô∏è Unable to check lighting\");\r\n    }\r\n  };\r\n\r\n  const checkFaceDetectionAndVerification = async () => {\r\n    try {\r\n      updateCheck(\"faceDetection\", \"pending\", \"Detecting your face...\");\r\n      updateCheck(\"faceVerification\", \"pending\", \"Verifying your identity...\");\r\n      \r\n      if (!videoRef.current || !modelsLoaded || !registeredDescriptor) {\r\n        updateCheck(\"faceDetection\", \"failed\", \"‚ùå System not ready\");\r\n        updateCheck(\"faceVerification\", \"failed\", \"‚ùå Cannot verify identity\");\r\n        return false;\r\n      }\r\n\r\n      // Multiple attempts with averaging for better accuracy\r\n      let bestMatch = null;\r\n      let bestDistance = Infinity;\r\n      const attempts = 5;\r\n      const validDetections = [];\r\n\r\n      for (let i = 0; i < attempts; i++) {\r\n        const detection = await faceapi\r\n          .detectSingleFace(videoRef.current, new faceapi.TinyFaceDetectorOptions({ \r\n            inputSize: 224,\r\n            scoreThreshold: 0.5\r\n          }))\r\n          .withFaceLandmarks()\r\n          .withFaceDescriptor();\r\n\r\n        if (detection) {\r\n          // CRITICAL: Compare with registered descriptor\r\n          const distance = faceapi.euclideanDistance(\r\n            registeredDescriptor,\r\n            detection.descriptor\r\n          );\r\n          \r\n          validDetections.push({ detection, distance });\r\n          \r\n          if (distance < bestDistance) {\r\n            bestDistance = distance;\r\n            bestMatch = detection;\r\n          }\r\n\r\n          console.log(`üîç Detection ${i + 1}/${attempts}: Distance = ${distance.toFixed(3)}`);\r\n        }\r\n\r\n        await new Promise(resolve => setTimeout(resolve, 300));\r\n      }\r\n\r\n      // Check if any face was detected\r\n      if (validDetections.length === 0) {\r\n        updateCheck(\"faceDetection\", \"failed\", \"‚ùå No face detected. Please position yourself clearly in front of the camera.\");\r\n        updateCheck(\"faceVerification\", \"failed\", \"‚ùå Cannot verify without face detection.\");\r\n        setCurrentFaceMatch(false);\r\n        return false;\r\n      }\r\n\r\n      // Face detected successfully\r\n      updateCheck(\"faceDetection\", \"passed\", `‚úÖ Face detected successfully (${validDetections.length}/${attempts} captures)`);\r\n\r\n      // Calculate average distance for more stable verification\r\n      const avgDistance = validDetections.reduce((sum, v) => sum + v.distance, 0) / validDetections.length;\r\n      const similarity = Math.max(0, (1 - avgDistance) * 100);\r\n      \r\n      console.log(`üìä Verification Stats:\r\n        - Valid Detections: ${validDetections.length}/${attempts}\r\n        - Best Distance: ${bestDistance.toFixed(3)}\r\n        - Average Distance: ${avgDistance.toFixed(3)}\r\n        - Similarity: ${similarity.toFixed(1)}%\r\n        - Threshold Distance: ${VERIFICATION_THRESHOLD}\r\n        - Min Acceptable Distance: ${MIN_ACCEPTABLE_DISTANCE}\r\n        - Expected User: ${user.name}\r\n      `);\r\n\r\n      // Draw best detection on canvas with appropriate color\r\n      if (canvasRef.current && bestMatch) {\r\n        const dims = faceapi.matchDimensions(canvasRef.current, videoRef.current, true);\r\n        const resizedDetection = faceapi.resizeResults(bestMatch, dims);\r\n        const ctx = canvasRef.current.getContext(\"2d\");\r\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\r\n        \r\n        // Color based on match quality\r\n        if (avgDistance < VERIFICATION_THRESHOLD) {\r\n          ctx.strokeStyle = \"#10b981\"; // Green for verified match\r\n          ctx.lineWidth = 4;\r\n        } else if (avgDistance < MIN_ACCEPTABLE_DISTANCE) {\r\n          ctx.strokeStyle = \"#f59e0b\"; // Orange for marginal match\r\n          ctx.lineWidth = 3;\r\n        } else {\r\n          ctx.strokeStyle = \"#ef4444\"; // Red for failed match\r\n          ctx.lineWidth = 3;\r\n        }\r\n        \r\n        faceapi.draw.drawDetections(canvasRef.current, resizedDetection);\r\n        faceapi.draw.drawFaceLandmarks(canvasRef.current, resizedDetection);\r\n      }\r\n\r\n      setVerificationScore(similarity.toFixed(1));\r\n\r\n      // STRICT VERIFICATION: Only pass if distance is within threshold\r\n      if (avgDistance < VERIFICATION_THRESHOLD) {\r\n        // VERIFIED MATCH - This is the registered user\r\n        setCurrentFaceMatch(true);\r\n        // Enable the start exam button\r\n        setStartButtonEnabled(true);\r\n        updateCheck(\r\n          \"faceVerification\",\r\n          \"passed\",\r\n          `‚úÖ Identity verified! Match: ${similarity.toFixed(1)}% - Confirmed: ${user.name}`\r\n        );\r\n        \r\n        // Log successful verification\r\n        try {\r\n          const token = localStorage.getItem(\"token\");\r\n          fetch(\"http://localhost:4000/api/auth/log-verification\", {\r\n            method: \"POST\",\r\n            headers: {\r\n              \"Content-Type\": \"application/json\",\r\n              Authorization: `Bearer ${token}`\r\n            },\r\n            body: JSON.stringify({\r\n              examId,\r\n              verificationScore: similarity,\r\n              status: \"success\"\r\n            })\r\n          });\r\n        } catch (error) {\r\n          console.error(\"Error logging verification:\", error);\r\n        }\r\n        \r\n        verificationAttempts.current = 0;\r\n        return true;\r\n      } else if (avgDistance < MIN_ACCEPTABLE_DISTANCE) {\r\n        // MARGINAL MATCH - Accept with warning but require additional verification\r\n        setCurrentFaceMatch(true);\r\n        updateCheck(\r\n          \"faceVerification\",\r\n          \"warning\",\r\n          `‚ö†Ô∏è Identity verified with low confidence: ${similarity.toFixed(1)}% - Please improve lighting for ${user.name}`\r\n        );\r\n        verificationAttempts.current = 0;\r\n        return true;\r\n      } else {\r\n        // FAILED MATCH - This is NOT the registered user\r\n        verificationAttempts.current++;\r\n        setCurrentFaceMatch(false);\r\n        \r\n        const remainingAttempts = 3 - verificationAttempts.current;\r\n        \r\n        // Log failed verification attempt\r\n        try {\r\n          const token = localStorage.getItem(\"token\");\r\n          fetch(\"http://localhost:4000/api/auth/log-verification\", {\r\n            method: \"POST\",\r\n            headers: {\r\n              \"Content-Type\": \"application/json\",\r\n              Authorization: `Bearer ${token}`\r\n            },\r\n            body: JSON.stringify({\r\n              examId,\r\n              verificationScore: similarity,\r\n              status: \"failed\",\r\n              attemptNumber: verificationAttempts.current,\r\n              distance: avgDistance\r\n            })\r\n          });\r\n        } catch (error) {\r\n          console.error(\"Error logging failed verification:\", error);\r\n        }\r\n        \r\n        if (verificationAttempts.current < 3) {\r\n          updateCheck(\r\n            \"faceVerification\",\r\n            \"failed\",\r\n            `‚ùå Identity verification failed (${similarity.toFixed(1)}%). You don't appear to be ${user.name}. ${remainingAttempts} attempts remaining.`\r\n          );\r\n        } else {\r\n          updateCheck(\r\n            \"faceVerification\",\r\n            \"failed\",\r\n            `‚ùå Maximum attempts reached. Identity does not match ${user.name}. Distance: ${avgDistance.toFixed(3)}`\r\n          );\r\n          \r\n          // After 3 failed attempts, log a security alert\r\n          try {\r\n            const token = localStorage.getItem(\"token\");\r\n            fetch(\"http://localhost:4000/api/auth/security-alert\", {\r\n              method: \"POST\",\r\n              headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                Authorization: `Bearer ${token}`\r\n              },\r\n              body: JSON.stringify({\r\n                examId,\r\n                alertType: \"multiple_verification_failures\",\r\n                details: `Multiple failed verification attempts for exam ${examId}. Possible impersonation attempt.`\r\n              })\r\n            });\r\n          } catch (error) {\r\n            console.error(\"Error logging security alert:\", error);\r\n          }\r\n        }\r\n        \r\n        console.warn(`‚ö†Ô∏è VERIFICATION FAILED: Distance ${avgDistance.toFixed(3)} exceeds threshold ${VERIFICATION_THRESHOLD}`);\r\n        return false;\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Face detection/verification error:\", error);\r\n      updateCheck(\"faceDetection\", \"failed\", \"‚ùå Error during face detection\");\r\n      updateCheck(\"faceVerification\", \"failed\", \"‚ùå Error during identity verification\");\r\n      setCurrentFaceMatch(false);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const checkEnvironment = async () => {\r\n    try {\r\n      updateCheck(\"environment\", \"pending\", \"Checking for multiple people...\");\r\n      \r\n      if (!videoRef.current || !modelsLoaded) {\r\n        updateCheck(\"environment\", \"warning\", \"‚ö†Ô∏è Unable to verify environment\");\r\n        return;\r\n      }\r\n\r\n      const detections = await faceapi.detectAllFaces(\r\n        videoRef.current,\r\n        new faceapi.TinyFaceDetectorOptions({ scoreThreshold: 0.5 })\r\n      );\r\n\r\n      if (detections.length === 0) {\r\n        updateCheck(\"environment\", \"warning\", \"‚ö†Ô∏è No face detected in frame.\");\r\n      } else if (detections.length === 1) {\r\n        updateCheck(\"environment\", \"passed\", \"‚úÖ Single person detected. Environment is clear.\");\r\n      } else {\r\n        updateCheck(\r\n          \"environment\",\r\n          \"warning\",\r\n          `‚ö†Ô∏è Multiple people detected (${detections.length}). Please ensure you're alone.`\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Environment check error:\", error);\r\n      updateCheck(\"environment\", \"warning\", \"‚ö†Ô∏è Unable to check environment\");\r\n    }\r\n  };\r\n\r\n  const handleManualCheck = async () => {\r\n    setIsManualCheck(true);\r\n    setStatus(\"checking\");\r\n    setMessage(\"Running manual verification...\");\r\n    verificationAttempts.current = 0;\r\n    await runAllChecks();\r\n    setIsManualCheck(false);\r\n  };\r\n\r\n  // Create a separate function for navigation that doesn't use any hooks\r\n  function navigateToExam(id) {\r\n    window.location.href = `/exam/${id}`;\r\n  }\r\n\r\n  const handleStartExam = () => {\r\n    // No need to check conditions again since the button is only enabled when verification passes\r\n\r\n    if (window.confirm(\r\n      `‚úÖ Identity Verified: ${user.name}\\n\\n` +\r\n      `Match Score: ${verificationScore}%\\n\\n` +\r\n      `‚ö†Ô∏è Important Reminders:\\n` +\r\n      `‚Ä¢ Timer will start when you begin the exam\\n` +\r\n      `‚Ä¢ Your identity will be verified continuously\\n` +\r\n      `‚Ä¢ Keep your face visible at all times\\n` +\r\n      `‚Ä¢ Multiple face detection will be logged\\n` +\r\n      `‚Ä¢ Tab switching is monitored\\n` +\r\n      `‚Ä¢ Exam will auto-submit on violations\\n\\n` +\r\n      `Are you ready to start?`\r\n    )) {\r\n      // Disable all hooks by setting a flag\r\n      setStatus(\"navigating\");\r\n      \r\n      // Log successful pre-exam verification\r\n      logPreExamVerification();\r\n      \r\n      // Log exam start\r\n      try {\r\n        const token = localStorage.getItem(\"token\");\r\n        fetch(\"http://localhost:4000/api/exam/start\", {\r\n          method: \"POST\",\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: `Bearer ${token}`\r\n          },\r\n          body: JSON.stringify({\r\n            examId,\r\n            startTime: new Date().toISOString()\r\n          })\r\n        });\r\n      } catch (error) {\r\n        console.error(\"Error logging exam start:\", error);\r\n      }\r\n      \r\n      // Stop camera before navigating\r\n      stopCamera();\r\n      \r\n      // Store the exam ID in a variable to avoid closure issues\r\n      const targetExamId = examId;\r\n      \r\n      // Use direct window.location navigation instead of React Router's navigate\r\n      // This completely bypasses React's lifecycle and prevents hook errors\r\n      setTimeout(() => {\r\n        navigateToExam(targetExamId);\r\n      }, 1000);\r\n    }\r\n  };\r\n\r\n  const logPreExamVerification = async () => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      await fetch(\"http://localhost:4000/api/exam/verify-face\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${token}`\r\n        },\r\n        body: JSON.stringify({\r\n          examId,\r\n          verificationStatus: \"verified\",\r\n          confidence: verificationScore,\r\n          details: `Pre-exam verification successful for ${user.name}`\r\n        })\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Error logging verification:\", error);\r\n    }\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    if (window.confirm(\"Are you sure you want to cancel? You'll need to restart the verification process.\")) {\r\n      stopCamera();\r\n      navigate(\"/student/dashboard\");\r\n    }\r\n  };\r\n\r\n  const getStatusIcon = (status) => {\r\n    switch (status) {\r\n      case \"passed\": return \"‚úÖ\";\r\n      case \"failed\": return \"‚ùå\";\r\n      case \"warning\": return \"‚ö†Ô∏è\";\r\n      case \"pending\": return \"‚è≥\";\r\n      default: return \"‚è≥\";\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status) => {\r\n    switch (status) {\r\n      case \"passed\": return \"#10b981\";\r\n      case \"failed\": return \"#ef4444\";\r\n      case \"warning\": return \"#f59e0b\";\r\n      case \"pending\": return \"#6b7280\";\r\n      default: return \"#6b7280\";\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"pre-exam-container\">\r\n      <div className=\"pre-exam-card\">\r\n        <div className=\"pre-exam-header\">\r\n          <div className=\"header-top\">\r\n            <h2>üîí Identity Verification Required</h2>\r\n            <div className=\"theme-toggle-container\">\r\n              <ThemeToggle />\r\n            </div>\r\n          </div>\r\n          {examDetails && (\r\n            <div className=\"exam-info\">\r\n              <h3>{examDetails.title}</h3>\r\n              <p>\r\n                üìù {examDetails.questions?.length || 0} Questions ‚Ä¢ \r\n                ‚è±Ô∏è {examDetails.durationMins || 30} Minutes ‚Ä¢ \r\n                üë§ Registered Student: <strong>{user.name}</strong>\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"verification-area\">\r\n          <div className=\"camera-section\">\r\n            <div className=\"camera-container\">\r\n              <video\r\n                ref={videoRef}\r\n                autoPlay\r\n                muted\r\n                playsInline\r\n                className=\"camera-video\"\r\n                onLoadedMetadata={() => {\r\n                  if (canvasRef.current && videoRef.current) {\r\n                    canvasRef.current.width = videoRef.current.videoWidth;\r\n                    canvasRef.current.height = videoRef.current.videoHeight;\r\n                  }\r\n                }}\r\n              />\r\n              <canvas ref={canvasRef} className=\"detection-canvas\" />\r\n              \r\n              {verificationScore > 0 && (\r\n                <div className={`match-overlay ${currentFaceMatch ? 'match' : 'no-match'}`}>\r\n                  {currentFaceMatch ? (\r\n                    <div className=\"match-success\">\r\n                      <span className=\"match-icon\">‚úÖ</span>\r\n                      <span className=\"match-text\">Identity Verified</span>\r\n                      <span className=\"match-score\">{verificationScore}%</span>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"match-fail\">\r\n                      <span className=\"match-icon\">‚ö†Ô∏è</span>\r\n                      <span className=\"match-text\">Please Retry</span>\r\n                      <span className=\"match-score\">{verificationScore}%</span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n            \r\n            <div className=\"status-display\">\r\n              <div className={`status-indicator ${status}`}></div>\r\n              <p className=\"status-message\">{message}</p>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"checks-section\">\r\n            <h3>Verification Checklist</h3>\r\n            <div className=\"checks-list\">\r\n              {Object.entries(checks).map(([key, check]) => (\r\n                <div\r\n                  key={key}\r\n                  className={`check-item ${check.status}`}\r\n                  style={{ borderLeftColor: getStatusColor(check.status) }}\r\n                >\r\n                  <span className=\"check-icon\">{check.icon} {getStatusIcon(check.status)}</span>\r\n                  <div className=\"check-content\">\r\n                    <strong>{key.replace(/([A-Z])/g, ' $1').trim()}</strong>\r\n                    <p>{check.message}</p>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"instructions-box\">\r\n          <h4>üí° Verification Tips</h4>\r\n          <ul>\r\n            <li><strong>Good Lighting:</strong> Ensure your face is well-lit and clearly visible</li>\r\n            <li><strong>Face Position:</strong> Look directly at the camera, keep face centered</li>\r\n            <li><strong>Remove Obstacles:</strong> Take off glasses, hats, or masks if possible</li>\r\n            <li><strong>Stable Position:</strong> Keep your head still during verification</li>\r\n            <li><strong>Camera Quality:</strong> Use a good quality webcam for best results</li>\r\n            <li><strong>Retry if Needed:</strong> Use the Re-verify button to try again with better conditions</li>\r\n          </ul>\r\n        </div>\r\n\r\n        <div className=\"action-buttons\">\r\n          <button onClick={handleCancel} className=\"btn-cancel\">\r\n            ‚ùå Cancel\r\n          </button>\r\n          \r\n          <button \r\n            onClick={handleManualCheck} \r\n            className=\"btn-test\"\r\n            disabled={status === \"checking\"}\r\n          >\r\n            {isManualCheck ? \"üîÑ Verifying...\" : \"üîÑ Re-verify Identity\"}\r\n          </button>\r\n          \r\n          <button\r\n            onClick={handleStartExam}\r\n            className=\"btn-start\"\r\n            disabled={status === \"checking\" || !startButtonEnabled || checks.faceVerification.status === \"failed\"}\r\n          >\r\n            ‚úÖ Start Exam\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"verification-info\">\r\n          <p className=\"info-text\">\r\n            üõ°Ô∏è <strong>Security Notice:</strong> All verification attempts are logged. \r\n            If you're having trouble, ensure good lighting and camera position, then use the Re-verify button.\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}