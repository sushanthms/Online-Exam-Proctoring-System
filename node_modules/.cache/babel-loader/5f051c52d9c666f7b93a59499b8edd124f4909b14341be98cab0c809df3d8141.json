{"ast":null,"code":"var _jsxFileName = \"C:\\\\Online Exam Proctoring System\\\\frontend\\\\src\\\\components\\\\PreExamSetup.js\",\n  _s = $RefreshSig$();\n// frontend/src/components/PreExamSetup.js - ENHANCED VERSION\nimport React, { useEffect, useRef, useState } from \"react\";\nimport * as faceapi from \"face-api.js\";\nimport { useNavigate, useParams } from \"react-router-dom\";\nimport \"./PreExamSetup.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function PreExamSetup({\n  user\n}) {\n  _s();\n  var _examDetails$question;\n  const {\n    examId\n  } = useParams();\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const navigate = useNavigate();\n  const verificationAttempts = useRef(0);\n  const [status, setStatus] = useState(\"initializing\");\n  const [message, setMessage] = useState(\"Initializing system...\");\n  const [checks, setChecks] = useState({\n    camera: {\n      status: \"pending\",\n      message: \"Checking camera...\",\n      icon: \"üì∑\"\n    },\n    lighting: {\n      status: \"pending\",\n      message: \"Checking lighting...\",\n      icon: \"üí°\"\n    },\n    faceDetection: {\n      status: \"pending\",\n      message: \"Detecting face...\",\n      icon: \"üë§\"\n    },\n    faceVerification: {\n      status: \"pending\",\n      message: \"Verifying identity...\",\n      icon: \"üîê\"\n    },\n    environment: {\n      status: \"pending\",\n      message: \"Checking environment...\",\n      icon: \"üåç\"\n    }\n  });\n  const [modelsLoaded, setModelsLoaded] = useState(false);\n  const [registeredDescriptor, setRegisteredDescriptor] = useState(null);\n  const [allChecksPassed, setAllChecksPassed] = useState(false);\n  const [examDetails, setExamDetails] = useState(null);\n  const [isManualCheck, setIsManualCheck] = useState(false);\n  const [currentFaceMatch, setCurrentFaceMatch] = useState(null);\n  const [verificationScore, setVerificationScore] = useState(0);\n  useEffect(() => {\n    initializePreExam();\n    return () => stopCamera();\n  }, []);\n  const initializePreExam = async () => {\n    try {\n      setStatus(\"initializing\");\n      setMessage(\"Loading system components...\");\n\n      // Check if face is registered first\n      const faceStatus = await checkFaceRegistrationStatus();\n      if (!faceStatus) {\n        setStatus(\"error\");\n        setMessage(\"Face not registered. Please register your face first.\");\n        setTimeout(() => {\n          navigate(\"/face-registration\");\n        }, 3000);\n        return;\n      }\n\n      // Load exam details\n      await fetchExamDetails();\n\n      // Load face-api models\n      await loadModels();\n\n      // Load registered face descriptor\n      await loadRegisteredFace();\n\n      // Start camera\n      await startCamera();\n\n      // Run all checks\n      await runAllChecks();\n    } catch (error) {\n      console.error(\"Initialization error:\", error);\n      setStatus(\"error\");\n      setMessage(error.message || \"System initialization failed\");\n    }\n  };\n  const checkFaceRegistrationStatus = async () => {\n    try {\n      const token = localStorage.getItem(\"token\");\n      const response = await fetch(\"http://localhost:4000/api/auth/face-status\", {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      if (response.ok) {\n        const data = await response.json();\n        return data.isFaceRegistered;\n      }\n      return false;\n    } catch (error) {\n      console.error(\"Error checking face registration:\", error);\n      return false;\n    }\n  };\n  const fetchExamDetails = async () => {\n    try {\n      const token = localStorage.getItem(\"token\");\n      const response = await fetch(`http://localhost:4000/api/exam/paper/${examId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setExamDetails(data);\n      } else {\n        throw new Error(\"Failed to load exam details\");\n      }\n    } catch (error) {\n      throw new Error(\"Cannot load exam. Please try again.\");\n    }\n  };\n  const loadModels = async () => {\n    try {\n      updateCheck(\"camera\", \"pending\", \"Loading face detection models...\");\n      const MODEL_URL = process.env.PUBLIC_URL + \"/models\";\n      await Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL), faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL), faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)]);\n      setModelsLoaded(true);\n      console.log(\"‚úÖ Face detection models loaded successfully\");\n    } catch (error) {\n      console.error(\"Model loading error:\", error);\n      throw new Error(\"Failed to load face detection models. Please refresh the page.\");\n    }\n  };\n  const loadRegisteredFace = async () => {\n    try {\n      updateCheck(\"faceVerification\", \"pending\", \"Loading your registered face data...\");\n      const token = localStorage.getItem(\"token\");\n      const response = await fetch(\"http://localhost:4000/api/auth/face-descriptor\", {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      if (response.ok) {\n        const data = await response.json();\n        if (data.faceDescriptor && Array.isArray(data.faceDescriptor) && data.faceDescriptor.length === 128) {\n          setRegisteredDescriptor(new Float32Array(data.faceDescriptor));\n          console.log(\"‚úÖ Registered face data loaded\");\n        } else {\n          throw new Error(\"Invalid face descriptor format\");\n        }\n      } else {\n        throw new Error(\"Face not registered\");\n      }\n    } catch (error) {\n      updateCheck(\"faceVerification\", \"failed\", \"‚ùå Face not registered. Please register first.\");\n      throw new Error(\"Please register your face before taking exams\");\n    }\n  };\n  const startCamera = async () => {\n    try {\n      updateCheck(\"camera\", \"pending\", \"Starting camera...\");\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          width: {\n            ideal: 1280\n          },\n          height: {\n            ideal: 720\n          },\n          facingMode: \"user\"\n        }\n      });\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n\n        // Wait for video to be ready\n        await new Promise(resolve => {\n          videoRef.current.onloadedmetadata = () => {\n            videoRef.current.play();\n            resolve();\n          };\n        });\n        updateCheck(\"camera\", \"passed\", \"‚úÖ Camera is working properly\");\n        console.log(\"‚úÖ Camera started successfully\");\n      }\n    } catch (error) {\n      console.error(\"Camera error:\", error);\n      updateCheck(\"camera\", \"failed\", \"‚ùå Cannot access camera. Please grant permission.\");\n      throw new Error(\"Camera access denied. Please enable camera in browser settings.\");\n    }\n  };\n  const stopCamera = () => {\n    if (videoRef.current && videoRef.current.srcObject) {\n      videoRef.current.srcObject.getTracks().forEach(track => track.stop());\n      console.log(\"üõë Camera stopped\");\n    }\n  };\n  const updateCheck = (checkName, status, message) => {\n    setChecks(prev => ({\n      ...prev,\n      [checkName]: {\n        ...prev[checkName],\n        status,\n        message\n      }\n    }));\n  };\n  const runAllChecks = async () => {\n    setStatus(\"checking\");\n    setMessage(\"Running comprehensive pre-exam verification...\");\n    try {\n      // Wait a moment for camera to stabilize\n      await new Promise(resolve => setTimeout(resolve, 1000));\n\n      // Check lighting\n      await checkLighting();\n      await new Promise(resolve => setTimeout(resolve, 500));\n\n      // Check face detection and verification (most important)\n      const faceCheckPassed = await checkFaceDetectionAndVerification();\n      if (!faceCheckPassed) {\n        setStatus(\"failed\");\n        setMessage(\"‚ùå Identity verification failed. Cannot proceed with exam.\");\n        setAllChecksPassed(false);\n        return;\n      }\n      await new Promise(resolve => setTimeout(resolve, 500));\n\n      // Check environment\n      await checkEnvironment();\n\n      // Final verification\n      const allPassed = Object.values(checks).every(check => check.status === \"passed\" || check.status === \"warning\");\n      setAllChecksPassed(allPassed);\n      if (allPassed) {\n        setStatus(\"ready\");\n        setMessage(\"‚úÖ All checks passed! Identity verified. You're ready to start the exam.\");\n      } else {\n        setStatus(\"incomplete\");\n        setMessage(\"‚ö†Ô∏è Some checks failed. Please resolve all issues before proceeding.\");\n      }\n    } catch (error) {\n      console.error(\"Check error:\", error);\n      setStatus(\"error\");\n      setMessage(\"Error during verification: \" + error.message);\n    }\n  };\n  const checkLighting = async () => {\n    try {\n      updateCheck(\"lighting\", \"pending\", \"Analyzing lighting conditions...\");\n      if (!videoRef.current) {\n        updateCheck(\"lighting\", \"failed\", \"‚ùå Video not ready\");\n        return;\n      }\n      const canvas = document.createElement(\"canvas\");\n      canvas.width = videoRef.current.videoWidth;\n      canvas.height = videoRef.current.videoHeight;\n      const ctx = canvas.getContext(\"2d\");\n      ctx.drawImage(videoRef.current, 0, 0);\n      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n      const data = imageData.data;\n      let totalBrightness = 0;\n      for (let i = 0; i < data.length; i += 4) {\n        const brightness = (data[i] + data[i + 1] + data[i + 2]) / 3;\n        totalBrightness += brightness;\n      }\n      const avgBrightness = totalBrightness / (data.length / 4);\n      if (avgBrightness < 50) {\n        updateCheck(\"lighting\", \"failed\", \"‚ùå Too dark. Please improve lighting conditions.\");\n      } else if (avgBrightness > 200) {\n        updateCheck(\"lighting\", \"warning\", \"‚ö†Ô∏è Too bright. Consider adjusting lighting.\");\n      } else {\n        updateCheck(\"lighting\", \"passed\", `‚úÖ Lighting is good (${Math.round(avgBrightness)}/255)`);\n      }\n    } catch (error) {\n      console.error(\"Lighting check error:\", error);\n      updateCheck(\"lighting\", \"failed\", \"‚ùå Failed to check lighting\");\n    }\n  };\n  const checkFaceDetectionAndVerification = async () => {\n    try {\n      updateCheck(\"faceDetection\", \"pending\", \"Detecting your face...\");\n      updateCheck(\"faceVerification\", \"pending\", \"Verifying your identity...\");\n      if (!videoRef.current || !modelsLoaded || !registeredDescriptor) {\n        updateCheck(\"faceDetection\", \"failed\", \"‚ùå System not ready\");\n        updateCheck(\"faceVerification\", \"failed\", \"‚ùå Cannot verify identity\");\n        return false;\n      }\n\n      // Multiple attempts for better accuracy\n      let bestMatch = null;\n      let bestDistance = Infinity;\n      const attempts = 3;\n      for (let i = 0; i < attempts; i++) {\n        const detection = await faceapi.detectSingleFace(videoRef.current, new faceapi.TinyFaceDetectorOptions({\n          inputSize: 224\n        })).withFaceLandmarks().withFaceDescriptor();\n        if (!detection) {\n          if (i === attempts - 1) {\n            updateCheck(\"faceDetection\", \"failed\", \"‚ùå No face detected. Please position yourself clearly.\");\n            updateCheck(\"faceVerification\", \"failed\", \"‚ùå Cannot verify without face detection.\");\n            return false;\n          }\n          await new Promise(resolve => setTimeout(resolve, 500));\n          continue;\n        }\n\n        // Calculate distance\n        const distance = faceapi.euclideanDistance(registeredDescriptor, detection.descriptor);\n        if (distance < bestDistance) {\n          bestDistance = distance;\n          bestMatch = detection;\n        }\n\n        // Draw detection on canvas\n        if (canvasRef.current && i === attempts - 1) {\n          const dims = faceapi.matchDimensions(canvasRef.current, videoRef.current, true);\n          const resizedDetection = faceapi.resizeResults(detection, dims);\n          const ctx = canvasRef.current.getContext(\"2d\");\n          ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n\n          // Draw with color based on match\n          if (bestDistance < 0.6) {\n            ctx.strokeStyle = \"#10b981\"; // Green for match\n          } else {\n            ctx.strokeStyle = \"#ef4444\"; // Red for no match\n          }\n          ctx.lineWidth = 3;\n          faceapi.draw.drawDetections(canvasRef.current, resizedDetection);\n          faceapi.draw.drawFaceLandmarks(canvasRef.current, resizedDetection);\n        }\n        await new Promise(resolve => setTimeout(resolve, 500));\n      }\n      if (!bestMatch) {\n        updateCheck(\"faceDetection\", \"failed\", \"‚ùå No face detected after multiple attempts.\");\n        updateCheck(\"faceVerification\", \"failed\", \"‚ùå Identity verification failed.\");\n        return false;\n      }\n\n      // Face detected successfully\n      updateCheck(\"faceDetection\", \"passed\", \"‚úÖ Face detected successfully\");\n\n      // Verify identity\n      const similarity = Math.max(0, (1 - bestDistance) * 100);\n      setVerificationScore(similarity.toFixed(1));\n      setCurrentFaceMatch(bestDistance < 0.6);\n      console.log(`Identity verification: Distance=${bestDistance.toFixed(3)}, Similarity=${similarity.toFixed(1)}%`);\n      if (bestDistance < 0.6) {\n        updateCheck(\"faceVerification\", \"passed\", `‚úÖ Identity verified! Match: ${similarity.toFixed(1)}% (${user.name})`);\n        verificationAttempts.current = 0;\n        return true;\n      } else {\n        verificationAttempts.current++;\n        updateCheck(\"faceVerification\", \"failed\", `‚ùå Identity mismatch (${similarity.toFixed(1)}% match). Expected: ${user.name}`);\n        if (verificationAttempts.current >= 3) {\n          alert(\"‚ùå Identity verification failed multiple times. Please ensure you are the registered student.\");\n        }\n        return false;\n      }\n    } catch (error) {\n      console.error(\"Face detection/verification error:\", error);\n      updateCheck(\"faceDetection\", \"failed\", \"‚ùå Error during face detection\");\n      updateCheck(\"faceVerification\", \"failed\", \"‚ùå Error during identity verification\");\n      return false;\n    }\n  };\n  const checkEnvironment = async () => {\n    try {\n      updateCheck(\"environment\", \"pending\", \"Checking for multiple people...\");\n      if (!videoRef.current || !modelsLoaded) {\n        updateCheck(\"environment\", \"warning\", \"‚ö†Ô∏è Unable to verify environment\");\n        return;\n      }\n      const detections = await faceapi.detectAllFaces(videoRef.current, new faceapi.TinyFaceDetectorOptions());\n      if (detections.length === 0) {\n        updateCheck(\"environment\", \"warning\", \"‚ö†Ô∏è No face detected in frame.\");\n      } else if (detections.length === 1) {\n        updateCheck(\"environment\", \"passed\", \"‚úÖ Single person detected. Environment is clear.\");\n      } else {\n        updateCheck(\"environment\", \"failed\", `‚ùå Multiple people detected (${detections.length}). Ensure you're alone.`);\n      }\n    } catch (error) {\n      console.error(\"Environment check error:\", error);\n      updateCheck(\"environment\", \"warning\", \"‚ö†Ô∏è Unable to check environment\");\n    }\n  };\n  const handleManualCheck = async () => {\n    setIsManualCheck(true);\n    setStatus(\"checking\");\n    setMessage(\"Running manual verification...\");\n    verificationAttempts.current = 0;\n    await runAllChecks();\n    setIsManualCheck(false);\n  };\n  const handleStartExam = () => {\n    if (!allChecksPassed) {\n      alert(\"‚ö†Ô∏è Please resolve all verification issues before starting the exam.\");\n      return;\n    }\n    if (!currentFaceMatch) {\n      alert(\"‚ùå Identity verification failed. You must be the registered student to take this exam.\");\n      return;\n    }\n    if (window.confirm(`‚úÖ Identity Verified: ${user.name}\\n\\n` + `Match Score: ${verificationScore}%\\n\\n` + `‚ö†Ô∏è Important Reminders:\\n` + `‚Ä¢ Timer will start ONLY when you begin the exam\\n` + `‚Ä¢ Your identity will be verified continuously\\n` + `‚Ä¢ Keep your face visible at all times\\n` + `‚Ä¢ Multiple face detection will be logged\\n` + `‚Ä¢ Tab switching is monitored\\n` + `‚Ä¢ Exam will auto-submit on violations\\n\\n` + `Are you ready to start?`)) {\n      // Log successful pre-exam verification\n      logPreExamVerification();\n\n      // Stop camera and navigate to exam\n      stopCamera();\n      navigate(`/exam/${examId}`);\n    }\n  };\n  const logPreExamVerification = async () => {\n    try {\n      const token = localStorage.getItem(\"token\");\n      await fetch(\"http://localhost:4000/api/exam/verify-face\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          examId,\n          verificationStatus: \"verified\",\n          confidence: verificationScore,\n          details: `Pre-exam verification successful for ${user.name}`\n        })\n      });\n    } catch (error) {\n      console.error(\"Error logging verification:\", error);\n    }\n  };\n  const handleCancel = () => {\n    if (window.confirm(\"Are you sure you want to cancel? You'll need to restart the verification process.\")) {\n      stopCamera();\n      navigate(\"/student/dashboard\");\n    }\n  };\n  const getStatusIcon = status => {\n    switch (status) {\n      case \"passed\":\n        return \"‚úÖ\";\n      case \"failed\":\n        return \"‚ùå\";\n      case \"warning\":\n        return \"‚ö†Ô∏è\";\n      case \"pending\":\n        return \"‚è≥\";\n      default:\n        return \"‚è≥\";\n    }\n  };\n  const getStatusColor = status => {\n    switch (status) {\n      case \"passed\":\n        return \"#10b981\";\n      case \"failed\":\n        return \"#ef4444\";\n      case \"warning\":\n        return \"#f59e0b\";\n      case \"pending\":\n        return \"#6b7280\";\n      default:\n        return \"#6b7280\";\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"pre-exam-container\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"pre-exam-card\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"pre-exam-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"\\uD83D\\uDD12 Identity Verification Required\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 524,\n          columnNumber: 11\n        }, this), examDetails && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"exam-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: examDetails.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 527,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [\"\\uD83D\\uDCDD \", ((_examDetails$question = examDetails.questions) === null || _examDetails$question === void 0 ? void 0 : _examDetails$question.length) || 0, \" Questions \\u2022 \\u23F1\\uFE0F \", examDetails.durationMins || 30, \" Minutes \\u2022 \\uD83D\\uDC64 Registered Student: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n              children: user.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 531,\n              columnNumber: 40\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 528,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 526,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 523,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"verification-area\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"camera-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"camera-container\",\n            children: [/*#__PURE__*/_jsxDEV(\"video\", {\n              ref: videoRef,\n              autoPlay: true,\n              muted: true,\n              playsInline: true,\n              className: \"camera-video\",\n              onLoadedMetadata: () => {\n                if (canvasRef.current && videoRef.current) {\n                  canvasRef.current.width = videoRef.current.videoWidth;\n                  canvasRef.current.height = videoRef.current.videoHeight;\n                }\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 540,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n              ref: canvasRef,\n              className: \"detection-canvas\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 553,\n              columnNumber: 15\n            }, this), verificationScore > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `match-overlay ${currentFaceMatch ? 'match' : 'no-match'}`,\n              children: currentFaceMatch ? /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"match-success\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"match-icon\",\n                  children: \"\\u2705\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 559,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"match-text\",\n                  children: \"Identity Verified\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 560,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"match-score\",\n                  children: [verificationScore, \"%\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 561,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 558,\n                columnNumber: 21\n              }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"match-fail\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"match-icon\",\n                  children: \"\\u274C\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 565,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"match-text\",\n                  children: \"Identity Mismatch\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 566,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"match-score\",\n                  children: [verificationScore, \"%\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 567,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 564,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 556,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 539,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"status-display\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: `status-indicator ${status}`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 575,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"status-message\",\n              children: message\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 576,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 574,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 538,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"checks-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Verification Checklist\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 581,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"checks-list\",\n            children: Object.entries(checks).map(([key, check]) => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `check-item ${check.status}`,\n              style: {\n                borderLeftColor: getStatusColor(check.status)\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"check-icon\",\n                children: [check.icon, \" \", getStatusIcon(check.status)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 589,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"check-content\",\n                children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                  children: key.replace(/([A-Z])/g, ' $1').trim()\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 591,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  children: check.message\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 592,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 590,\n                columnNumber: 19\n              }, this)]\n            }, key, true, {\n              fileName: _jsxFileName,\n              lineNumber: 584,\n              columnNumber: 17\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 582,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 580,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 537,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"instructions-box\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          children: \"\\u26A0\\uFE0F Critical Requirements\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 601,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          children: [/*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Face Registration Required:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 603,\n              columnNumber: 17\n            }, this), \" You must have registered your face before taking exams\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 603,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Identity Verification:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 604,\n              columnNumber: 17\n            }, this), \" Your face will be matched against your registered profile\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 604,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Continuous Monitoring:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 605,\n              columnNumber: 17\n            }, this), \" Identity verification continues throughout the exam\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 605,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Single Person Only:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 606,\n              columnNumber: 17\n            }, this), \" Ensure you are alone in the room\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 606,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Good Lighting:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 607,\n              columnNumber: 17\n            }, this), \" Face must be clearly visible\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 607,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Timer Starts After:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 608,\n              columnNumber: 17\n            }, this), \" Timer begins only after you click \\\"Start Exam\\\" on next page\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 608,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 602,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 600,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"action-buttons\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleCancel,\n          className: \"btn-cancel\",\n          children: \"\\u274C Cancel\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 613,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleManualCheck,\n          className: \"btn-test\",\n          disabled: status === \"checking\",\n          children: isManualCheck ? \"üîÑ Verifying...\" : \"üîÑ Re-verify Identity\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 617,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleStartExam,\n          className: \"btn-start\",\n          disabled: !allChecksPassed || !currentFaceMatch || status === \"checking\",\n          children: allChecksPassed && currentFaceMatch ? \"‚úÖ Start Exam\" : \"‚ö†Ô∏è Verification Required\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 625,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 612,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"verification-info\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"info-text\",\n          children: [\"\\uD83D\\uDEE1\\uFE0F \", /*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Security Notice:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 636,\n            columnNumber: 17\n          }, this), \" All verification attempts are logged. Repeated verification failures may result in account review.\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 635,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 634,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 522,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 521,\n    columnNumber: 5\n  }, this);\n}\n_s(PreExamSetup, \"zmC0P8bEHVK2Ve69IApFA5FIlAQ=\", false, function () {\n  return [useParams, useNavigate];\n});\n_c = PreExamSetup;\nvar _c;\n$RefreshReg$(_c, \"PreExamSetup\");","map":{"version":3,"names":["React","useEffect","useRef","useState","faceapi","useNavigate","useParams","jsxDEV","_jsxDEV","PreExamSetup","user","_s","_examDetails$question","examId","videoRef","canvasRef","navigate","verificationAttempts","status","setStatus","message","setMessage","checks","setChecks","camera","icon","lighting","faceDetection","faceVerification","environment","modelsLoaded","setModelsLoaded","registeredDescriptor","setRegisteredDescriptor","allChecksPassed","setAllChecksPassed","examDetails","setExamDetails","isManualCheck","setIsManualCheck","currentFaceMatch","setCurrentFaceMatch","verificationScore","setVerificationScore","initializePreExam","stopCamera","faceStatus","checkFaceRegistrationStatus","setTimeout","fetchExamDetails","loadModels","loadRegisteredFace","startCamera","runAllChecks","error","console","token","localStorage","getItem","response","fetch","headers","Authorization","ok","data","json","isFaceRegistered","Error","updateCheck","MODEL_URL","process","env","PUBLIC_URL","Promise","all","nets","tinyFaceDetector","loadFromUri","faceLandmark68Net","faceRecognitionNet","log","faceDescriptor","Array","isArray","length","Float32Array","stream","navigator","mediaDevices","getUserMedia","video","width","ideal","height","facingMode","current","srcObject","resolve","onloadedmetadata","play","getTracks","forEach","track","stop","checkName","prev","checkLighting","faceCheckPassed","checkFaceDetectionAndVerification","checkEnvironment","allPassed","Object","values","every","check","canvas","document","createElement","videoWidth","videoHeight","ctx","getContext","drawImage","imageData","getImageData","totalBrightness","i","brightness","avgBrightness","Math","round","bestMatch","bestDistance","Infinity","attempts","detection","detectSingleFace","TinyFaceDetectorOptions","inputSize","withFaceLandmarks","withFaceDescriptor","distance","euclideanDistance","descriptor","dims","matchDimensions","resizedDetection","resizeResults","clearRect","strokeStyle","lineWidth","draw","drawDetections","drawFaceLandmarks","similarity","max","toFixed","name","alert","detections","detectAllFaces","handleManualCheck","handleStartExam","window","confirm","logPreExamVerification","method","body","JSON","stringify","verificationStatus","confidence","details","handleCancel","getStatusIcon","getStatusColor","className","children","fileName","_jsxFileName","lineNumber","columnNumber","title","questions","durationMins","ref","autoPlay","muted","playsInline","onLoadedMetadata","entries","map","key","style","borderLeftColor","replace","trim","onClick","disabled","_c","$RefreshReg$"],"sources":["C:/Online Exam Proctoring System/frontend/src/components/PreExamSetup.js"],"sourcesContent":["// frontend/src/components/PreExamSetup.js - ENHANCED VERSION\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport * as faceapi from \"face-api.js\";\r\nimport { useNavigate, useParams } from \"react-router-dom\";\r\nimport \"./PreExamSetup.css\";\r\n\r\nexport default function PreExamSetup({ user }) {\r\n  const { examId } = useParams();\r\n  const videoRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n  const navigate = useNavigate();\r\n  const verificationAttempts = useRef(0);\r\n\r\n  const [status, setStatus] = useState(\"initializing\");\r\n  const [message, setMessage] = useState(\"Initializing system...\");\r\n  const [checks, setChecks] = useState({\r\n    camera: { status: \"pending\", message: \"Checking camera...\", icon: \"üì∑\" },\r\n    lighting: { status: \"pending\", message: \"Checking lighting...\", icon: \"üí°\" },\r\n    faceDetection: { status: \"pending\", message: \"Detecting face...\", icon: \"üë§\" },\r\n    faceVerification: { status: \"pending\", message: \"Verifying identity...\", icon: \"üîê\" },\r\n    environment: { status: \"pending\", message: \"Checking environment...\", icon: \"üåç\" }\r\n  });\r\n  \r\n  const [modelsLoaded, setModelsLoaded] = useState(false);\r\n  const [registeredDescriptor, setRegisteredDescriptor] = useState(null);\r\n  const [allChecksPassed, setAllChecksPassed] = useState(false);\r\n  const [examDetails, setExamDetails] = useState(null);\r\n  const [isManualCheck, setIsManualCheck] = useState(false);\r\n  const [currentFaceMatch, setCurrentFaceMatch] = useState(null);\r\n  const [verificationScore, setVerificationScore] = useState(0);\r\n\r\n  useEffect(() => {\r\n    initializePreExam();\r\n    return () => stopCamera();\r\n  }, []);\r\n\r\n  const initializePreExam = async () => {\r\n    try {\r\n      setStatus(\"initializing\");\r\n      setMessage(\"Loading system components...\");\r\n\r\n      // Check if face is registered first\r\n      const faceStatus = await checkFaceRegistrationStatus();\r\n      if (!faceStatus) {\r\n        setStatus(\"error\");\r\n        setMessage(\"Face not registered. Please register your face first.\");\r\n        setTimeout(() => {\r\n          navigate(\"/face-registration\");\r\n        }, 3000);\r\n        return;\r\n      }\r\n\r\n      // Load exam details\r\n      await fetchExamDetails();\r\n      \r\n      // Load face-api models\r\n      await loadModels();\r\n      \r\n      // Load registered face descriptor\r\n      await loadRegisteredFace();\r\n      \r\n      // Start camera\r\n      await startCamera();\r\n      \r\n      // Run all checks\r\n      await runAllChecks();\r\n    } catch (error) {\r\n      console.error(\"Initialization error:\", error);\r\n      setStatus(\"error\");\r\n      setMessage(error.message || \"System initialization failed\");\r\n    }\r\n  };\r\n\r\n  const checkFaceRegistrationStatus = async () => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      const response = await fetch(\"http://localhost:4000/api/auth/face-status\", {\r\n        headers: { Authorization: `Bearer ${token}` }\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        return data.isFaceRegistered;\r\n      }\r\n      return false;\r\n    } catch (error) {\r\n      console.error(\"Error checking face registration:\", error);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const fetchExamDetails = async () => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      const response = await fetch(\r\n        `http://localhost:4000/api/exam/paper/${examId}`,\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setExamDetails(data);\r\n      } else {\r\n        throw new Error(\"Failed to load exam details\");\r\n      }\r\n    } catch (error) {\r\n      throw new Error(\"Cannot load exam. Please try again.\");\r\n    }\r\n  };\r\n\r\n  const loadModels = async () => {\r\n    try {\r\n      updateCheck(\"camera\", \"pending\", \"Loading face detection models...\");\r\n      const MODEL_URL = process.env.PUBLIC_URL + \"/models\";\r\n      \r\n      await Promise.all([\r\n        faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),\r\n        faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\r\n        faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL),\r\n      ]);\r\n      \r\n      setModelsLoaded(true);\r\n      console.log(\"‚úÖ Face detection models loaded successfully\");\r\n    } catch (error) {\r\n      console.error(\"Model loading error:\", error);\r\n      throw new Error(\"Failed to load face detection models. Please refresh the page.\");\r\n    }\r\n  };\r\n\r\n  const loadRegisteredFace = async () => {\r\n    try {\r\n      updateCheck(\"faceVerification\", \"pending\", \"Loading your registered face data...\");\r\n      const token = localStorage.getItem(\"token\");\r\n      const response = await fetch(\r\n        \"http://localhost:4000/api/auth/face-descriptor\",\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        if (data.faceDescriptor && Array.isArray(data.faceDescriptor) && data.faceDescriptor.length === 128) {\r\n          setRegisteredDescriptor(new Float32Array(data.faceDescriptor));\r\n          console.log(\"‚úÖ Registered face data loaded\");\r\n        } else {\r\n          throw new Error(\"Invalid face descriptor format\");\r\n        }\r\n      } else {\r\n        throw new Error(\"Face not registered\");\r\n      }\r\n    } catch (error) {\r\n      updateCheck(\"faceVerification\", \"failed\", \"‚ùå Face not registered. Please register first.\");\r\n      throw new Error(\"Please register your face before taking exams\");\r\n    }\r\n  };\r\n\r\n  const startCamera = async () => {\r\n    try {\r\n      updateCheck(\"camera\", \"pending\", \"Starting camera...\");\r\n      \r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        video: { \r\n          width: { ideal: 1280 },\r\n          height: { ideal: 720 },\r\n          facingMode: \"user\"\r\n        },\r\n      });\r\n      \r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n        \r\n        // Wait for video to be ready\r\n        await new Promise((resolve) => {\r\n          videoRef.current.onloadedmetadata = () => {\r\n            videoRef.current.play();\r\n            resolve();\r\n          };\r\n        });\r\n        \r\n        updateCheck(\"camera\", \"passed\", \"‚úÖ Camera is working properly\");\r\n        console.log(\"‚úÖ Camera started successfully\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Camera error:\", error);\r\n      updateCheck(\"camera\", \"failed\", \"‚ùå Cannot access camera. Please grant permission.\");\r\n      throw new Error(\"Camera access denied. Please enable camera in browser settings.\");\r\n    }\r\n  };\r\n\r\n  const stopCamera = () => {\r\n    if (videoRef.current && videoRef.current.srcObject) {\r\n      videoRef.current.srcObject.getTracks().forEach(track => track.stop());\r\n      console.log(\"üõë Camera stopped\");\r\n    }\r\n  };\r\n\r\n  const updateCheck = (checkName, status, message) => {\r\n    setChecks(prev => ({\r\n      ...prev,\r\n      [checkName]: { ...prev[checkName], status, message }\r\n    }));\r\n  };\r\n\r\n  const runAllChecks = async () => {\r\n    setStatus(\"checking\");\r\n    setMessage(\"Running comprehensive pre-exam verification...\");\r\n\r\n    try {\r\n      // Wait a moment for camera to stabilize\r\n      await new Promise(resolve => setTimeout(resolve, 1000));\r\n\r\n      // Check lighting\r\n      await checkLighting();\r\n      await new Promise(resolve => setTimeout(resolve, 500));\r\n      \r\n      // Check face detection and verification (most important)\r\n      const faceCheckPassed = await checkFaceDetectionAndVerification();\r\n      \r\n      if (!faceCheckPassed) {\r\n        setStatus(\"failed\");\r\n        setMessage(\"‚ùå Identity verification failed. Cannot proceed with exam.\");\r\n        setAllChecksPassed(false);\r\n        return;\r\n      }\r\n\r\n      await new Promise(resolve => setTimeout(resolve, 500));\r\n      \r\n      // Check environment\r\n      await checkEnvironment();\r\n      \r\n      // Final verification\r\n      const allPassed = Object.values(checks).every(\r\n        check => check.status === \"passed\" || check.status === \"warning\"\r\n      );\r\n      \r\n      setAllChecksPassed(allPassed);\r\n      \r\n      if (allPassed) {\r\n        setStatus(\"ready\");\r\n        setMessage(\"‚úÖ All checks passed! Identity verified. You're ready to start the exam.\");\r\n      } else {\r\n        setStatus(\"incomplete\");\r\n        setMessage(\"‚ö†Ô∏è Some checks failed. Please resolve all issues before proceeding.\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Check error:\", error);\r\n      setStatus(\"error\");\r\n      setMessage(\"Error during verification: \" + error.message);\r\n    }\r\n  };\r\n\r\n  const checkLighting = async () => {\r\n    try {\r\n      updateCheck(\"lighting\", \"pending\", \"Analyzing lighting conditions...\");\r\n      \r\n      if (!videoRef.current) {\r\n        updateCheck(\"lighting\", \"failed\", \"‚ùå Video not ready\");\r\n        return;\r\n      }\r\n\r\n      const canvas = document.createElement(\"canvas\");\r\n      canvas.width = videoRef.current.videoWidth;\r\n      canvas.height = videoRef.current.videoHeight;\r\n      const ctx = canvas.getContext(\"2d\");\r\n      ctx.drawImage(videoRef.current, 0, 0);\r\n\r\n      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n      const data = imageData.data;\r\n      \r\n      let totalBrightness = 0;\r\n      for (let i = 0; i < data.length; i += 4) {\r\n        const brightness = (data[i] + data[i + 1] + data[i + 2]) / 3;\r\n        totalBrightness += brightness;\r\n      }\r\n      \r\n      const avgBrightness = totalBrightness / (data.length / 4);\r\n      \r\n      if (avgBrightness < 50) {\r\n        updateCheck(\"lighting\", \"failed\", \"‚ùå Too dark. Please improve lighting conditions.\");\r\n      } else if (avgBrightness > 200) {\r\n        updateCheck(\"lighting\", \"warning\", \"‚ö†Ô∏è Too bright. Consider adjusting lighting.\");\r\n      } else {\r\n        updateCheck(\"lighting\", \"passed\", `‚úÖ Lighting is good (${Math.round(avgBrightness)}/255)`);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Lighting check error:\", error);\r\n      updateCheck(\"lighting\", \"failed\", \"‚ùå Failed to check lighting\");\r\n    }\r\n  };\r\n\r\n  const checkFaceDetectionAndVerification = async () => {\r\n    try {\r\n      updateCheck(\"faceDetection\", \"pending\", \"Detecting your face...\");\r\n      updateCheck(\"faceVerification\", \"pending\", \"Verifying your identity...\");\r\n      \r\n      if (!videoRef.current || !modelsLoaded || !registeredDescriptor) {\r\n        updateCheck(\"faceDetection\", \"failed\", \"‚ùå System not ready\");\r\n        updateCheck(\"faceVerification\", \"failed\", \"‚ùå Cannot verify identity\");\r\n        return false;\r\n      }\r\n\r\n      // Multiple attempts for better accuracy\r\n      let bestMatch = null;\r\n      let bestDistance = Infinity;\r\n      const attempts = 3;\r\n\r\n      for (let i = 0; i < attempts; i++) {\r\n        const detection = await faceapi\r\n          .detectSingleFace(videoRef.current, new faceapi.TinyFaceDetectorOptions({ inputSize: 224 }))\r\n          .withFaceLandmarks()\r\n          .withFaceDescriptor();\r\n\r\n        if (!detection) {\r\n          if (i === attempts - 1) {\r\n            updateCheck(\"faceDetection\", \"failed\", \"‚ùå No face detected. Please position yourself clearly.\");\r\n            updateCheck(\"faceVerification\", \"failed\", \"‚ùå Cannot verify without face detection.\");\r\n            return false;\r\n          }\r\n          await new Promise(resolve => setTimeout(resolve, 500));\r\n          continue;\r\n        }\r\n\r\n        // Calculate distance\r\n        const distance = faceapi.euclideanDistance(\r\n          registeredDescriptor,\r\n          detection.descriptor\r\n        );\r\n\r\n        if (distance < bestDistance) {\r\n          bestDistance = distance;\r\n          bestMatch = detection;\r\n        }\r\n\r\n        // Draw detection on canvas\r\n        if (canvasRef.current && i === attempts - 1) {\r\n          const dims = faceapi.matchDimensions(canvasRef.current, videoRef.current, true);\r\n          const resizedDetection = faceapi.resizeResults(detection, dims);\r\n          const ctx = canvasRef.current.getContext(\"2d\");\r\n          ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\r\n          \r\n          // Draw with color based on match\r\n          if (bestDistance < 0.6) {\r\n            ctx.strokeStyle = \"#10b981\"; // Green for match\r\n          } else {\r\n            ctx.strokeStyle = \"#ef4444\"; // Red for no match\r\n          }\r\n          ctx.lineWidth = 3;\r\n          \r\n          faceapi.draw.drawDetections(canvasRef.current, resizedDetection);\r\n          faceapi.draw.drawFaceLandmarks(canvasRef.current, resizedDetection);\r\n        }\r\n\r\n        await new Promise(resolve => setTimeout(resolve, 500));\r\n      }\r\n\r\n      if (!bestMatch) {\r\n        updateCheck(\"faceDetection\", \"failed\", \"‚ùå No face detected after multiple attempts.\");\r\n        updateCheck(\"faceVerification\", \"failed\", \"‚ùå Identity verification failed.\");\r\n        return false;\r\n      }\r\n\r\n      // Face detected successfully\r\n      updateCheck(\"faceDetection\", \"passed\", \"‚úÖ Face detected successfully\");\r\n\r\n      // Verify identity\r\n      const similarity = Math.max(0, (1 - bestDistance) * 100);\r\n      setVerificationScore(similarity.toFixed(1));\r\n      setCurrentFaceMatch(bestDistance < 0.6);\r\n\r\n      console.log(`Identity verification: Distance=${bestDistance.toFixed(3)}, Similarity=${similarity.toFixed(1)}%`);\r\n\r\n      if (bestDistance < 0.6) {\r\n        updateCheck(\r\n          \"faceVerification\",\r\n          \"passed\",\r\n          `‚úÖ Identity verified! Match: ${similarity.toFixed(1)}% (${user.name})`\r\n        );\r\n        verificationAttempts.current = 0;\r\n        return true;\r\n      } else {\r\n        verificationAttempts.current++;\r\n        updateCheck(\r\n          \"faceVerification\",\r\n          \"failed\",\r\n          `‚ùå Identity mismatch (${similarity.toFixed(1)}% match). Expected: ${user.name}`\r\n        );\r\n        \r\n        if (verificationAttempts.current >= 3) {\r\n          alert(\"‚ùå Identity verification failed multiple times. Please ensure you are the registered student.\");\r\n        }\r\n        return false;\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Face detection/verification error:\", error);\r\n      updateCheck(\"faceDetection\", \"failed\", \"‚ùå Error during face detection\");\r\n      updateCheck(\"faceVerification\", \"failed\", \"‚ùå Error during identity verification\");\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const checkEnvironment = async () => {\r\n    try {\r\n      updateCheck(\"environment\", \"pending\", \"Checking for multiple people...\");\r\n      \r\n      if (!videoRef.current || !modelsLoaded) {\r\n        updateCheck(\"environment\", \"warning\", \"‚ö†Ô∏è Unable to verify environment\");\r\n        return;\r\n      }\r\n\r\n      const detections = await faceapi.detectAllFaces(\r\n        videoRef.current,\r\n        new faceapi.TinyFaceDetectorOptions()\r\n      );\r\n\r\n      if (detections.length === 0) {\r\n        updateCheck(\"environment\", \"warning\", \"‚ö†Ô∏è No face detected in frame.\");\r\n      } else if (detections.length === 1) {\r\n        updateCheck(\"environment\", \"passed\", \"‚úÖ Single person detected. Environment is clear.\");\r\n      } else {\r\n        updateCheck(\r\n          \"environment\",\r\n          \"failed\",\r\n          `‚ùå Multiple people detected (${detections.length}). Ensure you're alone.`\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Environment check error:\", error);\r\n      updateCheck(\"environment\", \"warning\", \"‚ö†Ô∏è Unable to check environment\");\r\n    }\r\n  };\r\n\r\n  const handleManualCheck = async () => {\r\n    setIsManualCheck(true);\r\n    setStatus(\"checking\");\r\n    setMessage(\"Running manual verification...\");\r\n    verificationAttempts.current = 0;\r\n    await runAllChecks();\r\n    setIsManualCheck(false);\r\n  };\r\n\r\n  const handleStartExam = () => {\r\n    if (!allChecksPassed) {\r\n      alert(\"‚ö†Ô∏è Please resolve all verification issues before starting the exam.\");\r\n      return;\r\n    }\r\n\r\n    if (!currentFaceMatch) {\r\n      alert(\"‚ùå Identity verification failed. You must be the registered student to take this exam.\");\r\n      return;\r\n    }\r\n\r\n    if (window.confirm(\r\n      `‚úÖ Identity Verified: ${user.name}\\n\\n` +\r\n      `Match Score: ${verificationScore}%\\n\\n` +\r\n      `‚ö†Ô∏è Important Reminders:\\n` +\r\n      `‚Ä¢ Timer will start ONLY when you begin the exam\\n` +\r\n      `‚Ä¢ Your identity will be verified continuously\\n` +\r\n      `‚Ä¢ Keep your face visible at all times\\n` +\r\n      `‚Ä¢ Multiple face detection will be logged\\n` +\r\n      `‚Ä¢ Tab switching is monitored\\n` +\r\n      `‚Ä¢ Exam will auto-submit on violations\\n\\n` +\r\n      `Are you ready to start?`\r\n    )) {\r\n      // Log successful pre-exam verification\r\n      logPreExamVerification();\r\n      \r\n      // Stop camera and navigate to exam\r\n      stopCamera();\r\n      navigate(`/exam/${examId}`);\r\n    }\r\n  };\r\n\r\n  const logPreExamVerification = async () => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      await fetch(\"http://localhost:4000/api/exam/verify-face\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${token}`\r\n        },\r\n        body: JSON.stringify({\r\n          examId,\r\n          verificationStatus: \"verified\",\r\n          confidence: verificationScore,\r\n          details: `Pre-exam verification successful for ${user.name}`\r\n        })\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Error logging verification:\", error);\r\n    }\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    if (window.confirm(\"Are you sure you want to cancel? You'll need to restart the verification process.\")) {\r\n      stopCamera();\r\n      navigate(\"/student/dashboard\");\r\n    }\r\n  };\r\n\r\n  const getStatusIcon = (status) => {\r\n    switch (status) {\r\n      case \"passed\": return \"‚úÖ\";\r\n      case \"failed\": return \"‚ùå\";\r\n      case \"warning\": return \"‚ö†Ô∏è\";\r\n      case \"pending\": return \"‚è≥\";\r\n      default: return \"‚è≥\";\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status) => {\r\n    switch (status) {\r\n      case \"passed\": return \"#10b981\";\r\n      case \"failed\": return \"#ef4444\";\r\n      case \"warning\": return \"#f59e0b\";\r\n      case \"pending\": return \"#6b7280\";\r\n      default: return \"#6b7280\";\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"pre-exam-container\">\r\n      <div className=\"pre-exam-card\">\r\n        <div className=\"pre-exam-header\">\r\n          <h2>üîí Identity Verification Required</h2>\r\n          {examDetails && (\r\n            <div className=\"exam-info\">\r\n              <h3>{examDetails.title}</h3>\r\n              <p>\r\n                üìù {examDetails.questions?.length || 0} Questions ‚Ä¢ \r\n                ‚è±Ô∏è {examDetails.durationMins || 30} Minutes ‚Ä¢ \r\n                üë§ Registered Student: <strong>{user.name}</strong>\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"verification-area\">\r\n          <div className=\"camera-section\">\r\n            <div className=\"camera-container\">\r\n              <video\r\n                ref={videoRef}\r\n                autoPlay\r\n                muted\r\n                playsInline\r\n                className=\"camera-video\"\r\n                onLoadedMetadata={() => {\r\n                  if (canvasRef.current && videoRef.current) {\r\n                    canvasRef.current.width = videoRef.current.videoWidth;\r\n                    canvasRef.current.height = videoRef.current.videoHeight;\r\n                  }\r\n                }}\r\n              />\r\n              <canvas ref={canvasRef} className=\"detection-canvas\" />\r\n              \r\n              {verificationScore > 0 && (\r\n                <div className={`match-overlay ${currentFaceMatch ? 'match' : 'no-match'}`}>\r\n                  {currentFaceMatch ? (\r\n                    <div className=\"match-success\">\r\n                      <span className=\"match-icon\">‚úÖ</span>\r\n                      <span className=\"match-text\">Identity Verified</span>\r\n                      <span className=\"match-score\">{verificationScore}%</span>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"match-fail\">\r\n                      <span className=\"match-icon\">‚ùå</span>\r\n                      <span className=\"match-text\">Identity Mismatch</span>\r\n                      <span className=\"match-score\">{verificationScore}%</span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n            \r\n            <div className=\"status-display\">\r\n              <div className={`status-indicator ${status}`}></div>\r\n              <p className=\"status-message\">{message}</p>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"checks-section\">\r\n            <h3>Verification Checklist</h3>\r\n            <div className=\"checks-list\">\r\n              {Object.entries(checks).map(([key, check]) => (\r\n                <div\r\n                  key={key}\r\n                  className={`check-item ${check.status}`}\r\n                  style={{ borderLeftColor: getStatusColor(check.status) }}\r\n                >\r\n                  <span className=\"check-icon\">{check.icon} {getStatusIcon(check.status)}</span>\r\n                  <div className=\"check-content\">\r\n                    <strong>{key.replace(/([A-Z])/g, ' $1').trim()}</strong>\r\n                    <p>{check.message}</p>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"instructions-box\">\r\n          <h4>‚ö†Ô∏è Critical Requirements</h4>\r\n          <ul>\r\n            <li><strong>Face Registration Required:</strong> You must have registered your face before taking exams</li>\r\n            <li><strong>Identity Verification:</strong> Your face will be matched against your registered profile</li>\r\n            <li><strong>Continuous Monitoring:</strong> Identity verification continues throughout the exam</li>\r\n            <li><strong>Single Person Only:</strong> Ensure you are alone in the room</li>\r\n            <li><strong>Good Lighting:</strong> Face must be clearly visible</li>\r\n            <li><strong>Timer Starts After:</strong> Timer begins only after you click \"Start Exam\" on next page</li>\r\n          </ul>\r\n        </div>\r\n\r\n        <div className=\"action-buttons\">\r\n          <button onClick={handleCancel} className=\"btn-cancel\">\r\n            ‚ùå Cancel\r\n          </button>\r\n          \r\n          <button \r\n            onClick={handleManualCheck} \r\n            className=\"btn-test\"\r\n            disabled={status === \"checking\"}\r\n          >\r\n            {isManualCheck ? \"üîÑ Verifying...\" : \"üîÑ Re-verify Identity\"}\r\n          </button>\r\n          \r\n          <button\r\n            onClick={handleStartExam}\r\n            className=\"btn-start\"\r\n            disabled={!allChecksPassed || !currentFaceMatch || status === \"checking\"}\r\n          >\r\n            {allChecksPassed && currentFaceMatch ? \"‚úÖ Start Exam\" : \"‚ö†Ô∏è Verification Required\"}\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"verification-info\">\r\n          <p className=\"info-text\">\r\n            üõ°Ô∏è <strong>Security Notice:</strong> All verification attempts are logged. \r\n            Repeated verification failures may result in account review.\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}