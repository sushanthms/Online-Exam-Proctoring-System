{"ast":null,"code":"var _jsxFileName = \"C:\\\\Online Exam Proctoring System\\\\frontend\\\\src\\\\components\\\\PreExamSetup.js\",\n  _s = $RefreshSig$();\n// frontend/src/components/PreExamSetup.js - FIXED VERSION WITH IMPROVED VERIFICATION\nimport React, { useEffect, useRef, useState } from \"react\";\nimport * as faceapi from \"face-api.js\";\nimport { useNavigate, useParams } from \"react-router-dom\";\nimport \"./PreExamSetup.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function PreExamSetup({\n  user\n}) {\n  _s();\n  var _examDetails$question;\n  const {\n    examId\n  } = useParams();\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const navigate = useNavigate();\n  const verificationAttempts = useRef(0);\n  const [status, setStatus] = useState(\"initializing\");\n  const [message, setMessage] = useState(\"Initializing system...\");\n  const [checks, setChecks] = useState({\n    camera: {\n      status: \"pending\",\n      message: \"Checking camera...\",\n      icon: \"üì∑\"\n    },\n    lighting: {\n      status: \"pending\",\n      message: \"Checking lighting...\",\n      icon: \"üí°\"\n    },\n    faceDetection: {\n      status: \"pending\",\n      message: \"Detecting face...\",\n      icon: \"üë§\"\n    },\n    faceVerification: {\n      status: \"pending\",\n      message: \"Verifying identity...\",\n      icon: \"üîê\"\n    },\n    environment: {\n      status: \"pending\",\n      message: \"Checking environment...\",\n      icon: \"üåç\"\n    }\n  });\n  const [modelsLoaded, setModelsLoaded] = useState(false);\n  const [registeredDescriptor, setRegisteredDescriptor] = useState(null);\n  const [allChecksPassed, setAllChecksPassed] = useState(false);\n  const [examDetails, setExamDetails] = useState(null);\n  const [isManualCheck, setIsManualCheck] = useState(false);\n  const [currentFaceMatch, setCurrentFaceMatch] = useState(null);\n  const [verificationScore, setVerificationScore] = useState(0);\n\n  // IMPROVED THRESHOLD - More lenient for better user experience\n  const VERIFICATION_THRESHOLD = 0.65; // Increased from 0.6\n  const MIN_ACCEPTABLE_DISTANCE = 0.70; // Warning threshold\n\n  useEffect(() => {\n    initializePreExam();\n    return () => stopCamera();\n  }, []);\n  const initializePreExam = async () => {\n    try {\n      setStatus(\"initializing\");\n      setMessage(\"Loading system components...\");\n\n      // Check if face is registered first\n      const faceStatus = await checkFaceRegistrationStatus();\n      if (!faceStatus) {\n        setStatus(\"error\");\n        setMessage(\"Face not registered. Please register your face first.\");\n        setTimeout(() => {\n          navigate(\"/face-registration\");\n        }, 3000);\n        return;\n      }\n\n      // Load exam details\n      await fetchExamDetails();\n\n      // Load face-api models\n      await loadModels();\n\n      // Load registered face descriptor\n      await loadRegisteredFace();\n\n      // Start camera\n      await startCamera();\n\n      // Run all checks\n      await runAllChecks();\n    } catch (error) {\n      console.error(\"Initialization error:\", error);\n      setStatus(\"error\");\n      setMessage(error.message || \"System initialization failed\");\n    }\n  };\n  const checkFaceRegistrationStatus = async () => {\n    try {\n      const token = localStorage.getItem(\"token\");\n      const response = await fetch(\"http://localhost:4000/api/auth/face-status\", {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      if (response.ok) {\n        const data = await response.json();\n        return data.isFaceRegistered;\n      }\n      return false;\n    } catch (error) {\n      console.error(\"Error checking face registration:\", error);\n      return false;\n    }\n  };\n  const fetchExamDetails = async () => {\n    try {\n      const token = localStorage.getItem(\"token\");\n      const response = await fetch(`http://localhost:4000/api/exam/paper/${examId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setExamDetails(data);\n      } else {\n        throw new Error(\"Failed to load exam details\");\n      }\n    } catch (error) {\n      throw new Error(\"Cannot load exam. Please try again.\");\n    }\n  };\n  const loadModels = async () => {\n    try {\n      updateCheck(\"camera\", \"pending\", \"Loading face detection models...\");\n      const MODEL_URL = process.env.PUBLIC_URL + \"/models\";\n      await Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL), faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL), faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)]);\n      setModelsLoaded(true);\n      console.log(\"‚úÖ Face detection models loaded successfully\");\n    } catch (error) {\n      console.error(\"Model loading error:\", error);\n      throw new Error(\"Failed to load face detection models. Please refresh the page.\");\n    }\n  };\n  const loadRegisteredFace = async () => {\n    try {\n      updateCheck(\"faceVerification\", \"pending\", \"Loading your registered face data...\");\n      const token = localStorage.getItem(\"token\");\n      const response = await fetch(\"http://localhost:4000/api/auth/face-descriptor\", {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      if (response.ok) {\n        const data = await response.json();\n        if (data.faceDescriptor && Array.isArray(data.faceDescriptor) && data.faceDescriptor.length === 128) {\n          setRegisteredDescriptor(new Float32Array(data.faceDescriptor));\n          console.log(\"‚úÖ Registered face data loaded\");\n        } else {\n          throw new Error(\"Invalid face descriptor format\");\n        }\n      } else {\n        throw new Error(\"Face not registered\");\n      }\n    } catch (error) {\n      updateCheck(\"faceVerification\", \"failed\", \"‚ùå Face not registered. Please register first.\");\n      throw new Error(\"Please register your face before taking exams\");\n    }\n  };\n  const startCamera = async () => {\n    try {\n      updateCheck(\"camera\", \"pending\", \"Starting camera...\");\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          width: {\n            ideal: 1280\n          },\n          height: {\n            ideal: 720\n          },\n          facingMode: \"user\"\n        }\n      });\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n\n        // Wait for video to be ready\n        await new Promise(resolve => {\n          videoRef.current.onloadedmetadata = () => {\n            videoRef.current.play();\n            resolve();\n          };\n        });\n        updateCheck(\"camera\", \"passed\", \"‚úÖ Camera is working properly\");\n        console.log(\"‚úÖ Camera started successfully\");\n      }\n    } catch (error) {\n      console.error(\"Camera error:\", error);\n      updateCheck(\"camera\", \"failed\", \"‚ùå Cannot access camera. Please grant permission.\");\n      throw new Error(\"Camera access denied. Please enable camera in browser settings.\");\n    }\n  };\n  const stopCamera = () => {\n    if (videoRef.current && videoRef.current.srcObject) {\n      videoRef.current.srcObject.getTracks().forEach(track => track.stop());\n      console.log(\"üõë Camera stopped\");\n    }\n  };\n  const updateCheck = (checkName, status, message) => {\n    setChecks(prev => ({\n      ...prev,\n      [checkName]: {\n        ...prev[checkName],\n        status,\n        message\n      }\n    }));\n  };\n  const runAllChecks = async () => {\n    setStatus(\"checking\");\n    setMessage(\"Running comprehensive pre-exam verification...\");\n    try {\n      // Wait a moment for camera to stabilize\n      await new Promise(resolve => setTimeout(resolve, 2000));\n\n      // Check lighting\n      await checkLighting();\n      await new Promise(resolve => setTimeout(resolve, 500));\n\n      // Check face detection and verification (most important)\n      const faceCheckPassed = await checkFaceDetectionAndVerification();\n      if (!faceCheckPassed) {\n        setStatus(\"incomplete\");\n        setMessage(\"‚ö†Ô∏è Please adjust position and lighting for better verification\");\n        setAllChecksPassed(false);\n        return;\n      }\n      await new Promise(resolve => setTimeout(resolve, 500));\n\n      // Check environment\n      await checkEnvironment();\n\n      // Final verification\n      const allPassed = Object.values(checks).every(check => check.status === \"passed\" || check.status === \"warning\");\n      setAllChecksPassed(allPassed && faceCheckPassed);\n      if (allPassed && faceCheckPassed) {\n        setStatus(\"ready\");\n        setMessage(\"‚úÖ All checks passed! Identity verified. You're ready to start the exam.\");\n      } else {\n        setStatus(\"incomplete\");\n        setMessage(\"‚ö†Ô∏è Please resolve all issues before proceeding.\");\n      }\n    } catch (error) {\n      console.error(\"Check error:\", error);\n      setStatus(\"error\");\n      setMessage(\"Error during verification: \" + error.message);\n    }\n  };\n  const checkLighting = async () => {\n    try {\n      updateCheck(\"lighting\", \"pending\", \"Analyzing lighting conditions...\");\n      if (!videoRef.current) {\n        updateCheck(\"lighting\", \"failed\", \"‚ùå Video not ready\");\n        return;\n      }\n      const canvas = document.createElement(\"canvas\");\n      canvas.width = videoRef.current.videoWidth;\n      canvas.height = videoRef.current.videoHeight;\n      const ctx = canvas.getContext(\"2d\");\n      ctx.drawImage(videoRef.current, 0, 0);\n      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n      const data = imageData.data;\n      let totalBrightness = 0;\n      for (let i = 0; i < data.length; i += 4) {\n        const brightness = (data[i] + data[i + 1] + data[i + 2]) / 3;\n        totalBrightness += brightness;\n      }\n      const avgBrightness = totalBrightness / (data.length / 4);\n      if (avgBrightness < 50) {\n        updateCheck(\"lighting\", \"warning\", \"‚ö†Ô∏è Low lighting detected. Please improve lighting for better results.\");\n      } else if (avgBrightness > 200) {\n        updateCheck(\"lighting\", \"warning\", \"‚ö†Ô∏è Very bright. Consider adjusting lighting.\");\n      } else {\n        updateCheck(\"lighting\", \"passed\", `‚úÖ Lighting is good (${Math.round(avgBrightness)}/255)`);\n      }\n    } catch (error) {\n      console.error(\"Lighting check error:\", error);\n      updateCheck(\"lighting\", \"warning\", \"‚ö†Ô∏è Unable to check lighting\");\n    }\n  };\n  const checkFaceDetectionAndVerification = async () => {\n    try {\n      updateCheck(\"faceDetection\", \"pending\", \"Detecting your face...\");\n      updateCheck(\"faceVerification\", \"pending\", \"Verifying your identity...\");\n      if (!videoRef.current || !modelsLoaded || !registeredDescriptor) {\n        updateCheck(\"faceDetection\", \"failed\", \"‚ùå System not ready\");\n        updateCheck(\"faceVerification\", \"failed\", \"‚ùå Cannot verify identity\");\n        return false;\n      }\n\n      // Multiple attempts with averaging for better accuracy\n      let bestMatch = null;\n      let bestDistance = Infinity;\n      const attempts = 5;\n      const validDetections = [];\n      for (let i = 0; i < attempts; i++) {\n        const detection = await faceapi.detectSingleFace(videoRef.current, new faceapi.TinyFaceDetectorOptions({\n          inputSize: 224,\n          scoreThreshold: 0.5\n        })).withFaceLandmarks().withFaceDescriptor();\n        if (detection) {\n          // CRITICAL: Compare with registered descriptor\n          const distance = faceapi.euclideanDistance(registeredDescriptor, detection.descriptor);\n          validDetections.push({\n            detection,\n            distance\n          });\n          if (distance < bestDistance) {\n            bestDistance = distance;\n            bestMatch = detection;\n          }\n          console.log(`üîç Detection ${i + 1}/${attempts}: Distance = ${distance.toFixed(3)}`);\n        }\n        await new Promise(resolve => setTimeout(resolve, 300));\n      }\n\n      // Check if any face was detected\n      if (validDetections.length === 0) {\n        updateCheck(\"faceDetection\", \"failed\", \"‚ùå No face detected. Please position yourself clearly in front of the camera.\");\n        updateCheck(\"faceVerification\", \"failed\", \"‚ùå Cannot verify without face detection.\");\n        setCurrentFaceMatch(false);\n        return false;\n      }\n\n      // Face detected successfully\n      updateCheck(\"faceDetection\", \"passed\", `‚úÖ Face detected successfully (${validDetections.length}/${attempts} captures)`);\n\n      // Calculate average distance for more stable verification\n      const avgDistance = validDetections.reduce((sum, v) => sum + v.distance, 0) / validDetections.length;\n      const similarity = Math.max(0, (1 - avgDistance) * 100);\n      console.log(`üìä Verification Stats:\n        - Valid Detections: ${validDetections.length}/${attempts}\n        - Best Distance: ${bestDistance.toFixed(3)}\n        - Average Distance: ${avgDistance.toFixed(3)}\n        - Similarity: ${similarity.toFixed(1)}%\n        - Threshold Distance: ${VERIFICATION_THRESHOLD}\n        - Min Acceptable Distance: ${MIN_ACCEPTABLE_DISTANCE}\n        - Expected User: ${user.name}\n      `);\n\n      // Draw best detection on canvas with appropriate color\n      if (canvasRef.current && bestMatch) {\n        const dims = faceapi.matchDimensions(canvasRef.current, videoRef.current, true);\n        const resizedDetection = faceapi.resizeResults(bestMatch, dims);\n        const ctx = canvasRef.current.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n\n        // Color based on match quality\n        if (avgDistance < VERIFICATION_THRESHOLD) {\n          ctx.strokeStyle = \"#10b981\"; // Green for verified match\n          ctx.lineWidth = 4;\n        } else if (avgDistance < MIN_ACCEPTABLE_DISTANCE) {\n          ctx.strokeStyle = \"#f59e0b\"; // Orange for marginal match\n          ctx.lineWidth = 3;\n        } else {\n          ctx.strokeStyle = \"#ef4444\"; // Red for failed match\n          ctx.lineWidth = 3;\n        }\n        faceapi.draw.drawDetections(canvasRef.current, resizedDetection);\n        faceapi.draw.drawFaceLandmarks(canvasRef.current, resizedDetection);\n      }\n      setVerificationScore(similarity.toFixed(1));\n\n      // STRICT VERIFICATION: Only pass if distance is within threshold\n      if (avgDistance < VERIFICATION_THRESHOLD) {\n        // VERIFIED MATCH - This is the registered user\n        setCurrentFaceMatch(true);\n        updateCheck(\"faceVerification\", \"passed\", `‚úÖ Identity verified! Match: ${similarity.toFixed(1)}% - Confirmed: ${user.name}`);\n        verificationAttempts.current = 0;\n        return true;\n      } else if (avgDistance < MIN_ACCEPTABLE_DISTANCE) {\n        // MARGINAL MATCH - Accept with warning\n        setCurrentFaceMatch(true);\n        updateCheck(\"faceVerification\", \"passed\", `‚ö†Ô∏è Identity verified with low confidence: ${similarity.toFixed(1)}% - Please improve lighting for ${user.name}`);\n        verificationAttempts.current = 0;\n        return true;\n      } else {\n        // FAILED MATCH - This is NOT the registered user\n        verificationAttempts.current++;\n        setCurrentFaceMatch(false);\n        const remainingAttempts = 3 - verificationAttempts.current;\n        if (verificationAttempts.current < 3) {\n          updateCheck(\"faceVerification\", \"failed\", `‚ùå Identity verification failed (${similarity.toFixed(1)}%). You don't appear to be ${user.name}. ${remainingAttempts} attempts remaining.`);\n        } else {\n          updateCheck(\"faceVerification\", \"failed\", `‚ùå Maximum attempts reached. Identity does not match ${user.name}. Distance: ${avgDistance.toFixed(3)}`);\n        }\n        console.warn(`‚ö†Ô∏è VERIFICATION FAILED: Distance ${avgDistance.toFixed(3)} exceeds threshold ${VERIFICATION_THRESHOLD}`);\n        return false;\n      }\n    } catch (error) {\n      console.error(\"Face detection/verification error:\", error);\n      updateCheck(\"faceDetection\", \"failed\", \"‚ùå Error during face detection\");\n      updateCheck(\"faceVerification\", \"failed\", \"‚ùå Error during identity verification\");\n      setCurrentFaceMatch(false);\n      return false;\n    }\n  };\n  const checkEnvironment = async () => {\n    try {\n      updateCheck(\"environment\", \"pending\", \"Checking for multiple people...\");\n      if (!videoRef.current || !modelsLoaded) {\n        updateCheck(\"environment\", \"warning\", \"‚ö†Ô∏è Unable to verify environment\");\n        return;\n      }\n      const detections = await faceapi.detectAllFaces(videoRef.current, new faceapi.TinyFaceDetectorOptions({\n        scoreThreshold: 0.5\n      }));\n      if (detections.length === 0) {\n        updateCheck(\"environment\", \"warning\", \"‚ö†Ô∏è No face detected in frame.\");\n      } else if (detections.length === 1) {\n        updateCheck(\"environment\", \"passed\", \"‚úÖ Single person detected. Environment is clear.\");\n      } else {\n        updateCheck(\"environment\", \"warning\", `‚ö†Ô∏è Multiple people detected (${detections.length}). Please ensure you're alone.`);\n      }\n    } catch (error) {\n      console.error(\"Environment check error:\", error);\n      updateCheck(\"environment\", \"warning\", \"‚ö†Ô∏è Unable to check environment\");\n    }\n  };\n  const handleManualCheck = async () => {\n    setIsManualCheck(true);\n    setStatus(\"checking\");\n    setMessage(\"Running manual verification...\");\n    verificationAttempts.current = 0;\n    await runAllChecks();\n    setIsManualCheck(false);\n  };\n  const handleStartExam = () => {\n    if (!allChecksPassed) {\n      alert(\"‚ö†Ô∏è Please complete all verification checks before starting the exam.\");\n      return;\n    }\n    if (!currentFaceMatch) {\n      alert(\"‚ùå Identity verification incomplete. Please retry verification.\");\n      return;\n    }\n    if (window.confirm(`‚úÖ Identity Verified: ${user.name}\\n\\n` + `Match Score: ${verificationScore}%\\n\\n` + `‚ö†Ô∏è Important Reminders:\\n` + `‚Ä¢ Timer will start when you begin the exam\\n` + `‚Ä¢ Your identity will be verified continuously\\n` + `‚Ä¢ Keep your face visible at all times\\n` + `‚Ä¢ Multiple face detection will be logged\\n` + `‚Ä¢ Tab switching is monitored\\n` + `‚Ä¢ Exam will auto-submit on violations\\n\\n` + `Are you ready to start?`)) {\n      // Log successful pre-exam verification\n      logPreExamVerification();\n\n      // Stop camera and navigate to exam\n      stopCamera();\n      navigate(`/exam/${examId}`);\n    }\n  };\n  const logPreExamVerification = async () => {\n    try {\n      const token = localStorage.getItem(\"token\");\n      await fetch(\"http://localhost:4000/api/exam/verify-face\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          examId,\n          verificationStatus: \"verified\",\n          confidence: verificationScore,\n          details: `Pre-exam verification successful for ${user.name}`\n        })\n      });\n    } catch (error) {\n      console.error(\"Error logging verification:\", error);\n    }\n  };\n  const handleCancel = () => {\n    if (window.confirm(\"Are you sure you want to cancel? You'll need to restart the verification process.\")) {\n      stopCamera();\n      navigate(\"/student/dashboard\");\n    }\n  };\n  const getStatusIcon = status => {\n    switch (status) {\n      case \"passed\":\n        return \"‚úÖ\";\n      case \"failed\":\n        return \"‚ùå\";\n      case \"warning\":\n        return \"‚ö†Ô∏è\";\n      case \"pending\":\n        return \"‚è≥\";\n      default:\n        return \"‚è≥\";\n    }\n  };\n  const getStatusColor = status => {\n    switch (status) {\n      case \"passed\":\n        return \"#10b981\";\n      case \"failed\":\n        return \"#ef4444\";\n      case \"warning\":\n        return \"#f59e0b\";\n      case \"pending\":\n        return \"#6b7280\";\n      default:\n        return \"#6b7280\";\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"pre-exam-container\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"pre-exam-card\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"pre-exam-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"\\uD83D\\uDD12 Identity Verification Required\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 568,\n          columnNumber: 11\n        }, this), examDetails && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"exam-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: examDetails.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 571,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [\"\\uD83D\\uDCDD \", ((_examDetails$question = examDetails.questions) === null || _examDetails$question === void 0 ? void 0 : _examDetails$question.length) || 0, \" Questions \\u2022 \\u23F1\\uFE0F \", examDetails.durationMins || 30, \" Minutes \\u2022 \\uD83D\\uDC64 Registered Student: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n              children: user.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 575,\n              columnNumber: 40\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 572,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 570,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 567,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"verification-area\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"camera-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"camera-container\",\n            children: [/*#__PURE__*/_jsxDEV(\"video\", {\n              ref: videoRef,\n              autoPlay: true,\n              muted: true,\n              playsInline: true,\n              className: \"camera-video\",\n              onLoadedMetadata: () => {\n                if (canvasRef.current && videoRef.current) {\n                  canvasRef.current.width = videoRef.current.videoWidth;\n                  canvasRef.current.height = videoRef.current.videoHeight;\n                }\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 584,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n              ref: canvasRef,\n              className: \"detection-canvas\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 597,\n              columnNumber: 15\n            }, this), verificationScore > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `match-overlay ${currentFaceMatch ? 'match' : 'no-match'}`,\n              children: currentFaceMatch ? /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"match-success\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"match-icon\",\n                  children: \"\\u2705\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 603,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"match-text\",\n                  children: \"Identity Verified\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 604,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"match-score\",\n                  children: [verificationScore, \"%\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 605,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 602,\n                columnNumber: 21\n              }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"match-fail\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"match-icon\",\n                  children: \"\\u26A0\\uFE0F\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 609,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"match-text\",\n                  children: \"Please Retry\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 610,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"match-score\",\n                  children: [verificationScore, \"%\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 611,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 608,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 600,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 583,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"status-display\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: `status-indicator ${status}`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 619,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"status-message\",\n              children: message\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 620,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 618,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 582,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"checks-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Verification Checklist\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 625,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"checks-list\",\n            children: Object.entries(checks).map(([key, check]) => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `check-item ${check.status}`,\n              style: {\n                borderLeftColor: getStatusColor(check.status)\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"check-icon\",\n                children: [check.icon, \" \", getStatusIcon(check.status)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 633,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"check-content\",\n                children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                  children: key.replace(/([A-Z])/g, ' $1').trim()\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 635,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  children: check.message\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 636,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 634,\n                columnNumber: 19\n              }, this)]\n            }, key, true, {\n              fileName: _jsxFileName,\n              lineNumber: 628,\n              columnNumber: 17\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 626,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 624,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 581,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"instructions-box\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          children: \"\\uD83D\\uDCA1 Verification Tips\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 645,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          children: [/*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Good Lighting:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 647,\n              columnNumber: 17\n            }, this), \" Ensure your face is well-lit and clearly visible\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 647,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Face Position:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 648,\n              columnNumber: 17\n            }, this), \" Look directly at the camera, keep face centered\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 648,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Remove Obstacles:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 649,\n              columnNumber: 17\n            }, this), \" Take off glasses, hats, or masks if possible\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 649,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Stable Position:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 650,\n              columnNumber: 17\n            }, this), \" Keep your head still during verification\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 650,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Camera Quality:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 651,\n              columnNumber: 17\n            }, this), \" Use a good quality webcam for best results\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 651,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Retry if Needed:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 652,\n              columnNumber: 17\n            }, this), \" Use the Re-verify button to try again with better conditions\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 652,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 646,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 644,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"action-buttons\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleCancel,\n          className: \"btn-cancel\",\n          children: \"\\u274C Cancel\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 657,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleManualCheck,\n          className: \"btn-test\",\n          disabled: status === \"checking\",\n          children: isManualCheck ? \"üîÑ Verifying...\" : \"üîÑ Re-verify Identity\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 661,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleStartExam,\n          className: \"btn-start\",\n          disabled: !allChecksPassed || !currentFaceMatch || status === \"checking\",\n          children: allChecksPassed && currentFaceMatch ? \"‚úÖ Start Exam\" : \"‚ö†Ô∏è Complete Verification\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 669,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 656,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"verification-info\",\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"info-text\",\n          children: [\"\\uD83D\\uDEE1\\uFE0F \", /*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Security Notice:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 680,\n            columnNumber: 17\n          }, this), \" All verification attempts are logged. If you're having trouble, ensure good lighting and camera position, then use the Re-verify button.\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 679,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 678,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 566,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 565,\n    columnNumber: 5\n  }, this);\n}\n_s(PreExamSetup, \"zmC0P8bEHVK2Ve69IApFA5FIlAQ=\", false, function () {\n  return [useParams, useNavigate];\n});\n_c = PreExamSetup;\nvar _c;\n$RefreshReg$(_c, \"PreExamSetup\");","map":{"version":3,"names":["React","useEffect","useRef","useState","faceapi","useNavigate","useParams","jsxDEV","_jsxDEV","PreExamSetup","user","_s","_examDetails$question","examId","videoRef","canvasRef","navigate","verificationAttempts","status","setStatus","message","setMessage","checks","setChecks","camera","icon","lighting","faceDetection","faceVerification","environment","modelsLoaded","setModelsLoaded","registeredDescriptor","setRegisteredDescriptor","allChecksPassed","setAllChecksPassed","examDetails","setExamDetails","isManualCheck","setIsManualCheck","currentFaceMatch","setCurrentFaceMatch","verificationScore","setVerificationScore","VERIFICATION_THRESHOLD","MIN_ACCEPTABLE_DISTANCE","initializePreExam","stopCamera","faceStatus","checkFaceRegistrationStatus","setTimeout","fetchExamDetails","loadModels","loadRegisteredFace","startCamera","runAllChecks","error","console","token","localStorage","getItem","response","fetch","headers","Authorization","ok","data","json","isFaceRegistered","Error","updateCheck","MODEL_URL","process","env","PUBLIC_URL","Promise","all","nets","tinyFaceDetector","loadFromUri","faceLandmark68Net","faceRecognitionNet","log","faceDescriptor","Array","isArray","length","Float32Array","stream","navigator","mediaDevices","getUserMedia","video","width","ideal","height","facingMode","current","srcObject","resolve","onloadedmetadata","play","getTracks","forEach","track","stop","checkName","prev","checkLighting","faceCheckPassed","checkFaceDetectionAndVerification","checkEnvironment","allPassed","Object","values","every","check","canvas","document","createElement","videoWidth","videoHeight","ctx","getContext","drawImage","imageData","getImageData","totalBrightness","i","brightness","avgBrightness","Math","round","bestMatch","bestDistance","Infinity","attempts","validDetections","detection","detectSingleFace","TinyFaceDetectorOptions","inputSize","scoreThreshold","withFaceLandmarks","withFaceDescriptor","distance","euclideanDistance","descriptor","push","toFixed","avgDistance","reduce","sum","v","similarity","max","name","dims","matchDimensions","resizedDetection","resizeResults","clearRect","strokeStyle","lineWidth","draw","drawDetections","drawFaceLandmarks","remainingAttempts","warn","detections","detectAllFaces","handleManualCheck","handleStartExam","alert","window","confirm","logPreExamVerification","method","body","JSON","stringify","verificationStatus","confidence","details","handleCancel","getStatusIcon","getStatusColor","className","children","fileName","_jsxFileName","lineNumber","columnNumber","title","questions","durationMins","ref","autoPlay","muted","playsInline","onLoadedMetadata","entries","map","key","style","borderLeftColor","replace","trim","onClick","disabled","_c","$RefreshReg$"],"sources":["C:/Online Exam Proctoring System/frontend/src/components/PreExamSetup.js"],"sourcesContent":["// frontend/src/components/PreExamSetup.js - FIXED VERSION WITH IMPROVED VERIFICATION\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport * as faceapi from \"face-api.js\";\r\nimport { useNavigate, useParams } from \"react-router-dom\";\r\nimport \"./PreExamSetup.css\";\r\n\r\nexport default function PreExamSetup({ user }) {\r\n  const { examId } = useParams();\r\n  const videoRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n  const navigate = useNavigate();\r\n  const verificationAttempts = useRef(0);\r\n\r\n  const [status, setStatus] = useState(\"initializing\");\r\n  const [message, setMessage] = useState(\"Initializing system...\");\r\n  const [checks, setChecks] = useState({\r\n    camera: { status: \"pending\", message: \"Checking camera...\", icon: \"üì∑\" },\r\n    lighting: { status: \"pending\", message: \"Checking lighting...\", icon: \"üí°\" },\r\n    faceDetection: { status: \"pending\", message: \"Detecting face...\", icon: \"üë§\" },\r\n    faceVerification: { status: \"pending\", message: \"Verifying identity...\", icon: \"üîê\" },\r\n    environment: { status: \"pending\", message: \"Checking environment...\", icon: \"üåç\" }\r\n  });\r\n  \r\n  const [modelsLoaded, setModelsLoaded] = useState(false);\r\n  const [registeredDescriptor, setRegisteredDescriptor] = useState(null);\r\n  const [allChecksPassed, setAllChecksPassed] = useState(false);\r\n  const [examDetails, setExamDetails] = useState(null);\r\n  const [isManualCheck, setIsManualCheck] = useState(false);\r\n  const [currentFaceMatch, setCurrentFaceMatch] = useState(null);\r\n  const [verificationScore, setVerificationScore] = useState(0);\r\n\r\n  // IMPROVED THRESHOLD - More lenient for better user experience\r\n  const VERIFICATION_THRESHOLD = 0.65; // Increased from 0.6\r\n  const MIN_ACCEPTABLE_DISTANCE = 0.70; // Warning threshold\r\n\r\n  useEffect(() => {\r\n    initializePreExam();\r\n    return () => stopCamera();\r\n  }, []);\r\n\r\n  const initializePreExam = async () => {\r\n    try {\r\n      setStatus(\"initializing\");\r\n      setMessage(\"Loading system components...\");\r\n\r\n      // Check if face is registered first\r\n      const faceStatus = await checkFaceRegistrationStatus();\r\n      if (!faceStatus) {\r\n        setStatus(\"error\");\r\n        setMessage(\"Face not registered. Please register your face first.\");\r\n        setTimeout(() => {\r\n          navigate(\"/face-registration\");\r\n        }, 3000);\r\n        return;\r\n      }\r\n\r\n      // Load exam details\r\n      await fetchExamDetails();\r\n      \r\n      // Load face-api models\r\n      await loadModels();\r\n      \r\n      // Load registered face descriptor\r\n      await loadRegisteredFace();\r\n      \r\n      // Start camera\r\n      await startCamera();\r\n      \r\n      // Run all checks\r\n      await runAllChecks();\r\n    } catch (error) {\r\n      console.error(\"Initialization error:\", error);\r\n      setStatus(\"error\");\r\n      setMessage(error.message || \"System initialization failed\");\r\n    }\r\n  };\r\n\r\n  const checkFaceRegistrationStatus = async () => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      const response = await fetch(\"http://localhost:4000/api/auth/face-status\", {\r\n        headers: { Authorization: `Bearer ${token}` }\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        return data.isFaceRegistered;\r\n      }\r\n      return false;\r\n    } catch (error) {\r\n      console.error(\"Error checking face registration:\", error);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const fetchExamDetails = async () => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      const response = await fetch(\r\n        `http://localhost:4000/api/exam/paper/${examId}`,\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setExamDetails(data);\r\n      } else {\r\n        throw new Error(\"Failed to load exam details\");\r\n      }\r\n    } catch (error) {\r\n      throw new Error(\"Cannot load exam. Please try again.\");\r\n    }\r\n  };\r\n\r\n  const loadModels = async () => {\r\n    try {\r\n      updateCheck(\"camera\", \"pending\", \"Loading face detection models...\");\r\n      const MODEL_URL = process.env.PUBLIC_URL + \"/models\";\r\n      \r\n      await Promise.all([\r\n        faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),\r\n        faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\r\n        faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL),\r\n      ]);\r\n      \r\n      setModelsLoaded(true);\r\n      console.log(\"‚úÖ Face detection models loaded successfully\");\r\n    } catch (error) {\r\n      console.error(\"Model loading error:\", error);\r\n      throw new Error(\"Failed to load face detection models. Please refresh the page.\");\r\n    }\r\n  };\r\n\r\n  const loadRegisteredFace = async () => {\r\n    try {\r\n      updateCheck(\"faceVerification\", \"pending\", \"Loading your registered face data...\");\r\n      const token = localStorage.getItem(\"token\");\r\n      const response = await fetch(\r\n        \"http://localhost:4000/api/auth/face-descriptor\",\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        if (data.faceDescriptor && Array.isArray(data.faceDescriptor) && data.faceDescriptor.length === 128) {\r\n          setRegisteredDescriptor(new Float32Array(data.faceDescriptor));\r\n          console.log(\"‚úÖ Registered face data loaded\");\r\n        } else {\r\n          throw new Error(\"Invalid face descriptor format\");\r\n        }\r\n      } else {\r\n        throw new Error(\"Face not registered\");\r\n      }\r\n    } catch (error) {\r\n      updateCheck(\"faceVerification\", \"failed\", \"‚ùå Face not registered. Please register first.\");\r\n      throw new Error(\"Please register your face before taking exams\");\r\n    }\r\n  };\r\n\r\n  const startCamera = async () => {\r\n    try {\r\n      updateCheck(\"camera\", \"pending\", \"Starting camera...\");\r\n      \r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        video: { \r\n          width: { ideal: 1280 },\r\n          height: { ideal: 720 },\r\n          facingMode: \"user\"\r\n        },\r\n      });\r\n      \r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n        \r\n        // Wait for video to be ready\r\n        await new Promise((resolve) => {\r\n          videoRef.current.onloadedmetadata = () => {\r\n            videoRef.current.play();\r\n            resolve();\r\n          };\r\n        });\r\n        \r\n        updateCheck(\"camera\", \"passed\", \"‚úÖ Camera is working properly\");\r\n        console.log(\"‚úÖ Camera started successfully\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Camera error:\", error);\r\n      updateCheck(\"camera\", \"failed\", \"‚ùå Cannot access camera. Please grant permission.\");\r\n      throw new Error(\"Camera access denied. Please enable camera in browser settings.\");\r\n    }\r\n  };\r\n\r\n  const stopCamera = () => {\r\n    if (videoRef.current && videoRef.current.srcObject) {\r\n      videoRef.current.srcObject.getTracks().forEach(track => track.stop());\r\n      console.log(\"üõë Camera stopped\");\r\n    }\r\n  };\r\n\r\n  const updateCheck = (checkName, status, message) => {\r\n    setChecks(prev => ({\r\n      ...prev,\r\n      [checkName]: { ...prev[checkName], status, message }\r\n    }));\r\n  };\r\n\r\n  const runAllChecks = async () => {\r\n    setStatus(\"checking\");\r\n    setMessage(\"Running comprehensive pre-exam verification...\");\r\n\r\n    try {\r\n      // Wait a moment for camera to stabilize\r\n      await new Promise(resolve => setTimeout(resolve, 2000));\r\n\r\n      // Check lighting\r\n      await checkLighting();\r\n      await new Promise(resolve => setTimeout(resolve, 500));\r\n      \r\n      // Check face detection and verification (most important)\r\n      const faceCheckPassed = await checkFaceDetectionAndVerification();\r\n      \r\n      if (!faceCheckPassed) {\r\n        setStatus(\"incomplete\");\r\n        setMessage(\"‚ö†Ô∏è Please adjust position and lighting for better verification\");\r\n        setAllChecksPassed(false);\r\n        return;\r\n      }\r\n\r\n      await new Promise(resolve => setTimeout(resolve, 500));\r\n      \r\n      // Check environment\r\n      await checkEnvironment();\r\n      \r\n      // Final verification\r\n      const allPassed = Object.values(checks).every(\r\n        check => check.status === \"passed\" || check.status === \"warning\"\r\n      );\r\n      \r\n      setAllChecksPassed(allPassed && faceCheckPassed);\r\n      \r\n      if (allPassed && faceCheckPassed) {\r\n        setStatus(\"ready\");\r\n        setMessage(\"‚úÖ All checks passed! Identity verified. You're ready to start the exam.\");\r\n      } else {\r\n        setStatus(\"incomplete\");\r\n        setMessage(\"‚ö†Ô∏è Please resolve all issues before proceeding.\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Check error:\", error);\r\n      setStatus(\"error\");\r\n      setMessage(\"Error during verification: \" + error.message);\r\n    }\r\n  };\r\n\r\n  const checkLighting = async () => {\r\n    try {\r\n      updateCheck(\"lighting\", \"pending\", \"Analyzing lighting conditions...\");\r\n      \r\n      if (!videoRef.current) {\r\n        updateCheck(\"lighting\", \"failed\", \"‚ùå Video not ready\");\r\n        return;\r\n      }\r\n\r\n      const canvas = document.createElement(\"canvas\");\r\n      canvas.width = videoRef.current.videoWidth;\r\n      canvas.height = videoRef.current.videoHeight;\r\n      const ctx = canvas.getContext(\"2d\");\r\n      ctx.drawImage(videoRef.current, 0, 0);\r\n\r\n      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n      const data = imageData.data;\r\n      \r\n      let totalBrightness = 0;\r\n      for (let i = 0; i < data.length; i += 4) {\r\n        const brightness = (data[i] + data[i + 1] + data[i + 2]) / 3;\r\n        totalBrightness += brightness;\r\n      }\r\n      \r\n      const avgBrightness = totalBrightness / (data.length / 4);\r\n      \r\n      if (avgBrightness < 50) {\r\n        updateCheck(\"lighting\", \"warning\", \"‚ö†Ô∏è Low lighting detected. Please improve lighting for better results.\");\r\n      } else if (avgBrightness > 200) {\r\n        updateCheck(\"lighting\", \"warning\", \"‚ö†Ô∏è Very bright. Consider adjusting lighting.\");\r\n      } else {\r\n        updateCheck(\"lighting\", \"passed\", `‚úÖ Lighting is good (${Math.round(avgBrightness)}/255)`);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Lighting check error:\", error);\r\n      updateCheck(\"lighting\", \"warning\", \"‚ö†Ô∏è Unable to check lighting\");\r\n    }\r\n  };\r\n\r\n  const checkFaceDetectionAndVerification = async () => {\r\n    try {\r\n      updateCheck(\"faceDetection\", \"pending\", \"Detecting your face...\");\r\n      updateCheck(\"faceVerification\", \"pending\", \"Verifying your identity...\");\r\n      \r\n      if (!videoRef.current || !modelsLoaded || !registeredDescriptor) {\r\n        updateCheck(\"faceDetection\", \"failed\", \"‚ùå System not ready\");\r\n        updateCheck(\"faceVerification\", \"failed\", \"‚ùå Cannot verify identity\");\r\n        return false;\r\n      }\r\n\r\n      // Multiple attempts with averaging for better accuracy\r\n      let bestMatch = null;\r\n      let bestDistance = Infinity;\r\n      const attempts = 5;\r\n      const validDetections = [];\r\n\r\n      for (let i = 0; i < attempts; i++) {\r\n        const detection = await faceapi\r\n          .detectSingleFace(videoRef.current, new faceapi.TinyFaceDetectorOptions({ \r\n            inputSize: 224,\r\n            scoreThreshold: 0.5\r\n          }))\r\n          .withFaceLandmarks()\r\n          .withFaceDescriptor();\r\n\r\n        if (detection) {\r\n          // CRITICAL: Compare with registered descriptor\r\n          const distance = faceapi.euclideanDistance(\r\n            registeredDescriptor,\r\n            detection.descriptor\r\n          );\r\n          \r\n          validDetections.push({ detection, distance });\r\n          \r\n          if (distance < bestDistance) {\r\n            bestDistance = distance;\r\n            bestMatch = detection;\r\n          }\r\n\r\n          console.log(`üîç Detection ${i + 1}/${attempts}: Distance = ${distance.toFixed(3)}`);\r\n        }\r\n\r\n        await new Promise(resolve => setTimeout(resolve, 300));\r\n      }\r\n\r\n      // Check if any face was detected\r\n      if (validDetections.length === 0) {\r\n        updateCheck(\"faceDetection\", \"failed\", \"‚ùå No face detected. Please position yourself clearly in front of the camera.\");\r\n        updateCheck(\"faceVerification\", \"failed\", \"‚ùå Cannot verify without face detection.\");\r\n        setCurrentFaceMatch(false);\r\n        return false;\r\n      }\r\n\r\n      // Face detected successfully\r\n      updateCheck(\"faceDetection\", \"passed\", `‚úÖ Face detected successfully (${validDetections.length}/${attempts} captures)`);\r\n\r\n      // Calculate average distance for more stable verification\r\n      const avgDistance = validDetections.reduce((sum, v) => sum + v.distance, 0) / validDetections.length;\r\n      const similarity = Math.max(0, (1 - avgDistance) * 100);\r\n      \r\n      console.log(`üìä Verification Stats:\r\n        - Valid Detections: ${validDetections.length}/${attempts}\r\n        - Best Distance: ${bestDistance.toFixed(3)}\r\n        - Average Distance: ${avgDistance.toFixed(3)}\r\n        - Similarity: ${similarity.toFixed(1)}%\r\n        - Threshold Distance: ${VERIFICATION_THRESHOLD}\r\n        - Min Acceptable Distance: ${MIN_ACCEPTABLE_DISTANCE}\r\n        - Expected User: ${user.name}\r\n      `);\r\n\r\n      // Draw best detection on canvas with appropriate color\r\n      if (canvasRef.current && bestMatch) {\r\n        const dims = faceapi.matchDimensions(canvasRef.current, videoRef.current, true);\r\n        const resizedDetection = faceapi.resizeResults(bestMatch, dims);\r\n        const ctx = canvasRef.current.getContext(\"2d\");\r\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\r\n        \r\n        // Color based on match quality\r\n        if (avgDistance < VERIFICATION_THRESHOLD) {\r\n          ctx.strokeStyle = \"#10b981\"; // Green for verified match\r\n          ctx.lineWidth = 4;\r\n        } else if (avgDistance < MIN_ACCEPTABLE_DISTANCE) {\r\n          ctx.strokeStyle = \"#f59e0b\"; // Orange for marginal match\r\n          ctx.lineWidth = 3;\r\n        } else {\r\n          ctx.strokeStyle = \"#ef4444\"; // Red for failed match\r\n          ctx.lineWidth = 3;\r\n        }\r\n        \r\n        faceapi.draw.drawDetections(canvasRef.current, resizedDetection);\r\n        faceapi.draw.drawFaceLandmarks(canvasRef.current, resizedDetection);\r\n      }\r\n\r\n      setVerificationScore(similarity.toFixed(1));\r\n\r\n      // STRICT VERIFICATION: Only pass if distance is within threshold\r\n      if (avgDistance < VERIFICATION_THRESHOLD) {\r\n        // VERIFIED MATCH - This is the registered user\r\n        setCurrentFaceMatch(true);\r\n        updateCheck(\r\n          \"faceVerification\",\r\n          \"passed\",\r\n          `‚úÖ Identity verified! Match: ${similarity.toFixed(1)}% - Confirmed: ${user.name}`\r\n        );\r\n        verificationAttempts.current = 0;\r\n        return true;\r\n      } else if (avgDistance < MIN_ACCEPTABLE_DISTANCE) {\r\n        // MARGINAL MATCH - Accept with warning\r\n        setCurrentFaceMatch(true);\r\n        updateCheck(\r\n          \"faceVerification\",\r\n          \"passed\",\r\n          `‚ö†Ô∏è Identity verified with low confidence: ${similarity.toFixed(1)}% - Please improve lighting for ${user.name}`\r\n        );\r\n        verificationAttempts.current = 0;\r\n        return true;\r\n      } else {\r\n        // FAILED MATCH - This is NOT the registered user\r\n        verificationAttempts.current++;\r\n        setCurrentFaceMatch(false);\r\n        \r\n        const remainingAttempts = 3 - verificationAttempts.current;\r\n        \r\n        if (verificationAttempts.current < 3) {\r\n          updateCheck(\r\n            \"faceVerification\",\r\n            \"failed\",\r\n            `‚ùå Identity verification failed (${similarity.toFixed(1)}%). You don't appear to be ${user.name}. ${remainingAttempts} attempts remaining.`\r\n          );\r\n        } else {\r\n          updateCheck(\r\n            \"faceVerification\",\r\n            \"failed\",\r\n            `‚ùå Maximum attempts reached. Identity does not match ${user.name}. Distance: ${avgDistance.toFixed(3)}`\r\n          );\r\n        }\r\n        \r\n        console.warn(`‚ö†Ô∏è VERIFICATION FAILED: Distance ${avgDistance.toFixed(3)} exceeds threshold ${VERIFICATION_THRESHOLD}`);\r\n        return false;\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Face detection/verification error:\", error);\r\n      updateCheck(\"faceDetection\", \"failed\", \"‚ùå Error during face detection\");\r\n      updateCheck(\"faceVerification\", \"failed\", \"‚ùå Error during identity verification\");\r\n      setCurrentFaceMatch(false);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const checkEnvironment = async () => {\r\n    try {\r\n      updateCheck(\"environment\", \"pending\", \"Checking for multiple people...\");\r\n      \r\n      if (!videoRef.current || !modelsLoaded) {\r\n        updateCheck(\"environment\", \"warning\", \"‚ö†Ô∏è Unable to verify environment\");\r\n        return;\r\n      }\r\n\r\n      const detections = await faceapi.detectAllFaces(\r\n        videoRef.current,\r\n        new faceapi.TinyFaceDetectorOptions({ scoreThreshold: 0.5 })\r\n      );\r\n\r\n      if (detections.length === 0) {\r\n        updateCheck(\"environment\", \"warning\", \"‚ö†Ô∏è No face detected in frame.\");\r\n      } else if (detections.length === 1) {\r\n        updateCheck(\"environment\", \"passed\", \"‚úÖ Single person detected. Environment is clear.\");\r\n      } else {\r\n        updateCheck(\r\n          \"environment\",\r\n          \"warning\",\r\n          `‚ö†Ô∏è Multiple people detected (${detections.length}). Please ensure you're alone.`\r\n        );\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Environment check error:\", error);\r\n      updateCheck(\"environment\", \"warning\", \"‚ö†Ô∏è Unable to check environment\");\r\n    }\r\n  };\r\n\r\n  const handleManualCheck = async () => {\r\n    setIsManualCheck(true);\r\n    setStatus(\"checking\");\r\n    setMessage(\"Running manual verification...\");\r\n    verificationAttempts.current = 0;\r\n    await runAllChecks();\r\n    setIsManualCheck(false);\r\n  };\r\n\r\n  const handleStartExam = () => {\r\n    if (!allChecksPassed) {\r\n      alert(\"‚ö†Ô∏è Please complete all verification checks before starting the exam.\");\r\n      return;\r\n    }\r\n\r\n    if (!currentFaceMatch) {\r\n      alert(\"‚ùå Identity verification incomplete. Please retry verification.\");\r\n      return;\r\n    }\r\n\r\n    if (window.confirm(\r\n      `‚úÖ Identity Verified: ${user.name}\\n\\n` +\r\n      `Match Score: ${verificationScore}%\\n\\n` +\r\n      `‚ö†Ô∏è Important Reminders:\\n` +\r\n      `‚Ä¢ Timer will start when you begin the exam\\n` +\r\n      `‚Ä¢ Your identity will be verified continuously\\n` +\r\n      `‚Ä¢ Keep your face visible at all times\\n` +\r\n      `‚Ä¢ Multiple face detection will be logged\\n` +\r\n      `‚Ä¢ Tab switching is monitored\\n` +\r\n      `‚Ä¢ Exam will auto-submit on violations\\n\\n` +\r\n      `Are you ready to start?`\r\n    )) {\r\n      // Log successful pre-exam verification\r\n      logPreExamVerification();\r\n      \r\n      // Stop camera and navigate to exam\r\n      stopCamera();\r\n      navigate(`/exam/${examId}`);\r\n    }\r\n  };\r\n\r\n  const logPreExamVerification = async () => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      await fetch(\"http://localhost:4000/api/exam/verify-face\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n          Authorization: `Bearer ${token}`\r\n        },\r\n        body: JSON.stringify({\r\n          examId,\r\n          verificationStatus: \"verified\",\r\n          confidence: verificationScore,\r\n          details: `Pre-exam verification successful for ${user.name}`\r\n        })\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Error logging verification:\", error);\r\n    }\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    if (window.confirm(\"Are you sure you want to cancel? You'll need to restart the verification process.\")) {\r\n      stopCamera();\r\n      navigate(\"/student/dashboard\");\r\n    }\r\n  };\r\n\r\n  const getStatusIcon = (status) => {\r\n    switch (status) {\r\n      case \"passed\": return \"‚úÖ\";\r\n      case \"failed\": return \"‚ùå\";\r\n      case \"warning\": return \"‚ö†Ô∏è\";\r\n      case \"pending\": return \"‚è≥\";\r\n      default: return \"‚è≥\";\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status) => {\r\n    switch (status) {\r\n      case \"passed\": return \"#10b981\";\r\n      case \"failed\": return \"#ef4444\";\r\n      case \"warning\": return \"#f59e0b\";\r\n      case \"pending\": return \"#6b7280\";\r\n      default: return \"#6b7280\";\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"pre-exam-container\">\r\n      <div className=\"pre-exam-card\">\r\n        <div className=\"pre-exam-header\">\r\n          <h2>üîí Identity Verification Required</h2>\r\n          {examDetails && (\r\n            <div className=\"exam-info\">\r\n              <h3>{examDetails.title}</h3>\r\n              <p>\r\n                üìù {examDetails.questions?.length || 0} Questions ‚Ä¢ \r\n                ‚è±Ô∏è {examDetails.durationMins || 30} Minutes ‚Ä¢ \r\n                üë§ Registered Student: <strong>{user.name}</strong>\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"verification-area\">\r\n          <div className=\"camera-section\">\r\n            <div className=\"camera-container\">\r\n              <video\r\n                ref={videoRef}\r\n                autoPlay\r\n                muted\r\n                playsInline\r\n                className=\"camera-video\"\r\n                onLoadedMetadata={() => {\r\n                  if (canvasRef.current && videoRef.current) {\r\n                    canvasRef.current.width = videoRef.current.videoWidth;\r\n                    canvasRef.current.height = videoRef.current.videoHeight;\r\n                  }\r\n                }}\r\n              />\r\n              <canvas ref={canvasRef} className=\"detection-canvas\" />\r\n              \r\n              {verificationScore > 0 && (\r\n                <div className={`match-overlay ${currentFaceMatch ? 'match' : 'no-match'}`}>\r\n                  {currentFaceMatch ? (\r\n                    <div className=\"match-success\">\r\n                      <span className=\"match-icon\">‚úÖ</span>\r\n                      <span className=\"match-text\">Identity Verified</span>\r\n                      <span className=\"match-score\">{verificationScore}%</span>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"match-fail\">\r\n                      <span className=\"match-icon\">‚ö†Ô∏è</span>\r\n                      <span className=\"match-text\">Please Retry</span>\r\n                      <span className=\"match-score\">{verificationScore}%</span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n            \r\n            <div className=\"status-display\">\r\n              <div className={`status-indicator ${status}`}></div>\r\n              <p className=\"status-message\">{message}</p>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"checks-section\">\r\n            <h3>Verification Checklist</h3>\r\n            <div className=\"checks-list\">\r\n              {Object.entries(checks).map(([key, check]) => (\r\n                <div\r\n                  key={key}\r\n                  className={`check-item ${check.status}`}\r\n                  style={{ borderLeftColor: getStatusColor(check.status) }}\r\n                >\r\n                  <span className=\"check-icon\">{check.icon} {getStatusIcon(check.status)}</span>\r\n                  <div className=\"check-content\">\r\n                    <strong>{key.replace(/([A-Z])/g, ' $1').trim()}</strong>\r\n                    <p>{check.message}</p>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"instructions-box\">\r\n          <h4>üí° Verification Tips</h4>\r\n          <ul>\r\n            <li><strong>Good Lighting:</strong> Ensure your face is well-lit and clearly visible</li>\r\n            <li><strong>Face Position:</strong> Look directly at the camera, keep face centered</li>\r\n            <li><strong>Remove Obstacles:</strong> Take off glasses, hats, or masks if possible</li>\r\n            <li><strong>Stable Position:</strong> Keep your head still during verification</li>\r\n            <li><strong>Camera Quality:</strong> Use a good quality webcam for best results</li>\r\n            <li><strong>Retry if Needed:</strong> Use the Re-verify button to try again with better conditions</li>\r\n          </ul>\r\n        </div>\r\n\r\n        <div className=\"action-buttons\">\r\n          <button onClick={handleCancel} className=\"btn-cancel\">\r\n            ‚ùå Cancel\r\n          </button>\r\n          \r\n          <button \r\n            onClick={handleManualCheck} \r\n            className=\"btn-test\"\r\n            disabled={status === \"checking\"}\r\n          >\r\n            {isManualCheck ? \"üîÑ Verifying...\" : \"üîÑ Re-verify Identity\"}\r\n          </button>\r\n          \r\n          <button\r\n            onClick={handleStartExam}\r\n            className=\"btn-start\"\r\n            disabled={!allChecksPassed || !currentFaceMatch || status === \"checking\"}\r\n          >\r\n            {allChecksPassed && currentFaceMatch ? \"‚úÖ Start Exam\" : \"‚ö†Ô∏è Complete Verification\"}\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"verification-info\">\r\n          <p className=\"info-text\">\r\n            üõ°Ô∏è <strong>Security Notice:</strong> All verification attempts are logged. \r\n            If you're having trouble, ensure good lighting and camera position, then use the Re-verify button.\r\n          </p>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}