{"ast":null,"code":"var _jsxFileName = \"C:\\\\Online Exam Proctoring System\\\\frontend\\\\src\\\\components\\\\PreExamSetup.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from \"react\";\nimport * as faceapi from \"face-api.js\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function PreExamSetup({\n  user,\n  examId,\n  examDetails,\n  onProceed,\n  onCancel\n}) {\n  _s();\n  const videoRef = useRef(null);\n  const [status, setStatus] = useState(\"Waiting for face detection...\");\n  const [registeredDescriptor, setRegisteredDescriptor] = useState(null);\n  const [modelsLoaded, setModelsLoaded] = useState(false);\n\n  // Load face descriptor from backend\n  useEffect(() => {\n    const loadRegisteredFace = async () => {\n      try {\n        const token = localStorage.getItem(\"token\");\n        const res = await fetch(\"http://localhost:4000/api/auth/face-descriptor\", {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        if (!res.ok) throw new Error(\"Failed to load descriptor\");\n        const data = await res.json();\n        setRegisteredDescriptor(new Float32Array(data.faceDescriptor));\n      } catch (err) {\n        alert(\"Failed to load your registered face. Please register first.\");\n        onCancel();\n      }\n    };\n    loadRegisteredFace();\n  }, []);\n\n  // Load face-api models\n  useEffect(() => {\n    const loadModels = async () => {\n      const MODEL_URL = process.env.PUBLIC_URL + \"/models\";\n      await Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL), faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL), faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)]);\n      setModelsLoaded(true);\n    };\n    loadModels();\n  }, []);\n\n  // Start camera\n  useEffect(() => {\n    const startCamera = async () => {\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: true\n        });\n        if (videoRef.current) videoRef.current.srcObject = stream;\n      } catch (err) {\n        alert(\"Failed to access camera\");\n        onCancel();\n      }\n    };\n    startCamera();\n  }, []);\n\n  // Face verification\n  useEffect(() => {\n    let interval;\n    const verifyFace = async () => {\n      if (!videoRef.current || !registeredDescriptor || !modelsLoaded) return;\n      setStatus(\"⏳ Checking for single person...\");\n      const detection = await faceapi.detectSingleFace(videoRef.current, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceDescriptor();\n      if (!detection) {\n        setStatus(\"⏳ Waiting for face detection...\");\n        return;\n      }\n      setStatus(\"⏳ Checking lighting conditions...\");\n      await new Promise(res => setTimeout(res, 500));\n      setStatus(\"⏳ Verifying your identity...\");\n      const distance = faceapi.euclideanDistance(registeredDescriptor, detection.descriptor);\n      if (distance < 0.6) {\n        setStatus(\"✅ Face verified! You may proceed.\");\n        clearInterval(interval);\n        setTimeout(onProceed, 1000);\n      } else {\n        setStatus(\"❌ Face does not match! Please try again.\");\n      }\n    };\n    interval = setInterval(verifyFace, 2000);\n    return () => clearInterval(interval);\n  }, [registeredDescriptor, modelsLoaded, onProceed]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      textAlign: \"center\",\n      padding: \"20px\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Pre-Exam Face Verification\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"video\", {\n      ref: videoRef,\n      autoPlay: true,\n      muted: true,\n      width: 320,\n      height: 240,\n      style: {\n        border: \"1px solid #ccc\"\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      style: {\n        marginTop: \"10px\",\n        fontSize: \"18px\"\n      },\n      children: status\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: onCancel,\n      style: {\n        marginTop: \"20px\"\n      },\n      children: \"Cancel\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 95,\n    columnNumber: 5\n  }, this);\n}\n_s(PreExamSetup, \"FGPKPLfKN+j9S5RLJd4sCrN7JKQ=\");\n_c = PreExamSetup;\nvar _c;\n$RefreshReg$(_c, \"PreExamSetup\");","map":{"version":3,"names":["React","useEffect","useRef","useState","faceapi","jsxDEV","_jsxDEV","PreExamSetup","user","examId","examDetails","onProceed","onCancel","_s","videoRef","status","setStatus","registeredDescriptor","setRegisteredDescriptor","modelsLoaded","setModelsLoaded","loadRegisteredFace","token","localStorage","getItem","res","fetch","headers","Authorization","ok","Error","data","json","Float32Array","faceDescriptor","err","alert","loadModels","MODEL_URL","process","env","PUBLIC_URL","Promise","all","nets","tinyFaceDetector","loadFromUri","faceLandmark68Net","faceRecognitionNet","startCamera","stream","navigator","mediaDevices","getUserMedia","video","current","srcObject","interval","verifyFace","detection","detectSingleFace","TinyFaceDetectorOptions","withFaceLandmarks","withFaceDescriptor","setTimeout","distance","euclideanDistance","descriptor","clearInterval","setInterval","style","textAlign","padding","children","fileName","_jsxFileName","lineNumber","columnNumber","ref","autoPlay","muted","width","height","border","marginTop","fontSize","onClick","_c","$RefreshReg$"],"sources":["C:/Online Exam Proctoring System/frontend/src/components/PreExamSetup.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\nimport * as faceapi from \"face-api.js\";\r\n\r\nexport default function PreExamSetup({ user, examId, examDetails, onProceed, onCancel }) {\r\n  const videoRef = useRef(null);\r\n  const [status, setStatus] = useState(\"Waiting for face detection...\");\r\n  const [registeredDescriptor, setRegisteredDescriptor] = useState(null);\r\n  const [modelsLoaded, setModelsLoaded] = useState(false);\r\n\r\n  // Load face descriptor from backend\r\n  useEffect(() => {\r\n    const loadRegisteredFace = async () => {\r\n      try {\r\n        const token = localStorage.getItem(\"token\");\r\n        const res = await fetch(\"http://localhost:4000/api/auth/face-descriptor\", {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n        if (!res.ok) throw new Error(\"Failed to load descriptor\");\r\n        const data = await res.json();\r\n        setRegisteredDescriptor(new Float32Array(data.faceDescriptor));\r\n      } catch (err) {\r\n        alert(\"Failed to load your registered face. Please register first.\");\r\n        onCancel();\r\n      }\r\n    };\r\n    loadRegisteredFace();\r\n  }, []);\r\n\r\n  // Load face-api models\r\n  useEffect(() => {\r\n    const loadModels = async () => {\r\n      const MODEL_URL = process.env.PUBLIC_URL + \"/models\";\r\n      await Promise.all([\r\n        faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),\r\n        faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\r\n        faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL),\r\n      ]);\r\n      setModelsLoaded(true);\r\n    };\r\n    loadModels();\r\n  }, []);\r\n\r\n  // Start camera\r\n  useEffect(() => {\r\n    const startCamera = async () => {\r\n      try {\r\n        const stream = await navigator.mediaDevices.getUserMedia({ video: true });\r\n        if (videoRef.current) videoRef.current.srcObject = stream;\r\n      } catch (err) {\r\n        alert(\"Failed to access camera\");\r\n        onCancel();\r\n      }\r\n    };\r\n    startCamera();\r\n  }, []);\r\n\r\n  // Face verification\r\n  useEffect(() => {\r\n    let interval;\r\n    const verifyFace = async () => {\r\n      if (!videoRef.current || !registeredDescriptor || !modelsLoaded) return;\r\n\r\n      setStatus(\"⏳ Checking for single person...\");\r\n\r\n      const detection = await faceapi\r\n        .detectSingleFace(videoRef.current, new faceapi.TinyFaceDetectorOptions())\r\n        .withFaceLandmarks()\r\n        .withFaceDescriptor();\r\n\r\n      if (!detection) {\r\n        setStatus(\"⏳ Waiting for face detection...\");\r\n        return;\r\n      }\r\n\r\n      setStatus(\"⏳ Checking lighting conditions...\");\r\n      await new Promise((res) => setTimeout(res, 500));\r\n\r\n      setStatus(\"⏳ Verifying your identity...\");\r\n      const distance = faceapi.euclideanDistance(registeredDescriptor, detection.descriptor);\r\n\r\n      if (distance < 0.6) {\r\n        setStatus(\"✅ Face verified! You may proceed.\");\r\n        clearInterval(interval);\r\n        setTimeout(onProceed, 1000);\r\n      } else {\r\n        setStatus(\"❌ Face does not match! Please try again.\");\r\n      }\r\n    };\r\n\r\n    interval = setInterval(verifyFace, 2000);\r\n    return () => clearInterval(interval);\r\n  }, [registeredDescriptor, modelsLoaded, onProceed]);\r\n\r\n  return (\r\n    <div style={{ textAlign: \"center\", padding: \"20px\" }}>\r\n      <h2>Pre-Exam Face Verification</h2>\r\n      <video ref={videoRef} autoPlay muted width={320} height={240} style={{ border: \"1px solid #ccc\" }} />\r\n      <p style={{ marginTop: \"10px\", fontSize: \"18px\" }}>{status}</p>\r\n      <button onClick={onCancel} style={{ marginTop: \"20px\" }}>Cancel</button>\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}