{"ast":null,"code":"var _jsxFileName = \"C:\\\\Online Exam Proctoring System\\\\frontend\\\\src\\\\components\\\\PreExamSetup.js\",\n  _s = $RefreshSig$();\n// frontend/src/components/PreExamSetup.js\nimport React, { useEffect, useRef, useState } from \"react\";\nimport * as faceapi from \"face-api.js\";\nimport { useNavigate, useParams } from \"react-router-dom\";\nimport \"./PreExamSetup.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function PreExamSetup({\n  user\n}) {\n  _s();\n  var _examDetails$question;\n  const {\n    examId\n  } = useParams();\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const navigate = useNavigate();\n  const [status, setStatus] = useState(\"initializing\");\n  const [message, setMessage] = useState(\"Initializing system...\");\n  const [checks, setChecks] = useState({\n    camera: {\n      status: \"pending\",\n      message: \"Checking camera...\"\n    },\n    lighting: {\n      status: \"pending\",\n      message: \"Checking lighting...\"\n    },\n    faceDetection: {\n      status: \"pending\",\n      message: \"Detecting face...\"\n    },\n    faceVerification: {\n      status: \"pending\",\n      message: \"Verifying identity...\"\n    },\n    environment: {\n      status: \"pending\",\n      message: \"Checking environment...\"\n    }\n  });\n  const [modelsLoaded, setModelsLoaded] = useState(false);\n  const [registeredDescriptor, setRegisteredDescriptor] = useState(null);\n  const [allChecksPassed, setAllChecksPassed] = useState(false);\n  const [examDetails, setExamDetails] = useState(null);\n  const [isManualCheck, setIsManualCheck] = useState(false);\n  useEffect(() => {\n    initializePreExam();\n    return () => stopCamera();\n  }, []);\n  const initializePreExam = async () => {\n    try {\n      // Load exam details\n      await fetchExamDetails();\n\n      // Load face-api models\n      await loadModels();\n\n      // Load registered face descriptor\n      await loadRegisteredFace();\n\n      // Start camera\n      await startCamera();\n\n      // Run all checks\n      await runAllChecks();\n    } catch (error) {\n      console.error(\"Initialization error:\", error);\n      updateCheck(\"camera\", \"failed\", error.message);\n      setStatus(\"error\");\n    }\n  };\n  const fetchExamDetails = async () => {\n    try {\n      const token = localStorage.getItem(\"token\");\n      const response = await fetch(`http://localhost:4000/api/exam/paper/${examId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setExamDetails(data);\n      }\n    } catch (error) {\n      console.error(\"Error fetching exam:\", error);\n    }\n  };\n  const loadModels = async () => {\n    try {\n      const MODEL_URL = process.env.PUBLIC_URL + \"/models\";\n      await Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL), faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL), faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)]);\n      setModelsLoaded(true);\n    } catch (error) {\n      throw new Error(\"Failed to load face detection models\");\n    }\n  };\n  const loadRegisteredFace = async () => {\n    try {\n      const token = localStorage.getItem(\"token\");\n      const response = await fetch(\"http://localhost:4000/api/auth/face-descriptor\", {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      if (response.ok) {\n        const data = await response.json();\n        if (data.faceDescriptor && Array.isArray(data.faceDescriptor)) {\n          setRegisteredDescriptor(new Float32Array(data.faceDescriptor));\n        } else {\n          throw new Error(\"Invalid face descriptor\");\n        }\n      } else {\n        throw new Error(\"Face not registered\");\n      }\n    } catch (error) {\n      updateCheck(\"faceVerification\", \"failed\", \"Please register your face first\");\n      throw error;\n    }\n  };\n  const startCamera = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          width: {\n            ideal: 1280\n          },\n          height: {\n            ideal: 720\n          },\n          facingMode: \"user\"\n        }\n      });\n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n        updateCheck(\"camera\", \"passed\", \"Camera is working properly\");\n      }\n    } catch (error) {\n      updateCheck(\"camera\", \"failed\", \"Cannot access camera. Please grant permission.\");\n      throw error;\n    }\n  };\n  const stopCamera = () => {\n    if (videoRef.current && videoRef.current.srcObject) {\n      videoRef.current.srcObject.getTracks().forEach(track => track.stop());\n    }\n  };\n  const updateCheck = (checkName, status, message) => {\n    setChecks(prev => ({\n      ...prev,\n      [checkName]: {\n        status,\n        message\n      }\n    }));\n  };\n  const runAllChecks = async () => {\n    setStatus(\"checking\");\n    setMessage(\"Running pre-exam checks...\");\n\n    // Wait for video to be ready\n    await new Promise(resolve => {\n      if (videoRef.current) {\n        videoRef.current.onloadedmetadata = resolve;\n      }\n    });\n\n    // Check lighting\n    await checkLighting();\n\n    // Check face detection\n    await checkFaceDetection();\n\n    // Check environment\n    await checkEnvironment();\n\n    // Check all statuses\n    const allPassed = Object.values(checks).every(check => check.status === \"passed\");\n    setAllChecksPassed(allPassed);\n    if (allPassed) {\n      setStatus(\"ready\");\n      setMessage(\"All checks passed! You're ready to start the exam.\");\n    } else {\n      setStatus(\"incomplete\");\n      setMessage(\"Some checks failed. Please resolve the issues before proceeding.\");\n    }\n  };\n  const checkLighting = async () => {\n    try {\n      if (!videoRef.current) return;\n      const canvas = document.createElement(\"canvas\");\n      canvas.width = videoRef.current.videoWidth;\n      canvas.height = videoRef.current.videoHeight;\n      const ctx = canvas.getContext(\"2d\");\n      ctx.drawImage(videoRef.current, 0, 0);\n      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n      const data = imageData.data;\n      let totalBrightness = 0;\n      for (let i = 0; i < data.length; i += 4) {\n        const brightness = (data[i] + data[i + 1] + data[i + 2]) / 3;\n        totalBrightness += brightness;\n      }\n      const avgBrightness = totalBrightness / (data.length / 4);\n      if (avgBrightness < 50) {\n        updateCheck(\"lighting\", \"failed\", \"Too dark. Please improve lighting.\");\n      } else if (avgBrightness > 200) {\n        updateCheck(\"lighting\", \"warning\", \"Too bright. Adjust lighting for better results.\");\n      } else {\n        updateCheck(\"lighting\", \"passed\", \"Lighting is adequate.\");\n      }\n    } catch (error) {\n      updateCheck(\"lighting\", \"failed\", \"Failed to check lighting\");\n    }\n  };\n  const checkFaceDetection = async () => {\n    try {\n      if (!videoRef.current || !modelsLoaded) return;\n      const detection = await faceapi.detectSingleFace(videoRef.current, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceDescriptor();\n      if (!detection) {\n        updateCheck(\"faceDetection\", \"failed\", \"No face detected. Please position yourself properly.\");\n        updateCheck(\"faceVerification\", \"failed\", \"Cannot verify without face detection.\");\n        return;\n      }\n\n      // Face detected\n      updateCheck(\"faceDetection\", \"passed\", \"Face detected successfully.\");\n\n      // Verify identity\n      if (registeredDescriptor) {\n        const distance = faceapi.euclideanDistance(registeredDescriptor, detection.descriptor);\n        const similarity = Math.max(0, (1 - distance) * 100);\n        if (distance < 0.6) {\n          updateCheck(\"faceVerification\", \"passed\", `Identity verified (${similarity.toFixed(1)}% match)`);\n        } else {\n          updateCheck(\"faceVerification\", \"failed\", `Identity mismatch (${similarity.toFixed(1)}% match). Expected ${user.name}.`);\n        }\n      }\n\n      // Draw detection on canvas\n      if (canvasRef.current) {\n        const dims = faceapi.matchDimensions(canvasRef.current, videoRef.current, true);\n        const resizedDetection = faceapi.resizeResults(detection, dims);\n        const ctx = canvasRef.current.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n        faceapi.draw.drawDetections(canvasRef.current, resizedDetection);\n        faceapi.draw.drawFaceLandmarks(canvasRef.current, resizedDetection);\n      }\n    } catch (error) {\n      console.error(\"Face detection error:\", error);\n      updateCheck(\"faceDetection\", \"failed\", \"Error during face detection\");\n    }\n  };\n  const checkEnvironment = async () => {\n    try {\n      if (!videoRef.current || !modelsLoaded) return;\n      const detections = await faceapi.detectAllFaces(videoRef.current, new faceapi.TinyFaceDetectorOptions());\n      if (detections.length === 0) {\n        updateCheck(\"environment\", \"failed\", \"No face detected in frame.\");\n      } else if (detections.length === 1) {\n        updateCheck(\"environment\", \"passed\", \"Single person detected. Environment is clear.\");\n      } else {\n        updateCheck(\"environment\", \"failed\", `Multiple people detected (${detections.length}). Ensure you're alone.`);\n      }\n    } catch (error) {\n      updateCheck(\"environment\", \"failed\", \"Failed to check environment\");\n    }\n  };\n  const handleManualCheck = async () => {\n    setIsManualCheck(true);\n    setStatus(\"checking\");\n    setMessage(\"Running manual verification...\");\n    await runAllChecks();\n    setIsManualCheck(false);\n  };\n  const handleStartExam = () => {\n    if (allChecksPassed) {\n      stopCamera();\n      navigate(`/exam/${examId}`);\n    } else {\n      alert(\"Please resolve all issues before starting the exam.\");\n    }\n  };\n  const handleCancel = () => {\n    stopCamera();\n    navigate(\"/student/dashboard\");\n  };\n  const getStatusIcon = status => {\n    switch (status) {\n      case \"passed\":\n        return \"‚úÖ\";\n      case \"failed\":\n        return \"‚ùå\";\n      case \"warning\":\n        return \"‚ö†Ô∏è\";\n      case \"pending\":\n        return \"‚è≥\";\n      default:\n        return \"‚è≥\";\n    }\n  };\n  const getStatusColor = status => {\n    switch (status) {\n      case \"passed\":\n        return \"#10b981\";\n      case \"failed\":\n        return \"#ef4444\";\n      case \"warning\":\n        return \"#f59e0b\";\n      case \"pending\":\n        return \"#6b7280\";\n      default:\n        return \"#6b7280\";\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"pre-exam-container\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"pre-exam-card\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"pre-exam-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"\\uD83D\\uDD12 Pre-Exam Verification\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 342,\n          columnNumber: 11\n        }, this), examDetails && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"exam-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: examDetails.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 345,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [((_examDetails$question = examDetails.questions) === null || _examDetails$question === void 0 ? void 0 : _examDetails$question.length) || 0, \" Questions \\u2022 \", examDetails.durationMins || 30, \" Minutes\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 346,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 344,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 341,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"verification-area\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"camera-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"camera-container\",\n            children: [/*#__PURE__*/_jsxDEV(\"video\", {\n              ref: videoRef,\n              autoPlay: true,\n              muted: true,\n              className: \"camera-video\",\n              onLoadedMetadata: () => {\n                if (canvasRef.current && videoRef.current) {\n                  canvasRef.current.width = videoRef.current.videoWidth;\n                  canvasRef.current.height = videoRef.current.videoHeight;\n                }\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 356,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n              ref: canvasRef,\n              className: \"detection-canvas\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 368,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 355,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"status-display\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: `status-indicator ${status}`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 372,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"status-message\",\n              children: message\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 373,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 371,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 354,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"checks-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"System Checks\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 378,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"checks-list\",\n            children: Object.entries(checks).map(([key, check]) => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `check-item ${check.status}`,\n              style: {\n                borderLeftColor: getStatusColor(check.status)\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"check-icon\",\n                children: getStatusIcon(check.status)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 386,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"check-content\",\n                children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                  children: key.replace(/([A-Z])/g, ' $1').trim()\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 388,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  children: check.message\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 389,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 387,\n                columnNumber: 19\n              }, this)]\n            }, key, true, {\n              fileName: _jsxFileName,\n              lineNumber: 381,\n              columnNumber: 17\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 379,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 377,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 353,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"instructions-box\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          children: \"\\u26A0\\uFE0F Important Instructions\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 398,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          children: [/*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"Ensure you are in a well-lit, quiet environment\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 400,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"Position your face clearly in the camera frame\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 401,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"Make sure you are alone in the room\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 402,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"Remove any accessories that may obstruct your face\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 403,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"Ensure stable internet connection throughout the exam\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 404,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 399,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 397,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"action-buttons\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleCancel,\n          className: \"btn-cancel\",\n          children: \"Cancel\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 409,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleManualCheck,\n          className: \"btn-test\",\n          disabled: status === \"checking\",\n          children: isManualCheck ? \"Checking...\" : \"üîÑ Run Test Again\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 413,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleStartExam,\n          className: \"btn-start\",\n          disabled: !allChecksPassed || status === \"checking\",\n          children: allChecksPassed ? \"Start Exam ‚û°Ô∏è\" : \"Resolve Issues First\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 421,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 408,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 340,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 339,\n    columnNumber: 5\n  }, this);\n}\n_s(PreExamSetup, \"CJZGMChaBPujupzWqFFhTm6LkwU=\", false, function () {\n  return [useParams, useNavigate];\n});\n_c = PreExamSetup;\nvar _c;\n$RefreshReg$(_c, \"PreExamSetup\");","map":{"version":3,"names":["React","useEffect","useRef","useState","faceapi","useNavigate","useParams","jsxDEV","_jsxDEV","PreExamSetup","user","_s","_examDetails$question","examId","videoRef","canvasRef","navigate","status","setStatus","message","setMessage","checks","setChecks","camera","lighting","faceDetection","faceVerification","environment","modelsLoaded","setModelsLoaded","registeredDescriptor","setRegisteredDescriptor","allChecksPassed","setAllChecksPassed","examDetails","setExamDetails","isManualCheck","setIsManualCheck","initializePreExam","stopCamera","fetchExamDetails","loadModels","loadRegisteredFace","startCamera","runAllChecks","error","console","updateCheck","token","localStorage","getItem","response","fetch","headers","Authorization","ok","data","json","MODEL_URL","process","env","PUBLIC_URL","Promise","all","nets","tinyFaceDetector","loadFromUri","faceLandmark68Net","faceRecognitionNet","Error","faceDescriptor","Array","isArray","Float32Array","stream","navigator","mediaDevices","getUserMedia","video","width","ideal","height","facingMode","current","srcObject","getTracks","forEach","track","stop","checkName","prev","resolve","onloadedmetadata","checkLighting","checkFaceDetection","checkEnvironment","allPassed","Object","values","every","check","canvas","document","createElement","videoWidth","videoHeight","ctx","getContext","drawImage","imageData","getImageData","totalBrightness","i","length","brightness","avgBrightness","detection","detectSingleFace","TinyFaceDetectorOptions","withFaceLandmarks","withFaceDescriptor","distance","euclideanDistance","descriptor","similarity","Math","max","toFixed","name","dims","matchDimensions","resizedDetection","resizeResults","clearRect","draw","drawDetections","drawFaceLandmarks","detections","detectAllFaces","handleManualCheck","handleStartExam","alert","handleCancel","getStatusIcon","getStatusColor","className","children","fileName","_jsxFileName","lineNumber","columnNumber","title","questions","durationMins","ref","autoPlay","muted","onLoadedMetadata","entries","map","key","style","borderLeftColor","replace","trim","onClick","disabled","_c","$RefreshReg$"],"sources":["C:/Online Exam Proctoring System/frontend/src/components/PreExamSetup.js"],"sourcesContent":["// frontend/src/components/PreExamSetup.js\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport * as faceapi from \"face-api.js\";\r\nimport { useNavigate, useParams } from \"react-router-dom\";\r\nimport \"./PreExamSetup.css\";\r\n\r\nexport default function PreExamSetup({ user }) {\r\n  const { examId } = useParams();\r\n  const videoRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n  const navigate = useNavigate();\r\n\r\n  const [status, setStatus] = useState(\"initializing\");\r\n  const [message, setMessage] = useState(\"Initializing system...\");\r\n  const [checks, setChecks] = useState({\r\n    camera: { status: \"pending\", message: \"Checking camera...\" },\r\n    lighting: { status: \"pending\", message: \"Checking lighting...\" },\r\n    faceDetection: { status: \"pending\", message: \"Detecting face...\" },\r\n    faceVerification: { status: \"pending\", message: \"Verifying identity...\" },\r\n    environment: { status: \"pending\", message: \"Checking environment...\" }\r\n  });\r\n  \r\n  const [modelsLoaded, setModelsLoaded] = useState(false);\r\n  const [registeredDescriptor, setRegisteredDescriptor] = useState(null);\r\n  const [allChecksPassed, setAllChecksPassed] = useState(false);\r\n  const [examDetails, setExamDetails] = useState(null);\r\n  const [isManualCheck, setIsManualCheck] = useState(false);\r\n\r\n  useEffect(() => {\r\n    initializePreExam();\r\n    return () => stopCamera();\r\n  }, []);\r\n\r\n  const initializePreExam = async () => {\r\n    try {\r\n      // Load exam details\r\n      await fetchExamDetails();\r\n      \r\n      // Load face-api models\r\n      await loadModels();\r\n      \r\n      // Load registered face descriptor\r\n      await loadRegisteredFace();\r\n      \r\n      // Start camera\r\n      await startCamera();\r\n      \r\n      // Run all checks\r\n      await runAllChecks();\r\n    } catch (error) {\r\n      console.error(\"Initialization error:\", error);\r\n      updateCheck(\"camera\", \"failed\", error.message);\r\n      setStatus(\"error\");\r\n    }\r\n  };\r\n\r\n  const fetchExamDetails = async () => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      const response = await fetch(\r\n        `http://localhost:4000/api/exam/paper/${examId}`,\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        setExamDetails(data);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching exam:\", error);\r\n    }\r\n  };\r\n\r\n  const loadModels = async () => {\r\n    try {\r\n      const MODEL_URL = process.env.PUBLIC_URL + \"/models\";\r\n      await Promise.all([\r\n        faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),\r\n        faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\r\n        faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL),\r\n      ]);\r\n      setModelsLoaded(true);\r\n    } catch (error) {\r\n      throw new Error(\"Failed to load face detection models\");\r\n    }\r\n  };\r\n\r\n  const loadRegisteredFace = async () => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      const response = await fetch(\r\n        \"http://localhost:4000/api/auth/face-descriptor\",\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        if (data.faceDescriptor && Array.isArray(data.faceDescriptor)) {\r\n          setRegisteredDescriptor(new Float32Array(data.faceDescriptor));\r\n        } else {\r\n          throw new Error(\"Invalid face descriptor\");\r\n        }\r\n      } else {\r\n        throw new Error(\"Face not registered\");\r\n      }\r\n    } catch (error) {\r\n      updateCheck(\"faceVerification\", \"failed\", \"Please register your face first\");\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const startCamera = async () => {\r\n    try {\r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        video: { \r\n          width: { ideal: 1280 },\r\n          height: { ideal: 720 },\r\n          facingMode: \"user\"\r\n        },\r\n      });\r\n      \r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n        updateCheck(\"camera\", \"passed\", \"Camera is working properly\");\r\n      }\r\n    } catch (error) {\r\n      updateCheck(\"camera\", \"failed\", \"Cannot access camera. Please grant permission.\");\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const stopCamera = () => {\r\n    if (videoRef.current && videoRef.current.srcObject) {\r\n      videoRef.current.srcObject.getTracks().forEach(track => track.stop());\r\n    }\r\n  };\r\n\r\n  const updateCheck = (checkName, status, message) => {\r\n    setChecks(prev => ({\r\n      ...prev,\r\n      [checkName]: { status, message }\r\n    }));\r\n  };\r\n\r\n  const runAllChecks = async () => {\r\n    setStatus(\"checking\");\r\n    setMessage(\"Running pre-exam checks...\");\r\n\r\n    // Wait for video to be ready\r\n    await new Promise(resolve => {\r\n      if (videoRef.current) {\r\n        videoRef.current.onloadedmetadata = resolve;\r\n      }\r\n    });\r\n\r\n    // Check lighting\r\n    await checkLighting();\r\n    \r\n    // Check face detection\r\n    await checkFaceDetection();\r\n    \r\n    // Check environment\r\n    await checkEnvironment();\r\n    \r\n    // Check all statuses\r\n    const allPassed = Object.values(checks).every(\r\n      check => check.status === \"passed\"\r\n    );\r\n    \r\n    setAllChecksPassed(allPassed);\r\n    \r\n    if (allPassed) {\r\n      setStatus(\"ready\");\r\n      setMessage(\"All checks passed! You're ready to start the exam.\");\r\n    } else {\r\n      setStatus(\"incomplete\");\r\n      setMessage(\"Some checks failed. Please resolve the issues before proceeding.\");\r\n    }\r\n  };\r\n\r\n  const checkLighting = async () => {\r\n    try {\r\n      if (!videoRef.current) return;\r\n\r\n      const canvas = document.createElement(\"canvas\");\r\n      canvas.width = videoRef.current.videoWidth;\r\n      canvas.height = videoRef.current.videoHeight;\r\n      const ctx = canvas.getContext(\"2d\");\r\n      ctx.drawImage(videoRef.current, 0, 0);\r\n\r\n      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n      const data = imageData.data;\r\n      \r\n      let totalBrightness = 0;\r\n      for (let i = 0; i < data.length; i += 4) {\r\n        const brightness = (data[i] + data[i + 1] + data[i + 2]) / 3;\r\n        totalBrightness += brightness;\r\n      }\r\n      \r\n      const avgBrightness = totalBrightness / (data.length / 4);\r\n      \r\n      if (avgBrightness < 50) {\r\n        updateCheck(\"lighting\", \"failed\", \"Too dark. Please improve lighting.\");\r\n      } else if (avgBrightness > 200) {\r\n        updateCheck(\"lighting\", \"warning\", \"Too bright. Adjust lighting for better results.\");\r\n      } else {\r\n        updateCheck(\"lighting\", \"passed\", \"Lighting is adequate.\");\r\n      }\r\n    } catch (error) {\r\n      updateCheck(\"lighting\", \"failed\", \"Failed to check lighting\");\r\n    }\r\n  };\r\n\r\n  const checkFaceDetection = async () => {\r\n    try {\r\n      if (!videoRef.current || !modelsLoaded) return;\r\n\r\n      const detection = await faceapi\r\n        .detectSingleFace(videoRef.current, new faceapi.TinyFaceDetectorOptions())\r\n        .withFaceLandmarks()\r\n        .withFaceDescriptor();\r\n\r\n      if (!detection) {\r\n        updateCheck(\"faceDetection\", \"failed\", \"No face detected. Please position yourself properly.\");\r\n        updateCheck(\"faceVerification\", \"failed\", \"Cannot verify without face detection.\");\r\n        return;\r\n      }\r\n\r\n      // Face detected\r\n      updateCheck(\"faceDetection\", \"passed\", \"Face detected successfully.\");\r\n\r\n      // Verify identity\r\n      if (registeredDescriptor) {\r\n        const distance = faceapi.euclideanDistance(\r\n          registeredDescriptor,\r\n          detection.descriptor\r\n        );\r\n        \r\n        const similarity = Math.max(0, (1 - distance) * 100);\r\n        \r\n        if (distance < 0.6) {\r\n          updateCheck(\r\n            \"faceVerification\",\r\n            \"passed\",\r\n            `Identity verified (${similarity.toFixed(1)}% match)`\r\n          );\r\n        } else {\r\n          updateCheck(\r\n            \"faceVerification\",\r\n            \"failed\",\r\n            `Identity mismatch (${similarity.toFixed(1)}% match). Expected ${user.name}.`\r\n          );\r\n        }\r\n      }\r\n\r\n      // Draw detection on canvas\r\n      if (canvasRef.current) {\r\n        const dims = faceapi.matchDimensions(canvasRef.current, videoRef.current, true);\r\n        const resizedDetection = faceapi.resizeResults(detection, dims);\r\n        const ctx = canvasRef.current.getContext(\"2d\");\r\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\r\n        faceapi.draw.drawDetections(canvasRef.current, resizedDetection);\r\n        faceapi.draw.drawFaceLandmarks(canvasRef.current, resizedDetection);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Face detection error:\", error);\r\n      updateCheck(\"faceDetection\", \"failed\", \"Error during face detection\");\r\n    }\r\n  };\r\n\r\n  const checkEnvironment = async () => {\r\n    try {\r\n      if (!videoRef.current || !modelsLoaded) return;\r\n\r\n      const detections = await faceapi.detectAllFaces(\r\n        videoRef.current,\r\n        new faceapi.TinyFaceDetectorOptions()\r\n      );\r\n\r\n      if (detections.length === 0) {\r\n        updateCheck(\"environment\", \"failed\", \"No face detected in frame.\");\r\n      } else if (detections.length === 1) {\r\n        updateCheck(\"environment\", \"passed\", \"Single person detected. Environment is clear.\");\r\n      } else {\r\n        updateCheck(\r\n          \"environment\",\r\n          \"failed\",\r\n          `Multiple people detected (${detections.length}). Ensure you're alone.`\r\n        );\r\n      }\r\n    } catch (error) {\r\n      updateCheck(\"environment\", \"failed\", \"Failed to check environment\");\r\n    }\r\n  };\r\n\r\n  const handleManualCheck = async () => {\r\n    setIsManualCheck(true);\r\n    setStatus(\"checking\");\r\n    setMessage(\"Running manual verification...\");\r\n    await runAllChecks();\r\n    setIsManualCheck(false);\r\n  };\r\n\r\n  const handleStartExam = () => {\r\n    if (allChecksPassed) {\r\n      stopCamera();\r\n      navigate(`/exam/${examId}`);\r\n    } else {\r\n      alert(\"Please resolve all issues before starting the exam.\");\r\n    }\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    stopCamera();\r\n    navigate(\"/student/dashboard\");\r\n  };\r\n\r\n  const getStatusIcon = (status) => {\r\n    switch (status) {\r\n      case \"passed\": return \"‚úÖ\";\r\n      case \"failed\": return \"‚ùå\";\r\n      case \"warning\": return \"‚ö†Ô∏è\";\r\n      case \"pending\": return \"‚è≥\";\r\n      default: return \"‚è≥\";\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status) => {\r\n    switch (status) {\r\n      case \"passed\": return \"#10b981\";\r\n      case \"failed\": return \"#ef4444\";\r\n      case \"warning\": return \"#f59e0b\";\r\n      case \"pending\": return \"#6b7280\";\r\n      default: return \"#6b7280\";\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"pre-exam-container\">\r\n      <div className=\"pre-exam-card\">\r\n        <div className=\"pre-exam-header\">\r\n          <h2>üîí Pre-Exam Verification</h2>\r\n          {examDetails && (\r\n            <div className=\"exam-info\">\r\n              <h3>{examDetails.title}</h3>\r\n              <p>\r\n                {examDetails.questions?.length || 0} Questions ‚Ä¢ {examDetails.durationMins || 30} Minutes\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"verification-area\">\r\n          <div className=\"camera-section\">\r\n            <div className=\"camera-container\">\r\n              <video\r\n                ref={videoRef}\r\n                autoPlay\r\n                muted\r\n                className=\"camera-video\"\r\n                onLoadedMetadata={() => {\r\n                  if (canvasRef.current && videoRef.current) {\r\n                    canvasRef.current.width = videoRef.current.videoWidth;\r\n                    canvasRef.current.height = videoRef.current.videoHeight;\r\n                  }\r\n                }}\r\n              />\r\n              <canvas ref={canvasRef} className=\"detection-canvas\" />\r\n            </div>\r\n            \r\n            <div className=\"status-display\">\r\n              <div className={`status-indicator ${status}`}></div>\r\n              <p className=\"status-message\">{message}</p>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"checks-section\">\r\n            <h3>System Checks</h3>\r\n            <div className=\"checks-list\">\r\n              {Object.entries(checks).map(([key, check]) => (\r\n                <div\r\n                  key={key}\r\n                  className={`check-item ${check.status}`}\r\n                  style={{ borderLeftColor: getStatusColor(check.status) }}\r\n                >\r\n                  <span className=\"check-icon\">{getStatusIcon(check.status)}</span>\r\n                  <div className=\"check-content\">\r\n                    <strong>{key.replace(/([A-Z])/g, ' $1').trim()}</strong>\r\n                    <p>{check.message}</p>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"instructions-box\">\r\n          <h4>‚ö†Ô∏è Important Instructions</h4>\r\n          <ul>\r\n            <li>Ensure you are in a well-lit, quiet environment</li>\r\n            <li>Position your face clearly in the camera frame</li>\r\n            <li>Make sure you are alone in the room</li>\r\n            <li>Remove any accessories that may obstruct your face</li>\r\n            <li>Ensure stable internet connection throughout the exam</li>\r\n          </ul>\r\n        </div>\r\n\r\n        <div className=\"action-buttons\">\r\n          <button onClick={handleCancel} className=\"btn-cancel\">\r\n            Cancel\r\n          </button>\r\n          \r\n          <button \r\n            onClick={handleManualCheck} \r\n            className=\"btn-test\"\r\n            disabled={status === \"checking\"}\r\n          >\r\n            {isManualCheck ? \"Checking...\" : \"üîÑ Run Test Again\"}\r\n          </button>\r\n          \r\n          <button\r\n            onClick={handleStartExam}\r\n            className=\"btn-start\"\r\n            disabled={!allChecksPassed || status === \"checking\"}\r\n          >\r\n            {allChecksPassed ? \"Start Exam ‚û°Ô∏è\" : \"Resolve Issues First\"}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}