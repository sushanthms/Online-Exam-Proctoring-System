{"ast":null,"code":"var _jsxFileName = \"C:\\\\Online Exam Proctoring System\\\\frontend\\\\src\\\\components\\\\PreExamSetup.js\",\n  _s = $RefreshSig$();\n// frontend/src/components/PreExamSetup.js - FIXED VERSION\nimport React, { useEffect, useRef, useState, useCallback } from \"react\";\nimport * as faceapi from \"face-api.js\";\nimport { useNavigate, useParams } from \"react-router-dom\";\nimport \"./PreExamSetup.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function PreExamSetup({\n  user\n}) {\n  _s();\n  var _examDetails$question;\n  const {\n    examId\n  } = useParams();\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const navigate = useNavigate();\n  const verificationAttempts = useRef(0);\n  const isMountedRef = useRef(true);\n  const verificationTimeoutRef = useRef(null);\n  const [status, setStatus] = useState(\"initializing\");\n  const [message, setMessage] = useState(\"Initializing system...\");\n  const [checks, setChecks] = useState({\n    camera: {\n      status: \"pending\",\n      message: \"Checking camera...\",\n      icon: \"ðŸ“·\"\n    },\n    lighting: {\n      status: \"pending\",\n      message: \"Checking lighting...\",\n      icon: \"ðŸ’¡\"\n    },\n    faceDetection: {\n      status: \"pending\",\n      message: \"Detecting face...\",\n      icon: \"ðŸ‘¤\"\n    },\n    faceVerification: {\n      status: \"pending\",\n      message: \"Verifying identity...\",\n      icon: \"ðŸ”\"\n    },\n    environment: {\n      status: \"pending\",\n      message: \"Checking environment...\",\n      icon: \"ðŸŒ\"\n    }\n  });\n  const [modelsLoaded, setModelsLoaded] = useState(false);\n  const [registeredDescriptor, setRegisteredDescriptor] = useState(null);\n  const [allChecksPassed, setAllChecksPassed] = useState(false);\n  const [examDetails, setExamDetails] = useState(null);\n  const [isManualCheck, setIsManualCheck] = useState(false);\n  const [currentFaceMatch, setCurrentFaceMatch] = useState(null);\n  const [verificationScore, setVerificationScore] = useState(0);\n  const [startButtonEnabled, setStartButtonEnabled] = useState(false);\n\n  // STRICT THRESHOLD\n  const VERIFICATION_THRESHOLD = 0.45;\n  const MIN_ACCEPTABLE_DISTANCE = 0.55;\n\n  // Cleanup function\n  const stopCamera = useCallback(() => {\n    if (videoRef.current && videoRef.current.srcObject) {\n      const tracks = videoRef.current.srcObject.getTracks();\n      tracks.forEach(track => track.stop());\n      videoRef.current.srcObject = null;\n      console.log(\"ðŸ›‘ Camera stopped\");\n    }\n  }, []);\n  useEffect(() => {\n    isMountedRef.current = true;\n    initializePreExam();\n    return () => {\n      isMountedRef.current = false;\n      stopCamera();\n      if (verificationTimeoutRef.current) {\n        clearTimeout(verificationTimeoutRef.current);\n      }\n    };\n  }, [stopCamera]);\n  const initializePreExam = async () => {\n    try {\n      if (!isMountedRef.current) return;\n      setStatus(\"initializing\");\n      setMessage(\"Loading system components...\");\n\n      // Check if face is registered\n      const faceStatus = await checkFaceRegistrationStatus();\n      if (!faceStatus) {\n        if (!isMountedRef.current) return;\n        setStatus(\"error\");\n        setMessage(\"Face not registered. Please register your face first.\");\n        setTimeout(() => {\n          if (isMountedRef.current) {\n            navigate(\"/face-registration\");\n          }\n        }, 3000);\n        return;\n      }\n\n      // Load exam details\n      await fetchExamDetails();\n\n      // Load models\n      await loadModels();\n\n      // Load registered face\n      await loadRegisteredFace();\n\n      // Start camera\n      await startCamera();\n\n      // Run checks\n      if (isMountedRef.current) {\n        await runAllChecks();\n      }\n    } catch (error) {\n      console.error(\"Initialization error:\", error);\n      if (isMountedRef.current) {\n        setStatus(\"error\");\n        setMessage(error.message || \"System initialization failed\");\n      }\n    }\n  };\n  const checkFaceRegistrationStatus = async () => {\n    try {\n      const token = localStorage.getItem(\"token\");\n      const response = await fetch(\"http://localhost:4000/api/auth/face-status\", {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      if (response.ok) {\n        const data = await response.json();\n        return data.isFaceRegistered;\n      }\n      return false;\n    } catch (error) {\n      console.error(\"Error checking face registration:\", error);\n      return false;\n    }\n  };\n  const fetchExamDetails = async () => {\n    try {\n      const token = localStorage.getItem(\"token\");\n      const response = await fetch(`http://localhost:4000/api/exam/paper/${examId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      if (response.ok) {\n        const data = await response.json();\n        if (isMountedRef.current) {\n          setExamDetails(data);\n        }\n      } else {\n        throw new Error(\"Failed to load exam details\");\n      }\n    } catch (error) {\n      throw new Error(\"Cannot load exam. Please try again.\");\n    }\n  };\n  const loadModels = async () => {\n    try {\n      if (!isMountedRef.current) return;\n      updateCheck(\"camera\", \"pending\", \"Loading face detection models...\");\n      const MODEL_URL = process.env.PUBLIC_URL + \"/models\";\n      await Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL), faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL), faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)]);\n      if (isMountedRef.current) {\n        setModelsLoaded(true);\n        console.log(\"âœ… Face detection models loaded successfully\");\n      }\n    } catch (error) {\n      console.error(\"Model loading error:\", error);\n      throw new Error(\"Failed to load face detection models. Please refresh the page.\");\n    }\n  };\n  const loadRegisteredFace = async () => {\n    try {\n      if (!isMountedRef.current) return;\n      updateCheck(\"faceVerification\", \"pending\", \"Loading your registered face data...\");\n      const token = localStorage.getItem(\"token\");\n      const response = await fetch(\"http://localhost:4000/api/auth/face-descriptor\", {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      if (response.ok) {\n        const data = await response.json();\n        if (data.faceDescriptor && Array.isArray(data.faceDescriptor) && data.faceDescriptor.length === 128) {\n          if (isMountedRef.current) {\n            setRegisteredDescriptor(new Float32Array(data.faceDescriptor));\n            console.log(\"âœ… Registered face data loaded\");\n          }\n        } else {\n          throw new Error(\"Invalid face descriptor format\");\n        }\n      } else {\n        throw new Error(\"Face not registered\");\n      }\n    } catch (error) {\n      if (isMountedRef.current) {\n        updateCheck(\"faceVerification\", \"failed\", \"âŒ Face not registered. Please register first.\");\n      }\n      throw new Error(\"Please register your face before taking exams\");\n    }\n  };\n  const startCamera = async () => {\n    try {\n      if (!isMountedRef.current) return;\n      updateCheck(\"camera\", \"pending\", \"Starting camera...\");\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: {\n          width: {\n            ideal: 1280\n          },\n          height: {\n            ideal: 720\n          },\n          facingMode: \"user\"\n        }\n      });\n      if (videoRef.current && isMountedRef.current) {\n        videoRef.current.srcObject = stream;\n        await new Promise((resolve, reject) => {\n          if (!videoRef.current) {\n            reject(new Error(\"Video element not available\"));\n            return;\n          }\n          videoRef.current.onloadedmetadata = () => {\n            if (videoRef.current && isMountedRef.current) {\n              videoRef.current.play();\n              resolve();\n            }\n          };\n          videoRef.current.onerror = () => {\n            reject(new Error(\"Video loading failed\"));\n          };\n        });\n        if (isMountedRef.current) {\n          updateCheck(\"camera\", \"passed\", \"âœ… Camera is working properly\");\n          console.log(\"âœ… Camera started successfully\");\n        }\n      }\n    } catch (error) {\n      console.error(\"Camera error:\", error);\n      if (isMountedRef.current) {\n        updateCheck(\"camera\", \"failed\", \"âŒ Cannot access camera. Please grant permission.\");\n      }\n      throw new Error(\"Camera access denied. Please enable camera in browser settings.\");\n    }\n  };\n  const updateCheck = (checkName, status, message) => {\n    if (!isMountedRef.current) return;\n    setChecks(prev => ({\n      ...prev,\n      [checkName]: {\n        ...prev[checkName],\n        status,\n        message\n      }\n    }));\n  };\n  const runAllChecks = async () => {\n    if (!isMountedRef.current) return;\n    setStatus(\"checking\");\n    setMessage(\"Running comprehensive pre-exam verification...\");\n    try {\n      await new Promise(resolve => setTimeout(resolve, 2000));\n      if (!isMountedRef.current) return;\n      await checkLighting();\n      await new Promise(resolve => setTimeout(resolve, 500));\n      if (!isMountedRef.current) return;\n      const faceCheckPassed = await checkFaceDetectionAndVerification();\n      if (!faceCheckPassed) {\n        if (isMountedRef.current) {\n          setStatus(\"incomplete\");\n          setMessage(\"âš ï¸ Please adjust position and lighting for better verification\");\n          setAllChecksPassed(false);\n        }\n        return;\n      }\n      await new Promise(resolve => setTimeout(resolve, 500));\n      if (!isMountedRef.current) return;\n      await checkEnvironment();\n      if (!isMountedRef.current) return;\n      const allPassed = Object.values(checks).every(check => check.status === \"passed\" || check.status === \"warning\");\n      setAllChecksPassed(allPassed && faceCheckPassed);\n      if (allPassed && faceCheckPassed) {\n        setStatus(\"ready\");\n        setMessage(\"âœ… All checks passed! Identity verified. You're ready to start the exam.\");\n      } else {\n        setStatus(\"incomplete\");\n        setMessage(\"âš ï¸ Please resolve all issues before proceeding.\");\n      }\n    } catch (error) {\n      console.error(\"Check error:\", error);\n      if (isMountedRef.current) {\n        setStatus(\"error\");\n        setMessage(\"Error during verification: \" + error.message);\n      }\n    }\n  };\n  const checkLighting = async () => {\n    try {\n      if (!isMountedRef.current || !videoRef.current) return;\n      updateCheck(\"lighting\", \"pending\", \"Analyzing lighting conditions...\");\n      const canvas = document.createElement(\"canvas\");\n      canvas.width = videoRef.current.videoWidth;\n      canvas.height = videoRef.current.videoHeight;\n      const ctx = canvas.getContext(\"2d\");\n      ctx.drawImage(videoRef.current, 0, 0);\n      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\n      const data = imageData.data;\n      let totalBrightness = 0;\n      for (let i = 0; i < data.length; i += 4) {\n        const brightness = (data[i] + data[i + 1] + data[i + 2]) / 3;\n        totalBrightness += brightness;\n      }\n      const avgBrightness = totalBrightness / (data.length / 4);\n      if (!isMountedRef.current) return;\n      if (avgBrightness < 50) {\n        updateCheck(\"lighting\", \"warning\", \"âš ï¸ Low lighting detected. Please improve lighting.\");\n      } else if (avgBrightness > 200) {\n        updateCheck(\"lighting\", \"warning\", \"âš ï¸ Very bright. Consider adjusting lighting.\");\n      } else {\n        updateCheck(\"lighting\", \"passed\", `âœ… Lighting is good (${Math.round(avgBrightness)}/255)`);\n      }\n    } catch (error) {\n      console.error(\"Lighting check error:\", error);\n      if (isMountedRef.current) {\n        updateCheck(\"lighting\", \"warning\", \"âš ï¸ Unable to check lighting\");\n      }\n    }\n  };\n  const checkFaceDetectionAndVerification = async () => {\n    try {\n      if (!isMountedRef.current || !videoRef.current || !modelsLoaded || !registeredDescriptor) {\n        return false;\n      }\n      updateCheck(\"faceDetection\", \"pending\", \"Detecting your face...\");\n      updateCheck(\"faceVerification\", \"pending\", \"Verifying your identity...\");\n      let bestMatch = null;\n      let bestDistance = Infinity;\n      const attempts = 5;\n      const validDetections = [];\n      for (let i = 0; i < attempts; i++) {\n        if (!isMountedRef.current || !videoRef.current) break;\n        const detection = await faceapi.detectSingleFace(videoRef.current, new faceapi.TinyFaceDetectorOptions({\n          inputSize: 224,\n          scoreThreshold: 0.5\n        })).withFaceLandmarks().withFaceDescriptor();\n        if (detection) {\n          const distance = faceapi.euclideanDistance(registeredDescriptor, detection.descriptor);\n          validDetections.push({\n            detection,\n            distance\n          });\n          if (distance < bestDistance) {\n            bestDistance = distance;\n            bestMatch = detection;\n          }\n          console.log(`ðŸ” Detection ${i + 1}/${attempts}: Distance = ${distance.toFixed(3)}`);\n        }\n        await new Promise(resolve => setTimeout(resolve, 300));\n      }\n      if (!isMountedRef.current) return false;\n      if (validDetections.length === 0) {\n        updateCheck(\"faceDetection\", \"failed\", \"âŒ No face detected. Please position yourself clearly.\");\n        updateCheck(\"faceVerification\", \"failed\", \"âŒ Cannot verify without face detection.\");\n        setCurrentFaceMatch(false);\n        return false;\n      }\n      updateCheck(\"faceDetection\", \"passed\", `âœ… Face detected successfully (${validDetections.length}/${attempts} captures)`);\n      const avgDistance = validDetections.reduce((sum, v) => sum + v.distance, 0) / validDetections.length;\n      const similarity = Math.max(0, (1 - avgDistance) * 100);\n      console.log(`ðŸ“Š Verification - Distance: ${avgDistance.toFixed(3)}, Similarity: ${similarity.toFixed(1)}%`);\n\n      // Draw detection\n      if (canvasRef.current && bestMatch && isMountedRef.current) {\n        const dims = faceapi.matchDimensions(canvasRef.current, videoRef.current, true);\n        const resizedDetection = faceapi.resizeResults(bestMatch, dims);\n        const ctx = canvasRef.current.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n        if (avgDistance < VERIFICATION_THRESHOLD) {\n          ctx.strokeStyle = \"#10b981\";\n          ctx.lineWidth = 4;\n        } else if (avgDistance < MIN_ACCEPTABLE_DISTANCE) {\n          ctx.strokeStyle = \"#f59e0b\";\n          ctx.lineWidth = 3;\n        } else {\n          ctx.strokeStyle = \"#ef4444\";\n          ctx.lineWidth = 3;\n        }\n        faceapi.draw.drawDetections(canvasRef.current, resizedDetection);\n        faceapi.draw.drawFaceLandmarks(canvasRef.current, resizedDetection);\n      }\n      if (!isMountedRef.current) return false;\n      setVerificationScore(similarity.toFixed(1));\n      if (avgDistance < VERIFICATION_THRESHOLD) {\n        setCurrentFaceMatch(true);\n        setStartButtonEnabled(true);\n        updateCheck(\"faceVerification\", \"passed\", `âœ… Identity verified! Match: ${similarity.toFixed(1)}%`);\n        verificationAttempts.current = 0;\n        return true;\n      } else if (avgDistance < MIN_ACCEPTABLE_DISTANCE) {\n        setCurrentFaceMatch(true);\n        updateCheck(\"faceVerification\", \"warning\", `âš ï¸ Identity verified with low confidence: ${similarity.toFixed(1)}%`);\n        verificationAttempts.current = 0;\n        return true;\n      } else {\n        verificationAttempts.current++;\n        setCurrentFaceMatch(false);\n        const remainingAttempts = 3 - verificationAttempts.current;\n        if (verificationAttempts.current < 3) {\n          updateCheck(\"faceVerification\", \"failed\", `âŒ Identity verification failed (${similarity.toFixed(1)}%). ${remainingAttempts} attempts remaining.`);\n        } else {\n          updateCheck(\"faceVerification\", \"failed\", `âŒ Maximum attempts reached. Identity does not match.`);\n        }\n        return false;\n      }\n    } catch (error) {\n      console.error(\"Face verification error:\", error);\n      if (isMountedRef.current) {\n        updateCheck(\"faceDetection\", \"failed\", \"âŒ Error during face detection\");\n        updateCheck(\"faceVerification\", \"failed\", \"âŒ Error during verification\");\n        setCurrentFaceMatch(false);\n      }\n      return false;\n    }\n  };\n  const checkEnvironment = async () => {\n    try {\n      if (!isMountedRef.current || !videoRef.current || !modelsLoaded) return;\n      updateCheck(\"environment\", \"pending\", \"Checking for multiple people...\");\n      const detections = await faceapi.detectAllFaces(videoRef.current, new faceapi.TinyFaceDetectorOptions({\n        scoreThreshold: 0.5\n      }));\n      if (!isMountedRef.current) return;\n      if (detections.length === 0) {\n        updateCheck(\"environment\", \"warning\", \"âš ï¸ No face detected in frame.\");\n      } else if (detections.length === 1) {\n        updateCheck(\"environment\", \"passed\", \"âœ… Single person detected. Environment is clear.\");\n      } else {\n        updateCheck(\"environment\", \"warning\", `âš ï¸ Multiple people detected (${detections.length}). Please ensure you're alone.`);\n      }\n    } catch (error) {\n      console.error(\"Environment check error:\", error);\n      if (isMountedRef.current) {\n        updateCheck(\"environment\", \"warning\", \"âš ï¸ Unable to check environment\");\n      }\n    }\n  };\n  const handleManualCheck = async () => {\n    if (!isMountedRef.current) return;\n    setIsManualCheck(true);\n    setStatus(\"checking\");\n    setMessage(\"Running manual verification...\");\n    verificationAttempts.current = 0;\n    await runAllChecks();\n    if (isMountedRef.current) {\n      setIsManualCheck(false);\n    }\n  };\n  const handleStartExam = () => {\n    if (!startButtonEnabled) {\n      alert(\"Please complete face verification before starting the exam.\");\n      return;\n    }\n    if (window.confirm(`âœ… Identity Verified: ${user.name}\\n\\n` + `Match Score: ${verificationScore}%\\n\\n` + `âš ï¸ Important Reminders:\\n` + `â€¢ Timer will start when you begin the exam\\n` + `â€¢ Your identity will be verified continuously\\n` + `â€¢ Keep your face visible at all times\\n\\n` + `Are you ready to start?`)) {\n      stopCamera();\n      navigate(`/exam/${examId}`);\n    }\n  };\n  const handleCancel = () => {\n    if (window.confirm(\"Are you sure you want to cancel?\")) {\n      stopCamera();\n      navigate(\"/student/dashboard\");\n    }\n  };\n  const getStatusIcon = status => {\n    switch (status) {\n      case \"passed\":\n        return \"âœ…\";\n      case \"failed\":\n        return \"âŒ\";\n      case \"warning\":\n        return \"âš ï¸\";\n      default:\n        return \"â³\";\n    }\n  };\n  const getStatusColor = status => {\n    switch (status) {\n      case \"passed\":\n        return \"#10b981\";\n      case \"failed\":\n        return \"#ef4444\";\n      case \"warning\":\n        return \"#f59e0b\";\n      default:\n        return \"#6b7280\";\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"pre-exam-container\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"pre-exam-card\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"pre-exam-header\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"\\uD83D\\uDD12 Identity Verification Required\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 567,\n          columnNumber: 11\n        }, this), examDetails && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"exam-info\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: examDetails.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 570,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n            children: [\"\\uD83D\\uDCDD \", ((_examDetails$question = examDetails.questions) === null || _examDetails$question === void 0 ? void 0 : _examDetails$question.length) || 0, \" Questions \\u2022 \\u23F1\\uFE0F \", examDetails.durationMins || 30, \" Minutes \\u2022 \\uD83D\\uDC64 Registered Student: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n              children: user.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 574,\n              columnNumber: 40\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 571,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 569,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 566,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"verification-area\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"camera-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"camera-container\",\n            children: [/*#__PURE__*/_jsxDEV(\"video\", {\n              ref: videoRef,\n              autoPlay: true,\n              muted: true,\n              playsInline: true,\n              className: \"camera-video\",\n              onLoadedMetadata: () => {\n                if (canvasRef.current && videoRef.current) {\n                  canvasRef.current.width = videoRef.current.videoWidth;\n                  canvasRef.current.height = videoRef.current.videoHeight;\n                }\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 583,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n              ref: canvasRef,\n              className: \"detection-canvas\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 596,\n              columnNumber: 15\n            }, this), verificationScore > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `match-overlay ${currentFaceMatch ? 'match' : 'no-match'}`,\n              children: currentFaceMatch ? /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"match-success\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"match-icon\",\n                  children: \"\\u2705\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 602,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"match-text\",\n                  children: \"Identity Verified\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 603,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"match-score\",\n                  children: [verificationScore, \"%\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 604,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 601,\n                columnNumber: 21\n              }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"match-fail\",\n                children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"match-icon\",\n                  children: \"\\u26A0\\uFE0F\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 608,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"match-text\",\n                  children: \"Please Retry\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 609,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                  className: \"match-score\",\n                  children: [verificationScore, \"%\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 610,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 607,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 599,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 582,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"status-display\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: `status-indicator ${status}`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 618,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"status-message\",\n              children: message\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 619,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 617,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 581,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"checks-section\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Verification Checklist\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 624,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"checks-list\",\n            children: Object.entries(checks).map(([key, check]) => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: `check-item ${check.status}`,\n              style: {\n                borderLeftColor: getStatusColor(check.status)\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"check-icon\",\n                children: [check.icon, \" \", getStatusIcon(check.status)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 632,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"check-content\",\n                children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                  children: key.replace(/([A-Z])/g, ' $1').trim()\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 634,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                  children: check.message\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 635,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 633,\n                columnNumber: 19\n              }, this)]\n            }, key, true, {\n              fileName: _jsxFileName,\n              lineNumber: 627,\n              columnNumber: 17\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 625,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 623,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 580,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"instructions-box\",\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          children: \"\\uD83D\\uDCA1 Verification Tips\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 644,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          children: [/*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Good Lighting:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 646,\n              columnNumber: 17\n            }, this), \" Ensure your face is well-lit\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 646,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Face Position:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 647,\n              columnNumber: 17\n            }, this), \" Look directly at the camera\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 647,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Remove Obstacles:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 648,\n              columnNumber: 17\n            }, this), \" Take off glasses/hats if possible\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 648,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Stable Position:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 649,\n              columnNumber: 17\n            }, this), \" Keep your head still\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 649,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 645,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 643,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"action-buttons\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleCancel,\n          className: \"btn-cancel\",\n          children: \"\\u274C Cancel\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 654,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleManualCheck,\n          className: \"btn-test\",\n          disabled: status === \"checking\",\n          children: isManualCheck ? \"ðŸ”„ Verifying...\" : \"ðŸ”„ Re-verify Identity\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 658,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleStartExam,\n          className: \"btn-start\",\n          disabled: !startButtonEnabled || status === \"checking\",\n          children: \"\\u2705 Start Exam\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 666,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 653,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 565,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 564,\n    columnNumber: 5\n  }, this);\n}\n_s(PreExamSetup, \"KMh1WaTeeZHrOljTeWMx0iGlDeY=\", false, function () {\n  return [useParams, useNavigate];\n});\n_c = PreExamSetup;\nvar _c;\n$RefreshReg$(_c, \"PreExamSetup\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useCallback","faceapi","useNavigate","useParams","jsxDEV","_jsxDEV","PreExamSetup","user","_s","_examDetails$question","examId","videoRef","canvasRef","navigate","verificationAttempts","isMountedRef","verificationTimeoutRef","status","setStatus","message","setMessage","checks","setChecks","camera","icon","lighting","faceDetection","faceVerification","environment","modelsLoaded","setModelsLoaded","registeredDescriptor","setRegisteredDescriptor","allChecksPassed","setAllChecksPassed","examDetails","setExamDetails","isManualCheck","setIsManualCheck","currentFaceMatch","setCurrentFaceMatch","verificationScore","setVerificationScore","startButtonEnabled","setStartButtonEnabled","VERIFICATION_THRESHOLD","MIN_ACCEPTABLE_DISTANCE","stopCamera","current","srcObject","tracks","getTracks","forEach","track","stop","console","log","initializePreExam","clearTimeout","faceStatus","checkFaceRegistrationStatus","setTimeout","fetchExamDetails","loadModels","loadRegisteredFace","startCamera","runAllChecks","error","token","localStorage","getItem","response","fetch","headers","Authorization","ok","data","json","isFaceRegistered","Error","updateCheck","MODEL_URL","process","env","PUBLIC_URL","Promise","all","nets","tinyFaceDetector","loadFromUri","faceLandmark68Net","faceRecognitionNet","faceDescriptor","Array","isArray","length","Float32Array","stream","navigator","mediaDevices","getUserMedia","video","width","ideal","height","facingMode","resolve","reject","onloadedmetadata","play","onerror","checkName","prev","checkLighting","faceCheckPassed","checkFaceDetectionAndVerification","checkEnvironment","allPassed","Object","values","every","check","canvas","document","createElement","videoWidth","videoHeight","ctx","getContext","drawImage","imageData","getImageData","totalBrightness","i","brightness","avgBrightness","Math","round","bestMatch","bestDistance","Infinity","attempts","validDetections","detection","detectSingleFace","TinyFaceDetectorOptions","inputSize","scoreThreshold","withFaceLandmarks","withFaceDescriptor","distance","euclideanDistance","descriptor","push","toFixed","avgDistance","reduce","sum","v","similarity","max","dims","matchDimensions","resizedDetection","resizeResults","clearRect","strokeStyle","lineWidth","draw","drawDetections","drawFaceLandmarks","remainingAttempts","detections","detectAllFaces","handleManualCheck","handleStartExam","alert","window","confirm","name","handleCancel","getStatusIcon","getStatusColor","className","children","fileName","_jsxFileName","lineNumber","columnNumber","title","questions","durationMins","ref","autoPlay","muted","playsInline","onLoadedMetadata","entries","map","key","style","borderLeftColor","replace","trim","onClick","disabled","_c","$RefreshReg$"],"sources":["C:/Online Exam Proctoring System/frontend/src/components/PreExamSetup.js"],"sourcesContent":["// frontend/src/components/PreExamSetup.js - FIXED VERSION\r\nimport React, { useEffect, useRef, useState, useCallback } from \"react\";\r\nimport * as faceapi from \"face-api.js\";\r\nimport { useNavigate, useParams } from \"react-router-dom\";\r\nimport \"./PreExamSetup.css\";\r\n\r\nexport default function PreExamSetup({ user }) {\r\n  const { examId } = useParams();\r\n  const videoRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n  const navigate = useNavigate();\r\n  const verificationAttempts = useRef(0);\r\n  const isMountedRef = useRef(true);\r\n  const verificationTimeoutRef = useRef(null);\r\n\r\n  const [status, setStatus] = useState(\"initializing\");\r\n  const [message, setMessage] = useState(\"Initializing system...\");\r\n  const [checks, setChecks] = useState({\r\n    camera: { status: \"pending\", message: \"Checking camera...\", icon: \"ðŸ“·\" },\r\n    lighting: { status: \"pending\", message: \"Checking lighting...\", icon: \"ðŸ’¡\" },\r\n    faceDetection: { status: \"pending\", message: \"Detecting face...\", icon: \"ðŸ‘¤\" },\r\n    faceVerification: { status: \"pending\", message: \"Verifying identity...\", icon: \"ðŸ”\" },\r\n    environment: { status: \"pending\", message: \"Checking environment...\", icon: \"ðŸŒ\" }\r\n  });\r\n  \r\n  const [modelsLoaded, setModelsLoaded] = useState(false);\r\n  const [registeredDescriptor, setRegisteredDescriptor] = useState(null);\r\n  const [allChecksPassed, setAllChecksPassed] = useState(false);\r\n  const [examDetails, setExamDetails] = useState(null);\r\n  const [isManualCheck, setIsManualCheck] = useState(false);\r\n  const [currentFaceMatch, setCurrentFaceMatch] = useState(null);\r\n  const [verificationScore, setVerificationScore] = useState(0);\r\n  const [startButtonEnabled, setStartButtonEnabled] = useState(false);\r\n\r\n  // STRICT THRESHOLD\r\n  const VERIFICATION_THRESHOLD = 0.45;\r\n  const MIN_ACCEPTABLE_DISTANCE = 0.55;\r\n\r\n  // Cleanup function\r\n  const stopCamera = useCallback(() => {\r\n    if (videoRef.current && videoRef.current.srcObject) {\r\n      const tracks = videoRef.current.srcObject.getTracks();\r\n      tracks.forEach(track => track.stop());\r\n      videoRef.current.srcObject = null;\r\n      console.log(\"ðŸ›‘ Camera stopped\");\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    isMountedRef.current = true;\r\n    initializePreExam();\r\n    \r\n    return () => {\r\n      isMountedRef.current = false;\r\n      stopCamera();\r\n      if (verificationTimeoutRef.current) {\r\n        clearTimeout(verificationTimeoutRef.current);\r\n      }\r\n    };\r\n  }, [stopCamera]);\r\n\r\n  const initializePreExam = async () => {\r\n    try {\r\n      if (!isMountedRef.current) return;\r\n      \r\n      setStatus(\"initializing\");\r\n      setMessage(\"Loading system components...\");\r\n\r\n      // Check if face is registered\r\n      const faceStatus = await checkFaceRegistrationStatus();\r\n      if (!faceStatus) {\r\n        if (!isMountedRef.current) return;\r\n        setStatus(\"error\");\r\n        setMessage(\"Face not registered. Please register your face first.\");\r\n        setTimeout(() => {\r\n          if (isMountedRef.current) {\r\n            navigate(\"/face-registration\");\r\n          }\r\n        }, 3000);\r\n        return;\r\n      }\r\n\r\n      // Load exam details\r\n      await fetchExamDetails();\r\n      \r\n      // Load models\r\n      await loadModels();\r\n      \r\n      // Load registered face\r\n      await loadRegisteredFace();\r\n      \r\n      // Start camera\r\n      await startCamera();\r\n      \r\n      // Run checks\r\n      if (isMountedRef.current) {\r\n        await runAllChecks();\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Initialization error:\", error);\r\n      if (isMountedRef.current) {\r\n        setStatus(\"error\");\r\n        setMessage(error.message || \"System initialization failed\");\r\n      }\r\n    }\r\n  };\r\n\r\n  const checkFaceRegistrationStatus = async () => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      const response = await fetch(\"http://localhost:4000/api/auth/face-status\", {\r\n        headers: { Authorization: `Bearer ${token}` }\r\n      });\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        return data.isFaceRegistered;\r\n      }\r\n      return false;\r\n    } catch (error) {\r\n      console.error(\"Error checking face registration:\", error);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const fetchExamDetails = async () => {\r\n    try {\r\n      const token = localStorage.getItem(\"token\");\r\n      const response = await fetch(\r\n        `http://localhost:4000/api/exam/paper/${examId}`,\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n      \r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        if (isMountedRef.current) {\r\n          setExamDetails(data);\r\n        }\r\n      } else {\r\n        throw new Error(\"Failed to load exam details\");\r\n      }\r\n    } catch (error) {\r\n      throw new Error(\"Cannot load exam. Please try again.\");\r\n    }\r\n  };\r\n\r\n  const loadModels = async () => {\r\n    try {\r\n      if (!isMountedRef.current) return;\r\n      \r\n      updateCheck(\"camera\", \"pending\", \"Loading face detection models...\");\r\n      const MODEL_URL = process.env.PUBLIC_URL + \"/models\";\r\n      \r\n      await Promise.all([\r\n        faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),\r\n        faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\r\n        faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL),\r\n      ]);\r\n      \r\n      if (isMountedRef.current) {\r\n        setModelsLoaded(true);\r\n        console.log(\"âœ… Face detection models loaded successfully\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Model loading error:\", error);\r\n      throw new Error(\"Failed to load face detection models. Please refresh the page.\");\r\n    }\r\n  };\r\n\r\n  const loadRegisteredFace = async () => {\r\n    try {\r\n      if (!isMountedRef.current) return;\r\n      \r\n      updateCheck(\"faceVerification\", \"pending\", \"Loading your registered face data...\");\r\n      const token = localStorage.getItem(\"token\");\r\n      const response = await fetch(\r\n        \"http://localhost:4000/api/auth/face-descriptor\",\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n\r\n      if (response.ok) {\r\n        const data = await response.json();\r\n        if (data.faceDescriptor && Array.isArray(data.faceDescriptor) && data.faceDescriptor.length === 128) {\r\n          if (isMountedRef.current) {\r\n            setRegisteredDescriptor(new Float32Array(data.faceDescriptor));\r\n            console.log(\"âœ… Registered face data loaded\");\r\n          }\r\n        } else {\r\n          throw new Error(\"Invalid face descriptor format\");\r\n        }\r\n      } else {\r\n        throw new Error(\"Face not registered\");\r\n      }\r\n    } catch (error) {\r\n      if (isMountedRef.current) {\r\n        updateCheck(\"faceVerification\", \"failed\", \"âŒ Face not registered. Please register first.\");\r\n      }\r\n      throw new Error(\"Please register your face before taking exams\");\r\n    }\r\n  };\r\n\r\n  const startCamera = async () => {\r\n    try {\r\n      if (!isMountedRef.current) return;\r\n      \r\n      updateCheck(\"camera\", \"pending\", \"Starting camera...\");\r\n      \r\n      const stream = await navigator.mediaDevices.getUserMedia({\r\n        video: { \r\n          width: { ideal: 1280 },\r\n          height: { ideal: 720 },\r\n          facingMode: \"user\"\r\n        },\r\n      });\r\n      \r\n      if (videoRef.current && isMountedRef.current) {\r\n        videoRef.current.srcObject = stream;\r\n        \r\n        await new Promise((resolve, reject) => {\r\n          if (!videoRef.current) {\r\n            reject(new Error(\"Video element not available\"));\r\n            return;\r\n          }\r\n          \r\n          videoRef.current.onloadedmetadata = () => {\r\n            if (videoRef.current && isMountedRef.current) {\r\n              videoRef.current.play();\r\n              resolve();\r\n            }\r\n          };\r\n          \r\n          videoRef.current.onerror = () => {\r\n            reject(new Error(\"Video loading failed\"));\r\n          };\r\n        });\r\n        \r\n        if (isMountedRef.current) {\r\n          updateCheck(\"camera\", \"passed\", \"âœ… Camera is working properly\");\r\n          console.log(\"âœ… Camera started successfully\");\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Camera error:\", error);\r\n      if (isMountedRef.current) {\r\n        updateCheck(\"camera\", \"failed\", \"âŒ Cannot access camera. Please grant permission.\");\r\n      }\r\n      throw new Error(\"Camera access denied. Please enable camera in browser settings.\");\r\n    }\r\n  };\r\n\r\n  const updateCheck = (checkName, status, message) => {\r\n    if (!isMountedRef.current) return;\r\n    \r\n    setChecks(prev => ({\r\n      ...prev,\r\n      [checkName]: { ...prev[checkName], status, message }\r\n    }));\r\n  };\r\n\r\n  const runAllChecks = async () => {\r\n    if (!isMountedRef.current) return;\r\n    \r\n    setStatus(\"checking\");\r\n    setMessage(\"Running comprehensive pre-exam verification...\");\r\n\r\n    try {\r\n      await new Promise(resolve => setTimeout(resolve, 2000));\r\n\r\n      if (!isMountedRef.current) return;\r\n      await checkLighting();\r\n      \r\n      await new Promise(resolve => setTimeout(resolve, 500));\r\n      \r\n      if (!isMountedRef.current) return;\r\n      const faceCheckPassed = await checkFaceDetectionAndVerification();\r\n      \r\n      if (!faceCheckPassed) {\r\n        if (isMountedRef.current) {\r\n          setStatus(\"incomplete\");\r\n          setMessage(\"âš ï¸ Please adjust position and lighting for better verification\");\r\n          setAllChecksPassed(false);\r\n        }\r\n        return;\r\n      }\r\n\r\n      await new Promise(resolve => setTimeout(resolve, 500));\r\n      \r\n      if (!isMountedRef.current) return;\r\n      await checkEnvironment();\r\n      \r\n      if (!isMountedRef.current) return;\r\n      \r\n      const allPassed = Object.values(checks).every(\r\n        check => check.status === \"passed\" || check.status === \"warning\"\r\n      );\r\n      \r\n      setAllChecksPassed(allPassed && faceCheckPassed);\r\n      \r\n      if (allPassed && faceCheckPassed) {\r\n        setStatus(\"ready\");\r\n        setMessage(\"âœ… All checks passed! Identity verified. You're ready to start the exam.\");\r\n      } else {\r\n        setStatus(\"incomplete\");\r\n        setMessage(\"âš ï¸ Please resolve all issues before proceeding.\");\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Check error:\", error);\r\n      if (isMountedRef.current) {\r\n        setStatus(\"error\");\r\n        setMessage(\"Error during verification: \" + error.message);\r\n      }\r\n    }\r\n  };\r\n\r\n  const checkLighting = async () => {\r\n    try {\r\n      if (!isMountedRef.current || !videoRef.current) return;\r\n      \r\n      updateCheck(\"lighting\", \"pending\", \"Analyzing lighting conditions...\");\r\n\r\n      const canvas = document.createElement(\"canvas\");\r\n      canvas.width = videoRef.current.videoWidth;\r\n      canvas.height = videoRef.current.videoHeight;\r\n      const ctx = canvas.getContext(\"2d\");\r\n      ctx.drawImage(videoRef.current, 0, 0);\r\n\r\n      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n      const data = imageData.data;\r\n      \r\n      let totalBrightness = 0;\r\n      for (let i = 0; i < data.length; i += 4) {\r\n        const brightness = (data[i] + data[i + 1] + data[i + 2]) / 3;\r\n        totalBrightness += brightness;\r\n      }\r\n      \r\n      const avgBrightness = totalBrightness / (data.length / 4);\r\n      \r\n      if (!isMountedRef.current) return;\r\n      \r\n      if (avgBrightness < 50) {\r\n        updateCheck(\"lighting\", \"warning\", \"âš ï¸ Low lighting detected. Please improve lighting.\");\r\n      } else if (avgBrightness > 200) {\r\n        updateCheck(\"lighting\", \"warning\", \"âš ï¸ Very bright. Consider adjusting lighting.\");\r\n      } else {\r\n        updateCheck(\"lighting\", \"passed\", `âœ… Lighting is good (${Math.round(avgBrightness)}/255)`);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Lighting check error:\", error);\r\n      if (isMountedRef.current) {\r\n        updateCheck(\"lighting\", \"warning\", \"âš ï¸ Unable to check lighting\");\r\n      }\r\n    }\r\n  };\r\n\r\n  const checkFaceDetectionAndVerification = async () => {\r\n    try {\r\n      if (!isMountedRef.current || !videoRef.current || !modelsLoaded || !registeredDescriptor) {\r\n        return false;\r\n      }\r\n      \r\n      updateCheck(\"faceDetection\", \"pending\", \"Detecting your face...\");\r\n      updateCheck(\"faceVerification\", \"pending\", \"Verifying your identity...\");\r\n\r\n      let bestMatch = null;\r\n      let bestDistance = Infinity;\r\n      const attempts = 5;\r\n      const validDetections = [];\r\n\r\n      for (let i = 0; i < attempts; i++) {\r\n        if (!isMountedRef.current || !videoRef.current) break;\r\n        \r\n        const detection = await faceapi\r\n          .detectSingleFace(videoRef.current, new faceapi.TinyFaceDetectorOptions({ \r\n            inputSize: 224,\r\n            scoreThreshold: 0.5\r\n          }))\r\n          .withFaceLandmarks()\r\n          .withFaceDescriptor();\r\n\r\n        if (detection) {\r\n          const distance = faceapi.euclideanDistance(\r\n            registeredDescriptor,\r\n            detection.descriptor\r\n          );\r\n          \r\n          validDetections.push({ detection, distance });\r\n          \r\n          if (distance < bestDistance) {\r\n            bestDistance = distance;\r\n            bestMatch = detection;\r\n          }\r\n\r\n          console.log(`ðŸ” Detection ${i + 1}/${attempts}: Distance = ${distance.toFixed(3)}`);\r\n        }\r\n\r\n        await new Promise(resolve => setTimeout(resolve, 300));\r\n      }\r\n\r\n      if (!isMountedRef.current) return false;\r\n\r\n      if (validDetections.length === 0) {\r\n        updateCheck(\"faceDetection\", \"failed\", \"âŒ No face detected. Please position yourself clearly.\");\r\n        updateCheck(\"faceVerification\", \"failed\", \"âŒ Cannot verify without face detection.\");\r\n        setCurrentFaceMatch(false);\r\n        return false;\r\n      }\r\n\r\n      updateCheck(\"faceDetection\", \"passed\", `âœ… Face detected successfully (${validDetections.length}/${attempts} captures)`);\r\n\r\n      const avgDistance = validDetections.reduce((sum, v) => sum + v.distance, 0) / validDetections.length;\r\n      const similarity = Math.max(0, (1 - avgDistance) * 100);\r\n      \r\n      console.log(`ðŸ“Š Verification - Distance: ${avgDistance.toFixed(3)}, Similarity: ${similarity.toFixed(1)}%`);\r\n\r\n      // Draw detection\r\n      if (canvasRef.current && bestMatch && isMountedRef.current) {\r\n        const dims = faceapi.matchDimensions(canvasRef.current, videoRef.current, true);\r\n        const resizedDetection = faceapi.resizeResults(bestMatch, dims);\r\n        const ctx = canvasRef.current.getContext(\"2d\");\r\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\r\n        \r\n        if (avgDistance < VERIFICATION_THRESHOLD) {\r\n          ctx.strokeStyle = \"#10b981\";\r\n          ctx.lineWidth = 4;\r\n        } else if (avgDistance < MIN_ACCEPTABLE_DISTANCE) {\r\n          ctx.strokeStyle = \"#f59e0b\";\r\n          ctx.lineWidth = 3;\r\n        } else {\r\n          ctx.strokeStyle = \"#ef4444\";\r\n          ctx.lineWidth = 3;\r\n        }\r\n        \r\n        faceapi.draw.drawDetections(canvasRef.current, resizedDetection);\r\n        faceapi.draw.drawFaceLandmarks(canvasRef.current, resizedDetection);\r\n      }\r\n\r\n      if (!isMountedRef.current) return false;\r\n      setVerificationScore(similarity.toFixed(1));\r\n\r\n      if (avgDistance < VERIFICATION_THRESHOLD) {\r\n        setCurrentFaceMatch(true);\r\n        setStartButtonEnabled(true);\r\n        updateCheck(\"faceVerification\", \"passed\", `âœ… Identity verified! Match: ${similarity.toFixed(1)}%`);\r\n        verificationAttempts.current = 0;\r\n        return true;\r\n      } else if (avgDistance < MIN_ACCEPTABLE_DISTANCE) {\r\n        setCurrentFaceMatch(true);\r\n        updateCheck(\"faceVerification\", \"warning\", `âš ï¸ Identity verified with low confidence: ${similarity.toFixed(1)}%`);\r\n        verificationAttempts.current = 0;\r\n        return true;\r\n      } else {\r\n        verificationAttempts.current++;\r\n        setCurrentFaceMatch(false);\r\n        \r\n        const remainingAttempts = 3 - verificationAttempts.current;\r\n        \r\n        if (verificationAttempts.current < 3) {\r\n          updateCheck(\"faceVerification\", \"failed\", `âŒ Identity verification failed (${similarity.toFixed(1)}%). ${remainingAttempts} attempts remaining.`);\r\n        } else {\r\n          updateCheck(\"faceVerification\", \"failed\", `âŒ Maximum attempts reached. Identity does not match.`);\r\n        }\r\n        \r\n        return false;\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Face verification error:\", error);\r\n      if (isMountedRef.current) {\r\n        updateCheck(\"faceDetection\", \"failed\", \"âŒ Error during face detection\");\r\n        updateCheck(\"faceVerification\", \"failed\", \"âŒ Error during verification\");\r\n        setCurrentFaceMatch(false);\r\n      }\r\n      return false;\r\n    }\r\n  };\r\n\r\n  const checkEnvironment = async () => {\r\n    try {\r\n      if (!isMountedRef.current || !videoRef.current || !modelsLoaded) return;\r\n      \r\n      updateCheck(\"environment\", \"pending\", \"Checking for multiple people...\");\r\n\r\n      const detections = await faceapi.detectAllFaces(\r\n        videoRef.current,\r\n        new faceapi.TinyFaceDetectorOptions({ scoreThreshold: 0.5 })\r\n      );\r\n\r\n      if (!isMountedRef.current) return;\r\n\r\n      if (detections.length === 0) {\r\n        updateCheck(\"environment\", \"warning\", \"âš ï¸ No face detected in frame.\");\r\n      } else if (detections.length === 1) {\r\n        updateCheck(\"environment\", \"passed\", \"âœ… Single person detected. Environment is clear.\");\r\n      } else {\r\n        updateCheck(\"environment\", \"warning\", `âš ï¸ Multiple people detected (${detections.length}). Please ensure you're alone.`);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Environment check error:\", error);\r\n      if (isMountedRef.current) {\r\n        updateCheck(\"environment\", \"warning\", \"âš ï¸ Unable to check environment\");\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleManualCheck = async () => {\r\n    if (!isMountedRef.current) return;\r\n    \r\n    setIsManualCheck(true);\r\n    setStatus(\"checking\");\r\n    setMessage(\"Running manual verification...\");\r\n    verificationAttempts.current = 0;\r\n    await runAllChecks();\r\n    \r\n    if (isMountedRef.current) {\r\n      setIsManualCheck(false);\r\n    }\r\n  };\r\n\r\n  const handleStartExam = () => {\r\n    if (!startButtonEnabled) {\r\n      alert(\"Please complete face verification before starting the exam.\");\r\n      return;\r\n    }\r\n\r\n    if (window.confirm(\r\n      `âœ… Identity Verified: ${user.name}\\n\\n` +\r\n      `Match Score: ${verificationScore}%\\n\\n` +\r\n      `âš ï¸ Important Reminders:\\n` +\r\n      `â€¢ Timer will start when you begin the exam\\n` +\r\n      `â€¢ Your identity will be verified continuously\\n` +\r\n      `â€¢ Keep your face visible at all times\\n\\n` +\r\n      `Are you ready to start?`\r\n    )) {\r\n      stopCamera();\r\n      navigate(`/exam/${examId}`);\r\n    }\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    if (window.confirm(\"Are you sure you want to cancel?\")) {\r\n      stopCamera();\r\n      navigate(\"/student/dashboard\");\r\n    }\r\n  };\r\n\r\n  const getStatusIcon = (status) => {\r\n    switch (status) {\r\n      case \"passed\": return \"âœ…\";\r\n      case \"failed\": return \"âŒ\";\r\n      case \"warning\": return \"âš ï¸\";\r\n      default: return \"â³\";\r\n    }\r\n  };\r\n\r\n  const getStatusColor = (status) => {\r\n    switch (status) {\r\n      case \"passed\": return \"#10b981\";\r\n      case \"failed\": return \"#ef4444\";\r\n      case \"warning\": return \"#f59e0b\";\r\n      default: return \"#6b7280\";\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"pre-exam-container\">\r\n      <div className=\"pre-exam-card\">\r\n        <div className=\"pre-exam-header\">\r\n          <h2>ðŸ”’ Identity Verification Required</h2>\r\n          {examDetails && (\r\n            <div className=\"exam-info\">\r\n              <h3>{examDetails.title}</h3>\r\n              <p>\r\n                ðŸ“ {examDetails.questions?.length || 0} Questions â€¢ \r\n                â±ï¸ {examDetails.durationMins || 30} Minutes â€¢ \r\n                ðŸ‘¤ Registered Student: <strong>{user.name}</strong>\r\n              </p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"verification-area\">\r\n          <div className=\"camera-section\">\r\n            <div className=\"camera-container\">\r\n              <video\r\n                ref={videoRef}\r\n                autoPlay\r\n                muted\r\n                playsInline\r\n                className=\"camera-video\"\r\n                onLoadedMetadata={() => {\r\n                  if (canvasRef.current && videoRef.current) {\r\n                    canvasRef.current.width = videoRef.current.videoWidth;\r\n                    canvasRef.current.height = videoRef.current.videoHeight;\r\n                  }\r\n                }}\r\n              />\r\n              <canvas ref={canvasRef} className=\"detection-canvas\" />\r\n              \r\n              {verificationScore > 0 && (\r\n                <div className={`match-overlay ${currentFaceMatch ? 'match' : 'no-match'}`}>\r\n                  {currentFaceMatch ? (\r\n                    <div className=\"match-success\">\r\n                      <span className=\"match-icon\">âœ…</span>\r\n                      <span className=\"match-text\">Identity Verified</span>\r\n                      <span className=\"match-score\">{verificationScore}%</span>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"match-fail\">\r\n                      <span className=\"match-icon\">âš ï¸</span>\r\n                      <span className=\"match-text\">Please Retry</span>\r\n                      <span className=\"match-score\">{verificationScore}%</span>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n            \r\n            <div className=\"status-display\">\r\n              <div className={`status-indicator ${status}`}></div>\r\n              <p className=\"status-message\">{message}</p>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"checks-section\">\r\n            <h3>Verification Checklist</h3>\r\n            <div className=\"checks-list\">\r\n              {Object.entries(checks).map(([key, check]) => (\r\n                <div\r\n                  key={key}\r\n                  className={`check-item ${check.status}`}\r\n                  style={{ borderLeftColor: getStatusColor(check.status) }}\r\n                >\r\n                  <span className=\"check-icon\">{check.icon} {getStatusIcon(check.status)}</span>\r\n                  <div className=\"check-content\">\r\n                    <strong>{key.replace(/([A-Z])/g, ' $1').trim()}</strong>\r\n                    <p>{check.message}</p>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"instructions-box\">\r\n          <h4>ðŸ’¡ Verification Tips</h4>\r\n          <ul>\r\n            <li><strong>Good Lighting:</strong> Ensure your face is well-lit</li>\r\n            <li><strong>Face Position:</strong> Look directly at the camera</li>\r\n            <li><strong>Remove Obstacles:</strong> Take off glasses/hats if possible</li>\r\n            <li><strong>Stable Position:</strong> Keep your head still</li>\r\n          </ul>\r\n        </div>\r\n\r\n        <div className=\"action-buttons\">\r\n          <button onClick={handleCancel} className=\"btn-cancel\">\r\n            âŒ Cancel\r\n          </button>\r\n          \r\n          <button \r\n            onClick={handleManualCheck} \r\n            className=\"btn-test\"\r\n            disabled={status === \"checking\"}\r\n          >\r\n            {isManualCheck ? \"ðŸ”„ Verifying...\" : \"ðŸ”„ Re-verify Identity\"}\r\n          </button>\r\n          \r\n          <button\r\n            onClick={handleStartExam}\r\n            className=\"btn-start\"\r\n            disabled={!startButtonEnabled || status === \"checking\"}\r\n          >\r\n            âœ… Start Exam\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}